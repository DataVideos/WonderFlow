(function(e){function t(t){for(var r,s,o=t[0],l=t[1],c=t[2],u=0,h=[];u<o.length;u++)s=o[u],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&h.push(i[s][0]),i[s]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);d&&d(t);while(h.length)h.shift()();return n.push.apply(n,c||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],r=!0,o=1;o<a.length;o++){var l=a[o];0!==i[l]&&(r=!1)}r&&(n.splice(t--,1),e=s(s.s=a[0]))}return e}var r={},i={app:0},n=[];function s(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=r,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(a,r,function(t){return e[t]}.bind(null,r));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var d=l;n.push([9,"chunk-vendors"]),a()})({0:function(e,t){},"0764":function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var r=a("ade3");class i{constructor(){Object(r["a"])(this,"start",void 0),Object(r["a"])(this,"offset",void 0),Object(r["a"])(this,"duration",void 0),Object(r["a"])(this,"yoyo",void 0)}static getDefaultTiming(){const e=new i;return e.start=0,e.offset=0,e.duration=1,e.yoyo=void 0,e}static simplifyJSON(e){if("object"!==typeof e)return e;const t={};if("start"in e&&0!==e.start&&"0"!==e.start){const a=parseFloat(e.start);isNaN(a)||(t.start=a)}if("offset"in e&&0!==e.offset&&"0"!==e.offset){const a=parseFloat(e.offset);isNaN(a)||(t.offset=a)}if("duration"in e&&0!==e.duration&&"0"!==e.duration){const a=parseFloat(e.duration);isNaN(a)||(t.duration=a)}if("yoyo"in e){const a=Object.assign({},i.getDefaultYoyo(),e.yoyo);1===a.repeat&&0===a.delay||(t.yoyo=e.yoyo)}return 0===Object.keys(t).length?void 0:t}static getDefaultYoyo(){return{repeat:1,delay:0}}getComputedTiming(){const e=i.getDefaultTiming();return Object.keys(this).forEach(t=>{"yoyo"!==t&&null!=this[t]&&(e[t]=this[t])}),!0===this.yoyo?e.yoyo=i.getDefaultYoyo():this.yoyo&&"object"===typeof this.yoyo&&(e.yoyo=i.getDefaultYoyo(),Object.keys(this.yoyo).forEach(t=>{null!=this.yoyo[t]&&(e.yoyo[t]=this.yoyo[t])})),e}startPlusOffset(){var e,t;return(null!==(e=this.start)&&void 0!==e?e:0)+(null!==(t=this.offset)&&void 0!==t?t:0)}}},1:function(e,t){},1084:function(e,t,a){"use strict";a("428f")},2:function(e,t){},"2bc8":function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var r=a("f720");class i extends r["a"]{constructor(e={}){super(e),this.type="native"}setTarget(e){return super.setTarget(e),this}updateTarget(e){return super.updateTarget(e),this}setTiming(e){return super.setTarget(e),this}updateTiming(e){return super.updateTiming(e),this}getDefaultSettings(){return{}}updateSettings(e){return Object.assign(this.settings,e),this}set(e,t){return this.settings[e]=t,this}computePossibleElements(e){const t=e.getGlyphs(this.target);return new Set(t)}computeDuration(e){var t;const{yoyo:a}=this.timing.getComputedTiming();if(null!==(t=this.timing)&&void 0!==t&&t.duration)return this.timing.duration;const r=this.create(e);if(!r)return 0;a&&(r.yoyo(!0),r.repeat(a.repeat),r.repeatDelay(a.delay));const i=r.duration();return r.clear&&r.clear(!0),r.kill(),i}}},"2f6e":function(e,t,a){},3:function(e,t){},"30aa":function(e,t,a){},"39ec":function(e,t,a){},4:function(e,t){},"428f":function(e,t,a){},"462f":function(e,t,a){"use strict";a("5bc0")},"4b58":function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var r=a("ade3"),i=a("8f52"),n=a("c66e"),s=a("2ef0"),o=a.n(s);class l{constructor(){Object(r["a"])(this,"templateName",void 0),Object(r["a"])(this,"parameters",void 0),Object(r["a"])(this,"type",void 0),Object(r["a"])(this,"settings",void 0),this.templateName=Object(i["a"])(),this.parameters=[],this.type="unknown",this.settings={}}clone(){return o.a.cloneDeep(this)}instantiate(e,t=!0){const a=this.getDefaultSettings();return this.settings=e?Object.assign(a,e):a,t&&!this.isValid()?(console.warn("Failed to instantiate using template "+this.templateName+". Params are not valid"),null):this.createAnimation()}getDefaultSettings(){const e={};return this.parameters.forEach(t=>e[t.paramName]=t.defaultValue),e}parseSettingsJSON(e){if(!e||"object"!==typeof e)return;const t={};return this.parameters.forEach(a=>{if(a.paramName in e){const r=e[a.paramName];if(void 0===r)return;switch(a.paramType){case n["a"].NUMBER:if("string"===typeof r){const e=parseFloat(r);isNaN(e)||(t[a.paramName]=e)}else t[a.paramName]=r;break;case n["a"].STRING:""!==r&&(t[a.paramName]=r);break;default:t[a.paramName]=r}}}),0===Object.keys(t).length?void 0:t}getParamValue(e){return this.getParamValues()[e]}getParamValues(e=null){if(null==e||!Array.isArray(e))return this.settings;const t={};return e.forEach(e=>{t[e]=this.getParamValue(e)}),t}isValid(){return this.parameters.every(e=>!e.required||void 0!==this.getParamValue(e.paramName))}createAnimation(){throw"Template is not implemented"}}},"4c89":function(e,t,a){},"4cb6":function(e,t,a){"use strict";a("30aa")},5:function(e,t){},"52d4":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return FilterTransform}));var _Users_carl_Code_Research_MSRA_WonderFlow2_0_frontend_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("ade3"),core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("5b81"),core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_1__),_core_entities_spec_BaseTransform__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("ef41");class FilterTransform extends _core_entities_spec_BaseTransform__WEBPACK_IMPORTED_MODULE_2__["a"]{constructor(){super(),Object(_Users_carl_Code_Research_MSRA_WonderFlow2_0_frontend_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"type",void 0),Object(_Users_carl_Code_Research_MSRA_WonderFlow2_0_frontend_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"expr",void 0),this.type="filter",this.expr="true"}execute(selection){const expr=this.expr.replaceAll("@classList","__node__.classList").replaceAll("@id",'__node__.getAttribute("id")').replaceAll("@index","__index__").replaceAll("@datum",'(JSON.parse(__node__.getAttribute("ac-data")) ?? {})').replaceAll("@el","__node__"),nodes=selection.nodes(),keepArray=nodes.map((__node__,__index__)=>eval(expr));return selection.filter((e,t)=>keepArray[t])}}},"56d7":function(e,t,a){"use strict";a.r(t),a.d(t,"eventBus",(function(){return dd}));var r=a("2b0e"),i=a("8c4f"),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},s=[],o={name:"App"},l=o,c=(a("6e8a"),a("2877")),d=Object(c["a"])(l,n,s,!1,null,null,null),u=d.exports,h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"homepage-view"},[a("el-header",[a("PageHeader")],1),a("el-main",[a("el-col",{attrs:{span:12,offset:6}},[a("el-row",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},[a("h1",{staticClass:"title-text"},[e._v("WonderFlow: Easy Creation of Narration-Enriched Data Videos")])]),a("el-row",{staticStyle:{"margin-bottom":"20px"}},[a("h4",{staticStyle:{"text-align":"center"}},[a("p",[a("span",[e._v("Yun Wang"),a("sup",[e._v("* 1")])]),e._v("   "),a("span",[e._v("Leixian Shen"),a("sup",[e._v("* 2")])]),e._v("   "),a("span",[e._v("Zhengxin You"),a("sup",[e._v("3")])]),e._v("   "),a("span",[e._v("Xinhuan Shu"),a("sup",[e._v("4")])]),e._v("   "),a("span",[e._v("Bongshin Lee"),a("sup",[e._v("5")])]),e._v("   "),a("br"),a("span",[e._v("John Thompson"),a("sup",[e._v("6")])]),e._v("   "),a("span",[e._v("Haidong Zhang"),a("sup",[e._v("1")])]),e._v("   "),a("span",[e._v("Dongmei Zhang"),a("sup",[e._v("1")])])]),a("p",[a("span",[a("sup",[e._v("1")]),e._v("Microsoft Research")]),e._v("   "),a("span",[a("sup",[e._v("2")]),e._v("The Hong Kong University of Science and Technology")]),e._v("   "),a("br"),a("span",[a("sup",[e._v("3")]),e._v("The Hong Kong Polytechnic University")]),e._v("   "),a("span",[a("sup",[e._v("4")]),e._v("Newcastle University")]),e._v("   "),a("span",[a("sup",[e._v("5")]),e._v("Yonsei University")]),e._v("   "),a("span",[a("sup",[e._v("6")]),e._v("AutoDesk")])]),a("p",[a("sup",[e._v("*")]),e._v("Equal contribution")]),a("p",[e._v("IEEE Transactions on Visualization and Computer Graphics 2024")])])]),a("el-row",{staticStyle:{"margin-bottom":"20px"}},[a("video",{staticClass:"local-video",staticStyle:{"box-shadow":"0 0 5px #d7d7d7"},attrs:{src:"./data/video/WonderFlow_video.mp4",controls:"",width:"100%",height:"100%"}})]),a("el-row",{staticStyle:{"margin-bottom":"20px"}},[a("h3",{staticStyle:{"text-align":"center"}},[e._v("Abstract")]),a("p",[e._v("Creating an animated data video with audio narration is a time-consuming and complex task that requires expertise. It involves designing complex animations, turning written scripts into audio narrations, and synchronizing visual changes with the narrations. This paper presents WonderFlow, an interactive authoring tool, that facilitates narration-centric design of animated data videos. WonderFlow allows authors to easily specify semantic links between text and the corresponding chart elements. Then it automatically generates audio narration by leveraging text-to-speech techniques and aligns the narration with an animation. WonderFlow provides a structure-aware animation library designed to ease chart animation creation, enabling authors to apply pre-designed animation effects to common visualization components. Additionally, authors can preview and refine their data videos within the same system, without having to switch between different creation tools. A series of evaluation results confirmed that WonderFlow is easy to use and simplifies the creation of data videos with narration-animation interplay.")])])],1)],1),a("el-footer",[a("PageFooter")],1)],1)},p=[],g=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-header"},[a("el-row",{staticStyle:{height:"100%"},attrs:{gutter:5,type:"flex",align:"middle"}},[a("el-col",{attrs:{span:3,offset:6}},[a("span",{staticClass:"header-text",staticStyle:{"user-select":"none",cursor:"pointer"},attrs:{title:"WonderFlow Homepage"},on:{click:e.clickHome}},[e._v("WonderFlow")])]),a("el-col",{attrs:{span:8,offset:7}},[a("el-button",{staticClass:"header-button",attrs:{type:"text"},nativeOn:{click:function(t){return e.clickHome.apply(null,arguments)}}},[e._v("Home")]),a("el-button",{staticClass:"header-button",attrs:{type:"text"},nativeOn:{click:function(t){return e.clickGallery.apply(null,arguments)}}},[e._v("Gallery")])],1)],1)],1)},m=[],f={name:"PageHeader",components:{},data(){return{}},methods:{clickHome(){console.log(this.$route),"/homepage"!==this.$route.path&&this.$router.push("homepage")},clickGallery(){"/gallery"!==this.$route.path&&this.$router.push("gallery")},clickLaunch(){"/editor"!==this.$route.path&&this.$router.push("editor")}},mounted(){},computed:{}},w=f,y=(a("c492"),Object(c["a"])(w,g,m,!1,null,"41a0ba36",null)),b=y.exports,x=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-footer"},[a("el-row",{staticStyle:{height:"100%"},attrs:{gutter:5,type:"flex",align:"middle"}},[a("el-col",{attrs:{span:3,offset:6}},[a("span",{staticClass:"footer-text",staticStyle:{"user-select":"none"}},[e._v("WonderFlow")])]),a("el-col",{attrs:{span:12,offset:3}},[e._v(" Make it easy to create narration-enriched data videos ")])],1)],1)},v=[],_={name:"PageFooter",components:{},data(){return{}},methods:{},mounted(){},computed:{}},T=_,E=(a("462f"),Object(c["a"])(T,x,v,!1,null,"598dec7d",null)),S=E.exports,A={name:"HomepageView",components:{PageFooter:S,PageHeader:b},data(){return{}},methods:{},mounted(){},computed:{}},N=A,O=(a("4cb6"),Object(c["a"])(N,h,p,!1,null,"43a8d848",null)),R=O.exports,M=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"gallery-view"},[a("el-header",[a("PageHeader")],1),a("el-main",[a("el-col",{attrs:{span:12,offset:6}},[a("el-row",[a("span",{staticClass:"page-text"},[e._v("Gallery")])]),a("el-row",[a("div",{staticClass:"svg-group"},[e._l(e.presetCharts,(function(t){return a("el-card",{key:t.id,staticClass:"svg-item clickable",attrs:{shadow:"hover","body-style":{padding:"0px"}},nativeOn:{click:function(a){return e.handleProjectClick(t)}}},[a("SvgPreviewer",{attrs:{project:t,height:180,width:290}}),a("div",{staticClass:"item-text-container"},[a("div",[e._v(e._s(t.label))]),a("div",{staticStyle:{color:"gray","font-size":"0.9rem"}},[e._v(e._s(t.chartType))])])],1)})),e._l([].concat(Array((3-e.presetCharts.length%3)%3).keys()),(function(e){return a("div",{key:"empty-block-"+e,staticClass:"svg-item"})}))],2)])],1)],1),a("el-footer",[a("PageFooter")],1)],1)},C=[],I=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"svg-previewer",style:{height:e.height+"px",width:e.width+"px"}},[a("svg",{ref:"svg",attrs:{height:e.height,width:e.width}},[a("g",{staticClass:"scene"})])])},L=[],k=a("2f62"),P={name:"SvgPreviewer",props:["project","width","height"],data(){return{svg:null,scene:null,created:!1}},methods:{loadSVG(){if(this.created)return;const e=this.staticSvgMap.get(this.project.id);e&&(this.created=!0,this.scene.innerHTML=e,this.$nextTick(()=>{const e=this.scene.querySelector("svg");e.setAttribute("width",this.width),e.setAttribute("height",this.height);let t=e.getAttribute("viewBox");if(!t||!t.match(/\d+ \d+ \d+ \d+/)){const{width:e,height:a}=this.scene.getBoundingClientRect();t=`0 0 ${e} ${a}`}const a=t.split(" "),r=parseInt(a[2]),i=parseInt(a[3]);if(r/i>this.width/this.height){const e=Math.floor(this.width/this.height*i),a=Math.ceil((r-e)/2);t=`${a} 0 ${e} ${i}`}else{const e=Math.round(this.height/this.width*r),a=Math.ceil((i-e)/2);t=`0 ${a} ${r} ${e}`}e.setAttribute("viewBox",t)}))}},mounted(){this.svg=this.$refs.svg,this.scene=this.svg.querySelector(".scene")},watch:{staticSvgMapSign(){this.loadSVG()}},computed:{...Object(k["b"])("resource",{staticSvgMap:e=>e.staticSvgMap,staticSvgMapSign:e=>e.staticSvgMapSign})}},B=P,j=Object(c["a"])(B,I,L,!1,null,"1bdfccbf",null),G=j.exports,D={name:"GalleryView",components:{SvgPreviewer:G,PageFooter:S,PageHeader:b},data(){return{}},mounted(){this.$store.dispatch("resource/queryAllSvg").then(()=>{this.$store.commit("resource/changeStaticSvgMapSign")})},methods:{handleProjectClick(e){this.$router.push({path:"example",query:{"example-index":this.projectList.indexOf(e)}})}},computed:{...Object(k["b"])("resource",{projectList:e=>e.projectList}),projectGroupMap(){const e=new Map;return e.set("Single chart",[]),e.set("Custom chart",[]),e.set("Vega Line Chart",[]),this.projectList.forEach(t=>{const a=t.group;"Single chart"!==a&&"Custom chart"!==a&&"Vega Line Chart"!==a||e.get(a).push(t)}),e},presetCharts(){var e,t;const a=null!==(e=this.projectGroupMap.get("Single chart"))&&void 0!==e?e:[],r=null!==(t=this.projectGroupMap.get("Vega Line Chart"))&&void 0!==t?t:[];return a.concat(...r)},customCharts(){var e;return null!==(e=this.projectGroupMap.get("Custom chart"))&&void 0!==e?e:[]}}},U=D,$=(a("1084"),Object(c["a"])(U,M,C,!1,null,"55118168",null)),H=$.exports,F=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"example-view"},[a("el-header",[a("PageHeader")],1),a("el-main",[a("el-col",{attrs:{span:12,offset:6}},[a("el-row",[a("div",{staticStyle:{width:"100%",display:"flex"}},[a("span",{staticClass:"page-text"},[e._v(e._s(e.project.label))]),a("el-button",{staticClass:"back-button",attrs:{type:"text"},nativeOn:{click:function(t){return e.clickBack.apply(null,arguments)}}},[e._v("< Back to gallery")])],1),a("span",{staticClass:"page-text-small"},[e._v(e._s(e.project.chartType))])]),a("el-row",{staticStyle:{display:"flex","flex-wrap":"wrap","margin-top":"20px"}},[a("SvgPreviewer",{staticStyle:{border:"1px solid #cecece","border-radius":"4px"},attrs:{project:e.project,height:320,width:500}}),a("div")],1),a("el-row",{staticStyle:{"margin-top":"10px"}},[a("div",{staticClass:"title-text"},[e._v("Link to Original Video")]),a("a",{staticClass:"content-text",attrs:{href:e.galleryInfo.link}},[e._v(e._s(e.galleryInfo.videoName))])]),a("el-row",{staticStyle:{"margin-top":"10px"}},[a("div",{staticClass:"title-text"},[e._v("Narration")]),a("div",{staticClass:"content-text"},[e._v(e._s(e.galleryInfo.transcript))])]),a("el-row",[a("div",{staticClass:"title-text"},[e._v("Creation Process")]),a("video",{staticClass:"local-video",attrs:{src:"./data/video/V"+(e.projectIndex+1)+"_1.mp4",controls:"",width:"100%",height:"100%"}})]),a("el-row",[a("div",{staticClass:"title-text"},[e._v("Final Version")]),a("video",{staticClass:"local-video",attrs:{src:"./data/video/V"+(e.projectIndex+1)+"_2.mp4",controls:"",width:"100%",height:"100%"}})])],1)],1),a("el-footer",[a("PageFooter")],1)],1)},V=[],W={name:"ExampleView",components:{SvgPreviewer:G,PageFooter:S,PageHeader:b},data(){return{projectIndex:-1,project:{}}},mounted(){let e=1;try{var t;e=parseInt(null!==(t=this.$route.query["example-index"])&&void 0!==t?t:""+e)}catch(a){console.log(a)}this.projectIndex=e,this.project=this.projectList[this.projectIndex],this.$store.dispatch("resource/queryAllSvg").then(()=>{this.$store.commit("resource/changeStaticSvgMapSign")})},methods:{clickBack(){this.$router.push("gallery")},clickLaunch(){this.$router.push({path:"editor",query:{"example-index":this.projectIndex}})}},watch:{},computed:{...Object(k["b"])("resource",{projectList:e=>e.projectList,galleryList:e=>e.galleryList}),galleryInfo(){var e;return this.project&&null!==(e=this.galleryList.find(e=>e.id===this.project.id))&&void 0!==e?e:{}}}},J=W,q=(a("7bc9"),Object(c["a"])(J,F,V,!1,null,"412f16fc",null)),z=q.exports,K=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"live-view"},[e._m(0),a("el-row",{staticClass:"main-container"},[a("el-col",{staticClass:"upload-container"},[a("div",{staticClass:"title-text-container"},[a("span",{staticClass:"title-text"},[e._v("Data Upload")])]),a("SelectColumnPanel")],1),a("el-col",{staticClass:"generation-container"},[a("div",{staticClass:"title-text-container",staticStyle:{background:"#FEF7F2"}},[a("span",{staticClass:"title-text",staticStyle:{color:"#F5590D"}},[e._v("Generation")])]),a("el-button",{staticClass:"upload-btn",attrs:{plain:""}},[e._v("Live")])],1)],1)],1)},Y=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"head-container"},[a("span",{staticClass:"header-text",attrs:{title:"Live Chart"}},[e._v("Live Chart")])])}],X=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"select-container"},[a("span",[e._v("Select Columns")]),a("el-table",{ref:"singleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"highlight-current-row":""},on:{"current-change":e.handleCurrentChange}},[a("el-table-column",{attrs:{type:"index",width:"50"}}),a("el-table-column",{attrs:{property:"date",label:"日期",width:"120"}}),a("el-table-column",{attrs:{property:"name",label:"姓名",width:"120"}}),a("el-table-column",{attrs:{property:"address",label:"地址"}})],1),a("el-button",{staticClass:"upload-btn",attrs:{plain:""}},[e._v("Live")])],1)},Z=[],Q={name:"SelectColumnPanel",data(){return{tableData:[{date:"2016-05-02",name:"王小虎",address:"上海市普陀区金沙江路 1518 弄"},{date:"2016-05-04",name:"王小虎",address:"上海市普陀区金沙江路 1517 弄"},{date:"2016-05-01",name:"王小虎",address:"上海市普陀区金沙江路 1519 弄"},{date:"2016-05-03",name:"王小虎",address:"上海市普陀区金沙江路 1516 弄"}],currentRow:null}},methods:{},mounted(){},watch:{},computed:{}},ee=Q,te=(a("fef3"),Object(c["a"])(ee,X,Z,!1,null,"27202780",null)),ae=te.exports,re={name:"LiveView",components:{SelectColumnPanel:ae},data(){return{}},methods:{},mounted(){},computed:{}},ie=re,ne=(a("e13f"),Object(c["a"])(ie,K,Y,!1,null,"4d510832",null)),se=ne.exports,oe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"upload-view"},[a("el-header",{staticClass:"head-container"},[a("span",{staticClass:"header-text",attrs:{title:"Live Chart"}},[e._v("Live Chart")])]),a("el-main",{staticClass:"main-container"},[a("el-col",{staticClass:"upload"},[a("el-upload",{staticClass:"upload-data",attrs:{action:"https://jsonplaceholder.typicode.com/posts/","on-preview":e.handlePreview,"on-remove":e.handleRemove,"before-remove":e.beforeRemove,multiple:"",limit:1,"on-exceed":e.handleExceed,"file-list":e.fileList}},[a("el-button",{staticClass:"upload-btn",attrs:{plain:""}},[e._v("Data Upload")])],1),a("span",{staticClass:"main-text"},[e._v("Don't have data? Try any of the files below.")]),a("el-row",[a("el-button",{staticClass:"data-btn",attrs:{size:"mini"},nativeOn:{click:function(t){return e.clickLive.apply(null,arguments)}}},[e._v("a.csv")]),a("el-button",{staticClass:"data-btn",attrs:{size:"mini"}},[e._v("b.csv")]),a("el-button",{staticClass:"data-btn",attrs:{size:"mini"}},[e._v("c.csv")]),a("el-button",{staticClass:"data-btn",attrs:{size:"mini"}},[e._v("d.csv")])],1)],1)],1)],1)},le=[],ce={name:"UploadView",components:{},data(){return{}},methods:{clickLive(){console.log(this.$route),"/live"!==this.$route.path&&this.$router.push("live")}},mounted(){},computed:{}},de=ce,ue=(a("f3ca"),Object(c["a"])(de,oe,le,!1,null,"7907a5c4",null)),he=ue.exports;const pe=[{path:"/homepage",component:R},{path:"/gallery",component:H},{path:"/example",component:z},{path:"/upload",component:he},{path:"/live",component:se},{path:"/",redirect:"/homepage"}];var ge=new i["a"]({mode:"hash",routes:pe}),me=a("ade3"),fe=a("8f52");function we(e){if(void 0===e||null===e)return e;let t=Array.isArray(e)?[]:{};for(let a in e)t[a]="object"===typeof e[a]?we(e[a]):e[a];return void 0!==e.prototype&&(t.prototype=e.prototype),t}class ye{constructor(e,t,a,r,i,n={},s=[]){Object(me["a"])(this,"effectId",void 0),Object(me["a"])(this,"type",void 0),Object(me["a"])(this,"defaults",void 0),Object(me["a"])(this,"effLabels",void 0),Object(me["a"])(this,"config",void 0),Object(me["a"])(this,"custom",void 0),Object(me["a"])(this,"genFunc",void 0),Object(me["a"])(this,"offset",void 0),Object(me["a"])(this,"duration",void 0),this.effectId=e,this.type=t,this.genFunc=a,this.duration=r,this.offset=i||0,this.defaults=n,this.effLabels=s}generateEffectGsap(e){let t=this.genFunc(e,this.getMergedConfig());return t.valid?t:(console.error("EffectGsap is not valid",this,t),null)}getMergedConfig(){let e=we(this.config)||{};return Object.keys(this.defaults).forEach(t=>{void 0===e[t]&&(e[t]=this.defaults[t])}),e}generateTween(e,t=null){let a=this.generateEffectGsap(e);return a.getTween(e.target,null!=t?t:this.duration)}toJsonObj(){if(null==this.type)return this.custom;let e={},t=["effectId","genFunc","defaults","config","custom"];return Object.keys(this).forEach(a=>{t.includes(a)||(e[a]=this[a])}),null!=this.config&&(e={...e,...this.config}),e}}var be=a("cffa");class xe{constructor({valid:e=!0,from:t,to:a,message:r="",target:i}){Object(me["a"])(this,"valid",void 0),Object(me["a"])(this,"from",void 0),Object(me["a"])(this,"to",void 0),Object(me["a"])(this,"target",void 0),Object(me["a"])(this,"message",void 0),this.valid=e,this.from=t,this.to=a,this.target=i,this.message=r}getTween(e,t){let a;this.target&&(e=this.target);let r=this.from,i=this.to;return null!=r&&null!=i?(i={...i,duration:t},a=be["a"].fromTo(e,r,i)):null!=r?(r={...r,duration:t},a=be["a"].from(e,r)):(i={...i,duration:t},a=be["a"].to(e,i)),a}}const ve={mode:"in",ease:"power1.out"},_e=function(e,t){let a=null,r=null;if("in"===t.mode)a={scale:0,ease:t.ease,transformOrigin:"center center"};else{if("out"!==t.mode)return new xe({valid:!1,message:"Wrong mode param: "+t.mode});r={scale:0,ease:t.ease,transformOrigin:"center center"}}return new xe({from:a,to:r})},Te=1,Ee=0,Se=new ye("preset-scale","scale",_e,Te,Ee,ve),Ae={mode:"from",x:"+=0",y:"+=0",yoyoDelay:0,ease:"power1.out"},Ne=function(e,t){let a=null,r=null;if("from"===t.mode)a={x:t.x,y:t.y,ease:t.ease};else if("to"===t.mode)r={x:t.x,y:t.y,ease:t.ease};else{if("yoyo"!==t.mode)return new xe({valid:!1,message:"Wrong mode param: "+t.mode});r={x:t.x,y:t.y,ease:t.ease,yoyo:!0,repeat:1,repeatDelay:t.yoyoDelay}}return new xe({from:a,to:r})},Oe=1,Re=0,Me=new ye("preset-move","move",Ne,Oe,Re,Ae),Ce={mode:"in",ease:"power1.out"},Ie=function(e,t){let a=null,r=null;if("in"===t.mode)a={opacity:0,ease:t.ease};else{if("out"!==t.mode)return new xe({valid:!1,message:"Wrong mode param: "+t.mode});r={opacity:0,ease:t.ease}}return new xe({from:a,to:r})},Le=1,ke=0,Pe=new ye("preset-fade","fade",Ie,Le,ke,Ce),Be={UP:"up",DOWN:"down",LEFT:"left",RIGHT:"right"},je={direction:Be.UP,ease:"power1.out"},Ge=function(e,t){let a,r;switch(t.direction){case Be.UP:a="scaleY",r="bottom";break;case Be.DOWN:a="scaleY",r="top";break;case Be.LEFT:a="scaleX",r="right";break;case Be.RIGHT:a="scaleX",r="left";break;default:return new xe({valid:!1,message:"Wrong direction param: "+t.direction})}let i={transformOrigin:r,ease:t.ease};return i[a]=0,new xe({from:i})},De=1,Ue=0,$e=new ye("preset-grow","grow",Ge,De,Ue,je),He={mode:"in",direction:Be.UP,ease:"power1.out"},Fe=function(e,t){var a;let r,i,n=e.container.select("defs");switch(n.empty()&&(n=e.container.append("defs")),t.direction){case Be.UP:r=0,i=-1;break;case Be.DOWN:r=0,i=1;break;case Be.RIGHT:r=-1,i=0;break;case Be.LEFT:r=1,i=0;break}"out"===t.mode&&(r*=-1,i*=-1);const s=e.target.id+"-mask",o=e.target.getBBox(),l=parseFloat(null!==(a=e.target.getAttribute("stroke-width"))&&void 0!==a?a:"0");let c,d,u,h,p,g;u=o.width+l,h=o.height+l,c=o.x+r*(o.width+2*l),d=o.y+i*(o.height+2*l),p=o.x,g=o.y;let m,f,w=n.select("#"+s).select("rect");if(w.empty()&&(w=n.append("mask").attr("id",s).attr("maskUnits","userSpaceOnUse").append("rect").attr("transform","translate("+[p,g]+")").attr("class","mask").attr("width",u).attr("height",h).attr("stroke-width",l).attr("fill","white").attr("stroke","white"),e.target.setAttribute("mask",`url(#${s})`)),"in"===t.mode)m={x:c,y:d,ease:t.ease};else{if("out"!==t.mode)return new xe({valid:!1,message:"Wrong mode param: "+t.mode});f={x:c,y:d,ease:t.ease}}return new xe({from:m,to:f,target:w.node()})},Ve=1,We=0,Je=new ye("preset-wipe","wipe",Fe,Ve,We,He),qe={mode:"in",direction:Be.UP,ease:"power1.out"},ze=function(e,t){var a;let r,i,n=e.container.select("defs");switch(n.empty()&&(n=e.container.append("defs")),t.direction){case Be.UP:r=0,i=-1;break;case Be.DOWN:r=0,i=1;break;case Be.RIGHT:r=-1,i=0;break;case Be.LEFT:r=1,i=0;break}"out"===t.mode&&(r*=-1,i*=-1);const s=e.target.id+"-mask",o=e.target.getBBox(),l=parseFloat(null!==(a=e.target.getAttribute("stroke-width"))&&void 0!==a?a:"0");let c,d,u,h,p,g;u=o.width+l,h=o.height+l,c=o.x+r*(o.width+2*l),d=o.y+i*(o.height+2*l),p=o.x,g=o.y;let m,f,w=n.select("#"+s).select("rect");if(w.empty()&&(w=n.append("mask").attr("id",s).attr("maskUnits","userSpaceOnUse").append("rect").attr("transform","translate("+[p,g]+")").attr("class","mask").attr("width",u).attr("height",h).attr("stroke-width",l).attr("fill","white").attr("stroke","white"),e.target.setAttribute("mask",`url(#${s})`)),"in"===t.mode)m={x:c,y:d,ease:t.ease};else{if("out"!==t.mode)return new xe({valid:!1,message:"Wrong mode param: "+t.mode});f={x:c,y:d,ease:t.ease}}return new xe({from:m,to:f,target:w.node()})};const Ke=1,Ye=0,Xe=new ye("preset-wheel","wheel",ze,Ke,Ye,qe),Ze={UNKNOWN:"unknown",BAR_CHART:"bar-chart",LINE_CHART:"line-chart",DECORATION:"decoration"};class Qe{constructor(e,t,a,r=Ze.UNKNOWN,i=[]){Object(me["a"])(this,"id",void 0),Object(me["a"])(this,"name",void 0),Object(me["a"])(this,"type",void 0),Object(me["a"])(this,"tempLabels",void 0),Object(me["a"])(this,"animationGen",void 0),this.id=e,this.name=t,this.animationGen=a,this.type=r,this.tempLabels=i,i.includes(r)||i.unshift(r)}}const et=[{selector:".axis",grouping:{groupByClass:"x",position:"start with previous",stagger:.3,grouping:{groupBy:"id",position:"start with previous",stagger:.01}},effects:[{type:"fade",mode:"in",duration:.6}],labels:["enter"],position:"start after previous"},{selector:".bar,.bar-label",grouping:{groupByClass:"bar",position:"start with previous",stagger:.02,grouping:{groupBy:"id",position:"start with previous",stagger:.05}},effects:[{attribute:"opacity",from:0,to:.6,duration:.6},{attribute:"fill",from:"red",duration:.6}],labels:["enter"],position:"start with previous",offset:0}],tt=function(){let e=JSON.stringify(et);return Ot.from(JSON.parse(e))},at=(new Qe("bar chart-3","Bar chart enter 3",tt,Ze.BAR_CHART,["chart-level","enter","color"]),[{selector:".group.decoration",grouping:{groupBy:"id",position:"start after previous"},effects:[{type:"fade",mode:"in",duration:.6,effLabels:["fade-in"]},{attribute:"opacity",from:0,duration:.6,offset:4,effLabels:["fade-out"]}],labels:["emphasize"],position:"start after previous"}]),rt=function(){let e=JSON.stringify(at);return Ot.from(JSON.parse(e))},it=(new Qe("decoration-fade-in-then-out","Decoration fade-in fade-out",rt,Ze.BAR_CHART,["decoration","emphasize"]),[{selector:".axis.domain.x",effects:[{type:"grow",direction:"right",ease:"circ.inOut",duration:1.5}],labels:["enter"],position:"start after previous"},{selector:".axis.domain.y",effects:[{type:"grow",direction:"up",ease:"circ.inOut",duration:1.5}],labels:["enter"],position:"start with previous"},{selector:".axis.label,.axis.tick,.axis-label",effects:[{type:"fade",mode:"in",duration:1.5}],labels:["enter"],position:"start after previous"},{selector:".bar",effects:[{type:"grow",direction:"up",ease:"circ.inOut",duration:1.5}],labels:["enter"],position:"start after previous",offset:-1},{selector:".bar-label",effects:[{type:"fade",mode:"in",duration:1}],labels:["enter","fade-in"],position:"start after previous"},{selector:".decoration.group",effects:[{type:"fade",mode:"in",duration:1}],labels:["enter","fade-in"],position:"start after previous"}]),nt=function(){let e=JSON.stringify(it);return Ot.from(JSON.parse(e))},st=(new Qe("bar chart","Bar chart enter",nt,Ze.BAR_CHART,["chart-level","enter"]),[{selector:".bar",grouping:{groupBy:"id",position:"start after previous"},effects:[{attribute:"fill",to:"#ffffff",yoyo:!0,duration:1}],labels:["emphasize"],position:"start after previous"}]),ot=function(){let e=JSON.stringify(st);return Ot.from(JSON.parse(e))},lt=(new Qe("highlight-bar","Highlight bar",ot,Ze.BAR_CHART,["bars","emphasize"]),[{selector:".axis.domain,.axis.tick,.axis-label",effects:[{type:"fade",mode:"in",duration:1.5}],labels:["enter"],position:"start after previous"},{selector:".axis.label",effects:[{type:"scale",mode:"in",ease:"back.out",duration:1}],labels:["enter"],position:"start with previous",offset:.2},{selector:".bar",effects:[{type:"grow",direction:"up",ease:"power1.inOut",duration:1.5}],labels:["enter"],position:"start after previous",offset:-1},{selector:".bar-label",effects:[{type:"fade",mode:"in",duration:1}],labels:["enter"],position:"start after previous"}]),ct=function(){let e=JSON.stringify(lt);return Ot.from(JSON.parse(e))},dt=(new Qe("bar chart-2","Bar chart enter 2",ct,Ze.BAR_CHART,["chart-level","enter"]),[{selector:{selector:".bar",sort:[{attr:"height",order:"asc"},{attr:"x",order:"dec"}],range:[0,3,2]},grouping:{groupBy:"id",position:"start after previous"},effects:[{attribute:"fill",to:"#ffffff",yoyo:!0,duration:1}],labels:["emphasize"],position:"start after previous"}]),ut=function(){let e=JSON.stringify(dt);return Ot.from(JSON.parse(e))},ht=(new Qe("test-template","Test template",ut,Ze.BAR_CHART,["test"]),[{selector:".bar,.bar-label",grouping:{groupByIndex:!0,position:"start after previous",grouping:{groupBy:"id",position:"start with previous",stagger:.1}},effects:[{attribute:"y",to:"-10",yoyo:!0,duration:1}],labels:["emphasize"],position:"start after previous"}]),pt=function(){let e=JSON.stringify(ht);return Ot.from(JSON.parse(e))},gt=(new Qe("bar-bounce","Bar bounce",pt,Ze.BAR_CHART,["bars","emphasize"]),[{selector:".axis.domain,.axis.tick,.axis-label",effects:[{type:"fade"}],labels:["enter"]},{selector:".axis.label",effects:[{type:"scale",ease:"back.out"}],labels:["enter"],offset:.2},{selector:".mark.line, .legend-group",grouping:{groupByIndex:!0,stagger:1},effects:[{type:"fade"}],labels:["enter"],position:"start after previous"},{selector:".group.line-mark",grouping:{groupByReg:"series\\-\\d",stagger:1,grouping:{groupBy:"id",stagger:.2}},effects:[{type:"fade"}],labels:["enter"]}]),mt=function(){let e=JSON.stringify(gt);return Ot.from(JSON.parse(e))},ft=(new Qe("line-chart-basic-enter","Line chart enter",mt,Ze.LINE_CHART,["chart-level","enter"]),[{selector:".axis.domain,.axis.tick,.axis-label",effects:[{type:"fade"}],labels:["enter"]},{selector:".axis.label",effects:[{type:"scale",ease:"back.out"}],labels:["enter"],offset:.2},{selector:".group.line-mark",grouping:{groupByReg:"series\\-\\d",stagger:1,grouping:{groupBy:"id",stagger:.2}},effects:[{type:"fade"}],labels:["enter"],position:"start after previous"},{selector:".mark.line, .legend-group",grouping:{groupByIndex:!0,stagger:1},effects:[{type:"wipe",direction:"right"}],labels:["enter"]}]),wt=function(){let e=JSON.stringify(ft);return Ot.from(JSON.parse(e))},yt=(new Qe("line-chart-basic-enter-2","Line chart enter 2",wt,Ze.LINE_CHART,["chart-level","enter"]),[$e,Pe,Se,Me,Je,Xe]);class bt{constructor(){Object(me["a"])(this,"effectMap",new Map),this.registerPresetEffects()}registerPresetEffects(){yt.forEach(e=>{this.registerEffect(e)})}registerEffect(e){return this.effectMap.has(e.type)?alert(`Effect ${e.type} exists. Register failed.`):this.effectMap.set(e.type,e),this}getEffect(e){let t=this.effectMap.get(e);return t||console.log("No such effect",e),new ye(Object(fe["a"])(),t.type,t.genFunc,t.duration,t.offset,t.defaults,t.effLabels)}}const xt=new bt,vt={AFTER:"start after previous",WITH:"start with previous"},_t={groupBy:"id",position:vt.WITH,offset:0};function Tt(e){try{if(e=we(e),e.attribute){let t=null,a=null;void 0!==e.from&&(t={},t[e.attribute]=e.from),void 0!==e.to&&(a={},a[e.attribute]=e.to);let r=null!==a?a:t;e.ease&&(r.ease=e.ease),e.svgOrigin&&(r.svgOrigin=e.svgOrigin),e.transformOrigin&&(r.transformOrigin=e.transformOrigin),e.yoyo&&(r.yoyo=e.yoyo,r.repeatDelay=e.yoyoDelay||0,r.repeat=1,e.duration/=2),console.log("custom",t,a);let i=()=>new xe({from:t,to:a}),n=new ye(Object(fe["a"])(),e.type,i,e.duration,e.offset,{},e.effLabels||[]);return n.custom=e,n}{let t=xt.getEffect(e.type);return t||console.error("No such effect: "+e.type),e.duration&&(t.duration=e.duration),e.offset&&(t.offset=e.offset),e.effLabels&&(t.effLabels=e.effLabels),delete e.type,delete e.duration,delete e.offset,delete e.effLabels,t.config=e,t}}catch(t){console.error(t)}}function Et(e){return e.map(e=>e instanceof ye?e:Tt(e))}function St(e){if(!e)return we(_t);let t=e;while(t.grouping)t=t.grouping;return"id"!==t.groupBy&&(t.grouping=we(_t)),e}class At{constructor({aniUnitId:e,selector:t,grouping:a=null,effects:r=[],labels:i=[],position:n=null,offset:s=0}){Object(me["a"])(this,"aniUnitId",void 0),Object(me["a"])(this,"selector",void 0),Object(me["a"])(this,"grouping",void 0),Object(me["a"])(this,"effects",void 0),Object(me["a"])(this,"labels",void 0),Object(me["a"])(this,"position",void 0),Object(me["a"])(this,"offset",void 0),this.aniUnitId=e,this.selector=t,this.grouping=St(a),this.effects=Et(r),this.labels=i,this.position=n,this.offset=s}toJsonObj(){return{aniUnitId:this.aniUnitId,selector:this.selector,grouping:we(this.grouping),effects:this.effects.map(e=>e.toJsonObj()),labels:we(this.labels),position:this.position,offset:this.offset}}static from(e){try{return e.aniUnitId||(e.aniUnitId=Object(fe["a"])()),new At(e)}catch(t){console.error(t)}}}class Nt{constructor(e){Object(me["a"])(this,"templateId",void 0),this.templateId=e}}class Ot extends Nt{constructor(...e){super(...e),Object(me["a"])(this,"aniUnits",[]),Object(me["a"])(this,"aniUnitMap",new Map)}addAniUnit(e){this.aniUnits.push(e),this.aniUnitMap.set(e.aniUnitId,e)}toJsonObj(){let e={aniUnits:[]};return this.aniUnits.forEach(t=>{e.aniUnits.push(t.toJsonObj())}),e}static from(e){try{let t=new Ot;return e.forEach(e=>{let a=At.from(e);t.addAniUnit(a)}),t}catch(t){console.error(t)}}}class Rt{constructor(){Object(me["a"])(this,"use",void 0),Object(me["a"])(this,"configs",void 0)}}function Mt(e){const t=new Rt;return t.use=e.use,t.configs=e.configs,t}function Ct(e){const t={};return Object.keys(e).forEach(a=>t[a]=e[a]),t}const It={from:Mt,jsonify:Ct};class Lt{constructor(){Object(me["a"])(this,"constructorMap",new Map)}register(e){this.constructorMap.set(e.templateId,e.constructor)}createAniTemplate(e){const t=this.constructorMap.get(e);return null==t?null:new t}}class kt{constructor(e,t,a=Ze.UNKNOWN,r=[],i={}){Object(me["a"])(this,"templateId",void 0),Object(me["a"])(this,"name",void 0),Object(me["a"])(this,"type",void 0),Object(me["a"])(this,"tempLabels",void 0),Object(me["a"])(this,"defaults",void 0),Object(me["a"])(this,"configs",void 0),this.templateId=e,this.name=t,this.type=a,this.tempLabels=r,this.defaults=i}getMergedConfigs(){let e=we(this.configs)||{};return Object.keys(this.defaults).forEach(t=>{void 0===e[t]&&(e[t]=this.defaults[t])}),e}createInstance(){return console.error("Not implement"),null}checkValid(){return console.error("Not implement"),!1}}function Pt(e,t){null!=e&&Bt(e,t)}function Bt(e,t){if(null==e||"object"!==typeof e)return!1;for(let a of Object.keys(e)){const r=e[a];let i=t(a,r,e);if(i)return!0;Bt(r,t)}return!1}const jt={traversalObject:Pt};class Gt{constructor(){Object(me["a"])(this,"$slotId",void 0)}static isSlot(e){return null!=e&&"object"===typeof e&&Array.from(Object.keys(e)).includes("$slot")}static toSlotObject(e){let t=new Gt;return Object.keys(e).forEach(a=>{t[a]=e[a]}),t}}function Dt(e,t){let a=e.indexOf(t);return-1!==a&&(e.splice(a,1),!0)}function Ut(e){let t=e.length;return 0===t?null:e[t-1]}function $t(e,t){return t.every(t=>e.includes(t))}function Ht(e,t,a,r=1){let i=[];for(let n=t;n<a;n+=r)i.push(e[n]);return i}function Ft(e,t){let a=[];return e.forEach(e=>{t.includes(e)&&a.push(e)}),a}const Vt={removeItem:Dt,getLastItem:Ut,includes:$t,slice:Ht,intersect:Ft};class Wt extends kt{constructor(e,t,a,r,i){super(e,t,Ze.UNKNOWN,a,r),Object(me["a"])(this,"canisTemplate",void 0),Object(me["a"])(this,"metaData",void 0),this.canisTemplate=i}createInstance(){this.metaData=we(this.canisTemplate);const e=this.getMergedConfigs(),t=this.getSlotInfoList();for(let r of t){const t=e[r.slot["$slot"]];void 0!==t&&(r.object[r.key]=t)}const a=Ot.from(this.metaData);return a.templateId=this.templateId,a}checkValid(){const e=this.getMergedConfigs(),t=this.getSlotInfoList();return Vt.includes(Array.from(e.keys()),t.map(e=>e.slot["$slot"]))}getSlotInfoList(){const e=[];return jt.traversalObject(this.metaData,(t,a,r)=>{Gt.isSlot(a)&&e.push({object:r,key:t,slot:a})}),e}}const Jt="bar chart",qt="Bar Chart Enter Template",zt=["chart-level","enter"],Kt={"bar-grow-direction":"up"},Yt=[{selector:".axis.domain.x",effects:[{type:"grow",direction:"right",ease:"circ.inOut",duration:1.5}],labels:["enter"],position:"start after previous"},{selector:".axis.domain.y",effects:[{type:"grow",direction:"up",ease:"circ.inOut",duration:1.5}],labels:["enter"],position:"start with previous"},{selector:".axis.label,.axis.tick,.axis-label",effects:[{type:"fade",mode:"in",duration:1.5}],labels:["enter"],position:"start after previous"},{selector:".bar",effects:[{type:"grow",direction:{$slot:"bar-grow-direction"},ease:"circ.inOut",duration:1.5}],labels:["enter"],position:"start after previous",offset:-1},{selector:".bar-label",effects:[{type:"fade",mode:"in",duration:1}],labels:["enter","fade-in"],position:"start after previous"},{selector:".decoration.group",effects:[{type:"fade",mode:"in",duration:1}],labels:["enter","fade-in"],position:"start after previous"}];class Xt extends Wt{constructor(){super(Jt,qt,zt,Kt,Yt)}}const Zt="fade",Qt="Fade Template",ea=["??-level","enter"],ta={sorter:[],position:"start after previous",stagger:0,mode:"in"},aa=[{selector:{selector:{$slot:"target"},sort:{$slot:"sorter"}},grouping:{groupBy:"id",position:"start with previous",stagger:{$slot:"stagger"}},effects:[{type:"fade",mode:{$slot:"mode"},duration:1.5}],labels:["fade"],position:{$slot:"position"}}];class ra extends Wt{constructor(){super(Zt,Qt,ea,ta,aa)}}const ia="wipe",na="wipe Template",sa=["??-level","enter"],oa={sorter:[],position:"start after previous",stagger:0,mode:"in",ease:"power1.out",duration:1.5,labels:["wipe"]},la=[{selector:{selector:{$slot:"target"},sort:{$slot:"sorter"}},grouping:{groupBy:"id",position:"start with previous",stagger:{$slot:"stagger"}},effects:[{type:"wipe",direction:{$slot:"direction"},mode:{$slot:"mode"},ease:{$slot:"ease"},duration:{$slot:"duration"}}],labels:{$slot:"labels"},offset:{$slot:"offset"},position:{$slot:"position"}}];class ca extends Wt{constructor(){super(ia,na,sa,oa,la)}}const da="scale",ua="Scale Template",ha=["??-level","enter"],pa={sorter:[],position:"start after previous",stagger:0,offset:0,ease:"power1.out",mode:"in"},ga=[{selector:{selector:{$slot:"target"},sort:{$slot:"sorter"}},grouping:{groupBy:"id",position:"start with previous",stagger:{$slot:"stagger"}},effects:[{type:"scale",mode:{$slot:"mode"},ease:{$slot:"ease"},duration:.5}],labels:["scale"],offset:{$slot:"offset"},position:{$slot:"position"}}];class ma extends Wt{constructor(){super(da,ua,ha,pa,ga)}}const fa="zoom",wa="Zoom Template",ya=["??-level","enter"],ba={offset:0,position:"start after previous",scaleFactor:1.3,transformOrigin:"50% 50%",duration:1,labels:["zoom"]},xa=[{selector:".chart",effects:[{attribute:"scale",to:{$slot:"scaleFactor"},duration:{$slot:"duration"},transformOrigin:{$slot:"transformOrigin"}}],labels:{$slot:"labels"},offset:{$slot:"offset"},position:{$slot:"position"}}];class va extends Wt{constructor(){super(fa,wa,ya,ba,xa)}}const _a="float",Ta="Float Template",Ea=["??-level","enter"],Sa={sorter:[],position:"start after previous",stagger:0,mode:"in",offset:0,duration:1.5,labels:["float"]},Aa=[{selector:{selector:{$slot:"target"},sort:{$slot:"sorter"}},grouping:{groupBy:"id",position:"start with previous",stagger:{$slot:"stagger"}},effects:[{type:"fade",mode:{$slot:"mode"},duration:{$slot:"duration"}},{attribute:"y",from:"+=20",duration:{$slot:"duration"}}],labels:{$slot:"labels"},offset:{$slot:"offset"},position:{$slot:"position"}}];class Na extends Wt{constructor(){super(_a,Ta,Ea,Sa,Aa)}createInstance(){const e=this.getMergedConfigs();if("out"===e.mode){this.canisTemplate=we(this.canisTemplate);const e=this.canisTemplate[0].effects[1];delete e.from,e.to="-=50"}return super.createInstance()}}const Oa=new Lt;Oa.register(new Xt),Oa.register(new ra),Oa.register(new ma),Oa.register(new ca),Oa.register(new va),Oa.register(new Na);class Ra{constructor(e,t){Object(me["a"])(this,"context",void 0),Object(me["a"])(this,"src",void 0),this.context=e,this.src=t}execute(){this.src.templateUsageText&&"[]"!==this.src.templateUsageText?(this.parseTemplateUsage(),console.log("usage ...")):this.parseAnimationText(),this.parseRefinementText(),this.parseConstraintsText(),this.parseAlignConstraintsText()}parseTemplateUsage(){const e=JSON.parse(this.src.templateUsageText),t=new Ot;e.forEach(e=>{const a=It.from(e),r=Oa.createAniTemplate(a.use);r.configs=a.configs,r.createInstance().aniUnits.forEach(e=>{t.addAniUnit(e)})}),this.context.animation=t}parseAnimationText(){let e=JSON.parse(this.src.animationText);this.context.animation=Ot.from(e.aniUnits),console.log("animationText",this.context.animation)}parseRefinementText(){this.context.refinements=JSON.parse(this.src.refinementsText)}parseConstraintsText(){this.context.constraints=JSON.parse(this.src.constraintsText)}parseAlignConstraintsText(){this.context.alignConstraints=JSON.parse(this.src.alignConstraintsText)}}var Ma=a("898b");class Ca{constructor(e,t,a,r){Object(me["a"])(this,"aniAtomId",void 0),Object(me["a"])(this,"context",void 0),Object(me["a"])(this,"effect",void 0),Object(me["a"])(this,"labels",void 0),Object(me["a"])(this,"tween",void 0),this.aniAtomId=e,this.context=t,this.effect=a,this.labels=r}appendTo(e,t){let a=this.effect.generateTween(this.context,this.effect.duration);e.add(a,t),this.tween=a}getAllottedTime(){return this.tween?[this.tween.startTime(),this.tween.endTime()]:null}}const Ia={ANY:"any",CHILD:"child",PARENT:"parent",LAST_SIBLING:"last-sibling",NEXT_SIBLING:"next-sibling",CONSTRAINT:"constraint",CONSTRAINT_REV:"constraint-reverse"};function La(e){switch(e){case Ia.ANY:return Ia.ANY;case Ia.CHILD:return Ia.PARENT;case Ia.PARENT:return Ia.CHILD;case Ia.LAST_SIBLING:return Ia.NEXT_SIBLING;case Ia.NEXT_SIBLING:return Ia.LAST_SIBLING;case Ia.CONSTRAINT:return Ia.CONSTRAINT_REV;default:console.error("Unknown relation",e)}}const ka={UNKNOWN:"unknown",ROOT:"root",UNIT_NODE:"ani-unit-node",INTERNAL_NODE:"internal-node",EL_NODE:"element-node",ATOM_NODE:"ani-atom-node",ADDED_NODE:"added-node"};class Pa{constructor(e,t=ka.UNKNOWN){Object(me["a"])(this,"id",void 0),Object(me["a"])(this,"type",void 0),Object(me["a"])(this,"outEdges",void 0),Object(me["a"])(this,"aniUnits",void 0),Object(me["a"])(this,"elGroup",void 0),Object(me["a"])(this,"aniAtoms",void 0),Object(me["a"])(this,"constraint",void 0),Object(me["a"])(this,"alignCons",void 0),Object(me["a"])(this,"computedPosition",0),Object(me["a"])(this,"computedDuration",0),this.id=e,this.type=t,this.outEdges=[],this.aniUnits=[],this.elGroup=[],this.aniAtoms=[],this.constraint={position:vt.WITH,stagger:0,offset:0,duration:null}}getOutEdges(e=Ia.ANY){return e!==Ia.ANY?(Object.values(Ia).includes(e)||console.error("No such relation: "+e),this.outEdges.filter(t=>t.relation===e)):[...this.outEdges]}getParentNode(){let e=this.getOutEdges(Ia.PARENT)[0];return e?e.dst:(console.error("Get parent failed",this),null)}getChildNodes(){return this.getOutEdges(Ia.CHILD).map(e=>e.dst)}getLastSiblingNode(){let e=this.getOutEdges(Ia.LAST_SIBLING)[0];return e?e.dst:null}getNextSiblingNode(){let e=this.getOutEdges(Ia.NEXT_SIBLING)[0];return e?e.dst:null}computeAbsPosition(){let e;if(this.alignCons)e=this.alignCons.timestamp,this.type===ka.ATOM_NODE&&(this.constraint.offset=0);else{if(this.type===ka.ROOT)return;{let t=this.constraint.offset||0,a=this.getLastSiblingNode();if(a){let r=this.constraint.stagger||0;e=a.getAbsPosition()+t+r,this.constraint.position===vt.AFTER&&(e+=a.getDuration())}else{let a=this.getParentNode();e=a.getAbsPosition()+t}}}this.computedPosition=e}computeDuration(){let e=this.getChildNodes();if(this.type===ka.ATOM_NODE)return void(this.computedDuration=this.aniAtoms[0].effect.duration);if(0===e.length)return;let t=[];e.forEach(e=>{t.push(e.getAbsPosition()),t.push(e.getEndAbsPosition())});let[a,r]=Object(Ma["d"])(t);this.computedPosition=a,this.computedDuration=r-a}getAbsPosition(){return this.computedPosition}getEndAbsPosition(){return this.computedPosition+this.computedDuration}getDuration(){return this.computedDuration}appendAniAtomTo(e){if(this.type!==ka.ATOM_NODE)return void console.error("Append error");let t=this.aniAtoms[0];t.appendTo(e,this.computedPosition);let a=t.getAllottedTime();this.computedPosition=a[0],this.computedDuration=a[1]-a[0]}}class Ba{constructor(e,t,a){Object(me["a"])(this,"id",void 0),Object(me["a"])(this,"src",void 0),Object(me["a"])(this,"dst",void 0),Object(me["a"])(this,"relation",void 0),Object(me["a"])(this,"constraint",void 0),this.id=Ba.getId(e,t),this.src=e,this.dst=t,this.relation=a}static getId(e,t){return`${e.id}-${t.id}`}}class ja{constructor(){Object(me["a"])(this,"nodes",void 0),Object(me["a"])(this,"nodeMap",void 0),Object(me["a"])(this,"edges",void 0),Object(me["a"])(this,"edgeMap",void 0),Object(me["a"])(this,"autoIncrId",0),this.nodes=[],this.nodeMap=new Map,this.edges=[],this.edgeMap=new Map}addNode(e){let t=new Pa(this.autoIncrId++,e);return this.nodes.push(t),this.nodeMap.set(t.id,t),t}addEdgeBothSidesById(e,t,a){let r=this.nodeMap.get(e),i=this.nodeMap.get(a);return r&&i||console.error("Add ConsEdge failed, "+r+" or "+a+" doesn't exist"),this.addEdgeBothSides(r,t,i)}addEdgeBothSides(e,t,a){let r=new Ba(e,a,t),i=new Ba(a,e,La(t)),n=[r,i];return n.forEach(e=>{this.edges.push(e),this.edgeMap.set(e.id,e),e.src.outEdges.push(e)}),n}addParentChildEdge(e,t,a=-1){let r=new Ba(e,t,Ia.CHILD),i=new Ba(t,e,La(Ia.CHILD));this.edges.push(r,i),this.edgeMap.set(r.id,r),this.edgeMap.set(i.id,i),-1!==a?e.outEdges.splice(a,0,r):e.outEdges.push(r),t.outEdges.push(i)}removeSubTree(e){if(e.type===ka.ROOT)return;let t=e.getParentNode();e.aniAtoms.forEach(e=>Vt.removeItem(t.aniAtoms,e)),this.removeEdgeBothSides(e.getOutEdges(Ia.PARENT)[0]);let a=e.getLastSiblingNode(),r=e.getNextSiblingNode();null!==a&&this.removeEdgeBothSides(e.getOutEdges(Ia.LAST_SIBLING)[0]),null!==r&&this.removeEdgeBothSides(e.getOutEdges(Ia.NEXT_SIBLING)[0]),null!==a&&null!==r&&this.addEdgeBothSides(a,Ia.NEXT_SIBLING,r)}mountSubTree(e,t,a){if(e.type===ka.ROOT)return;let r=t.getChildNodes();if(a=Math.max(0,a),a=Math.min(r.length,a),this.addParentChildEdge(t,e,a),0!==r.length)if(a===r.length)this.addEdgeBothSides(Vt.getLastItem(r),Ia.NEXT_SIBLING,e);else if(0===a)this.addEdgeBothSides(e,Ia.NEXT_SIBLING,r[0]);else{let t=r[a-1],i=r[a];this.removeEdgeBothSides(t.getOutEdges(Ia.NEXT_SIBLING)[0]),this.addEdgeBothSides(t,Ia.NEXT_SIBLING,e),this.addEdgeBothSides(e,Ia.NEXT_SIBLING,i)}}removeEdgeBothSides(e){let t=this.edgeMap.get(Ba.getId(e.dst,e.src));Vt.removeItem(this.edges,e),Vt.removeItem(this.edges,t),this.edgeMap.delete(e.id),this.edgeMap.delete(t.id),Vt.removeItem(e.src.outEdges,e),Vt.removeItem(t.src.outEdges,t)}getParentChildByEdge(e){return e.relation===Ia.CHILD?[e.src,e.dst]:e.relation===Ia.PARENT?[e.dst,e.src]:[null,null]}createParentChildRelation(e,t){t.forEach(t=>{this.addParentChildEdge(e,t),e.aniAtoms.push(...t.aniAtoms)});for(let a=0;a<t.length-1;++a){let e=t[a],r=t[a+1];this.addEdgeBothSides(e,Ia.NEXT_SIBLING,r)}}getNodeById(e){return this.nodeMap.get(e)}addAlignMark(e,t,a){e.alignCons={word:t,timestamp:a}}}class Ga{constructor(e,t){Object(me["a"])(this,"animation",void 0),Object(me["a"])(this,"container",void 0),Object(me["a"])(this,"aniAtoms",void 0),Object(me["a"])(this,"root",void 0),Object(me["a"])(this,"consGraph",void 0),Object(me["a"])(this,"atomId2nodeId",void 0),Object(me["a"])(this,"globalAniAtomId",0),this.animation=e,this.container=t,this.aniAtoms=[],this.atomId2nodeId=new Map,this.consGraph=new ja,this.root=this.consGraph.addNode(ka.ROOT)}execute(){let e=[];return this.animation.aniUnits.forEach(t=>{let a=this.createAniUnitNode(t);e.push(a),this.root.elGroup.push(...a.elGroup),this.root.aniUnits.push(t)}),this.consGraph.createParentChildRelation(this.root,e),this}createAniUnitNode(e){let t=this.getElements(this.container,e.selector),a=t.nodes(),r=this.consGraph.addNode(ka.UNIT_NODE);r.elGroup=a,r.aniUnits.push(e),r.constraint=e;let i=this.createChildNodes(e,a,e.grouping);return this.consGraph.createParentChildRelation(r,i),r}getElements(e,t){if("string"===typeof t)return e.selectAll(t);{let a,r=e.selectAll(t.selector).nodes();return void 0!==t.sort&&(t.sort instanceof Array||(t.sort=[t.sort]),t.sort.reverse().forEach(e=>{e.attr?r.sort((t,a)=>t.getAttribute(e.attr)-a.getAttribute(e.attr)):e.data&&r.sort((t,a)=>{const r=e.order.indexOf(t.__data__[e.data]),i=e.order.indexOf(a.__data__[e.data]);return r-i}),"dec"===e.order&&r.reverse()})),void 0!==t.index?a=[r[t.index]]:void 0!==t.range?a=Vt.slice(r,...t.range):void 0!==t.ratioRange?(t.ratioRange[0]*=r.length,t.ratioRange[1]*=r.length,a=Vt.slice(r,...t.ratioRange)):a=r,Ma["l"](a)}}createChildNodes(e,t,a){if(0===t.length)return console.log("No element was selected"),[];let r,i=this.createNewGroups(t,a);return r=a.grouping?i.map(t=>this.createInternalNode(e,t,a)):i.map(t=>this.createElNode(e,t[0],a)),r}createNewGroups(e,t){let a;a=null!=t.groupByClass?e=>{let a=e.getAttribute("class").split(" "),r=t.groupByClass.split(" ");return r.every(e=>a.includes(e))}:null!=t.groupByIndex?e=>{let t=e.getAttribute("class").split(" ");return t.find(e=>null!==e.match(/index-\d*/))}:null!=t.groupByReg?e=>{let a=e.getAttribute("class").split(" ");return a.find(e=>null!==e.match(t.groupByReg))}:e=>e[t.groupBy];let r=new Map;return e.forEach(e=>{let t=a(e);r.has(t)?r.get(t).push(e):r.set(t,[e])}),Array.from(r.values())}createInternalNode(e,t,a){let r=this.consGraph.addNode(ka.INTERNAL_NODE);r.elGroup=t,r.aniUnits.push(e),r.constraint=we(a);let i=this.createChildNodes(e,t,a.grouping);return this.consGraph.createParentChildRelation(r,i),r}createElNode(e,t,a){let r=this.consGraph.addNode(ka.EL_NODE);r.elGroup.push(t),r.aniUnits.push(e),r.constraint=we(a);let i=[];const n={target:t,container:this.container};return e.effects.forEach(a=>{let r=this.globalAniAtomId++,s=new Ca(r,n,a,e.labels);this.aniAtoms.push(s);let o=this.consGraph.addNode(ka.ATOM_NODE);o.elGroup.push(t),o.aniAtoms.push(s),o.constraint.offset=a.offset,o.constraint.duration=a.duration,this.atomId2nodeId.set(s.aniAtomId,o.id),i.push(o)}),this.consGraph.createParentChildRelation(r,i),r}getResult(){return{aniAtoms:this.aniAtoms,atomId2nodeId:this.atomId2nodeId,root:this.root,consGraph:this.consGraph}}}class Da{constructor(e){Object(me["a"])(this,"context",void 0),Object(me["a"])(this,"aniAtoms",void 0),Object(me["a"])(this,"atomId2nodeId",void 0),Object(me["a"])(this,"root",void 0),Object(me["a"])(this,"consGraph",void 0),Object(me["a"])(this,"trvStatusMap",void 0),this.context=e}execute(){console.log("generator",this),this.processRefinement(),this.createConsGraph(),this.processRefinementPart2(),this.processConstraints(),this.applyWordConstraint(),this.generateTimeline()}createConsGraph(){let e=new Ga(this.context.animation,this.context.container);e.execute();let t=e.getResult();this.aniAtoms=t.aniAtoms,this.atomId2nodeId=t.atomId2nodeId,this.root=t.root,this.consGraph=t.consGraph,console.log(t)}getRelatedAniAtoms(e){let t,a;if("string"===typeof e){let r=e.match(/(.*)::([^~]*)(~(.*))?/);t=this.getElements(r[1]),a=r[2].split(",")}else t=this.getElements(e.element),a=e.animation.split(",");return t=t.nodes(),this.aniAtoms.filter(e=>{if(!t.includes(e.context.target))return!1;let r=e.labels.concat(e.effect.effLabels);return Vt.includes(r,a)})}peekAtomNodes(e){return e.map(e=>this.getConsNodeByAniAtomId(e.aniAtomId))}peekMergedNodes(e){let t=e.map(e=>this.getConsNodeByAniAtomId(e.aniAtomId)),a=!0;while(a){if(a=!1,1===t.length&&t[0].type===ka.ROOT)break;for(let e of[...t]){let r=e.getParentNode();if(!r)continue;let i=r.getChildNodes();if(Vt.includes(t,i)){i.forEach(e=>Vt.removeItem(t,e)),t.push(r),a=!0;break}}}return t}getConsNodeByAniAtomId(e){let t=this.atomId2nodeId.get(e);return this.consGraph.getNodeById(t)}getElements(e){if("string"===typeof e)return this.context.container.selectAll(e);{let t,a=this.context.container.selectAll(e.selector).nodes();return void 0!==e.sort&&(e.sort instanceof Array||(e.sort=[e.sort]),e.sort.forEach(e=>{e.attr?a.sort((t,a)=>t.getAttribute(e.attr)-a.getAttribute(e.attr)):e.data&&a.sort((t,a)=>{const r=e.order.indexOf(t.__data__[e.data]),i=e.order.indexOf(a.__data__[e.data]);return r-i}),"dec"===e.order&&a.reverse()})),void 0!==e.index?t=[a[e.index]]:void 0!==e.range?t=Vt.slice(a,...e.range):void 0!==e.ratioRange?(e.ratioRange[0]*=a.length,e.ratioRange[1]*=a.length,t=Vt.slice(a,...e.ratioRange)):t=a,Ma["l"](t)}}processRefinement(){this.context.refinements.forEach(e=>{switch(e.type){case"add":{let t={...e};delete t.type,this.context.animation.addAniUnit(At.from(t)),console.log("refinement %o, %o",t,this.context.animation)}break}})}processRefinementPart2(){this.context.refinements.forEach(e=>{switch(e.type){case"remove":{let t=this.getRelatedAniAtoms(e.selector),a=this.peekMergedNodes(t);a.forEach(e=>this.consGraph.removeSubTree(e))}break;case"set":if("animation"===e.target){let t=this.getRelatedAniAtoms(e.selector),a=this.peekMergedNodes(t);a.forEach(t=>{null!=e.stagger&&(t.constraint.stagger=e.stagger),null!=e.position&&(t.constraint.position=e.position)}),null!=e.atomPosition&&this.peekAtomNodes(t).forEach(t=>{let a;while(t.type!==ka.ROOT&&(a=t.getParentNode())&&1===a.getChildNodes().length)t=a;t.constraint.position=e.atomPosition})}else if("element"===e.target){let t=this.getElements(e.selector);null!=e.attrSetter&&t.call(t=>{Object.keys(e.attrSetter).forEach(a=>{t.attr(a,e.attrSetter[a])})}),null!=e.styleSetter&&t.call(t=>{Object.keys(e.styleSetter).forEach(a=>{t.style(a,e.styleSetter[a])})})}break}})}processConstraints(){this.context.constraints.forEach(e=>{let t=this.getRelatedAniAtoms(e.selector1),a=this.getRelatedAniAtoms(e.selector2);if(0===t.length||0===a.length)return void console.error("Constraint is invalid",t,a);let r,i,n=this.peekMergedNodes(t),s=this.peekMergedNodes(a);if("start before"===e.relation){r=this.findNodeInPostOrder(s,0),n.forEach(e=>this.consGraph.removeSubTree(e)),1===n.length?i=n[0]:(i=this.consGraph.addNode(ka.ADDED_NODE),this.consGraph.createParentChildRelation(i,n));let t=r.getParentNode(),a=t.getChildNodes().indexOf(r);this.consGraph.mountSubTree(i,t,a),r.constraint.position=vt.AFTER,r.constraint.offset=e.offset||0}else if("start after"===e.relation){r=this.findNodeInPostOrder(s,s.length-1),n.forEach(e=>this.consGraph.removeSubTree(e)),1===n.length?i=n[0]:(i=this.consGraph.addNode(ka.ADDED_NODE),this.consGraph.createParentChildRelation(i,n));let t=r.getParentNode(),a=t.getChildNodes().indexOf(r);this.consGraph.mountSubTree(i,t,a+1),i.constraint.position=vt.AFTER,i.constraint.offset=e.offset||0}else if("start with"===e.relation){r=this.findNodeInPostOrder(s,s.length-1),n.forEach(e=>this.consGraph.removeSubTree(e)),1===n.length?i=n[0]:(i=this.consGraph.addNode(ka.ADDED_NODE),this.consGraph.createParentChildRelation(i,n));let t=r.getParentNode(),a=t.getChildNodes().indexOf(r);this.consGraph.mountSubTree(i,t,a+1),i.constraint.position=vt.WITH,i.constraint.offset=e.offset||0}})}findNodeInPostOrder(e,t){let a=null,r=new Set;e.forEach(e=>r.add(e.id));let i=function e(i){if(r.has(i.id)&&t--<=0)return a=i,!0;let n=i.getChildNodes();for(let t of n)if(e(t))return!0;return!1};return i(this.root),a}applyWordConstraint(){this.context.alignConstraints.forEach(e=>{if(!e.selector||""===e.selector)return;let t=this.getRelatedAniAtoms(e.selector);t.forEach(t=>{let a=this.atomId2nodeId.get(t.aniAtomId),r=this.consGraph.getNodeById(a);this.consGraph.addAlignMark(r,e.word,e.timestamp)}),console.log("alignment",e,t)})}generateTimeline(){let e=this.context.timeline;null!=e&&this.clearTimeline(e),e=be["b"].timeline({repeat:0,onUpdate:this.context.onUpdateFunc}),this.context.timeline=e,e.pause(),this.traversal(e),e.progress(this.getEnterFinishedProgress(e))}traversal(e){let t,a=[this.root],r=null;while(0!==a.length){t=a[a.length-1];let i=t.getChildNodes();(t.type===ka.ATOM_NODE||0!==i.length&&r!==i[i.length-1])&&(t.computeAbsPosition(),i.reverse(),a.push(...i)),t.type!==ka.ATOM_NODE&&0!==i.length&&r!==i[i.length-1]||(t.type===ka.ATOM_NODE?t.appendAniAtomTo(e):t.computeAbsPosition(),t.computeDuration(),r=t,a.pop())}}allConstraintsClear(e){let t=e.getOutEdges(Ia.CONSTRAINT_REV);return t.every(e=>{let t=this.trvStatusMap.get(e.dst.id);return void 0!==t&&"ok"===t.code})}clearTimeline(e){e.kill(),e.progress(this.getEnterFinishedProgress(e)),e.clear()}getEnterFinishedProgress(e){if(0===e.duration())return 0;let t=this.getRelatedAniAtoms(".sdfasfd::enter"),a=Ma["e"](t,e=>e.getAllottedTime()[1]);return a?a/e.duration():0}}var Ua=a("bc3a"),$a=a.n(Ua);function Ha(e,t,a,r){$a.a.post(e,t).then(e=>{a(e)}).catch(e=>{r(e)})}function Fa(e,t,a){let r="http://tts.baidu.com/text2audio";$a.a.get(r,{params:e}).then(e=>{t(e)}).catch(e=>{a(e)})}function Va(e,t,a){let r="../../data/audio/"+e;$a.a.get(r).then(e=>{t(e)}).catch(e=>{a(e)})}const Wa=()=>({svgFileName:"characteristics-of-mushrooms.svg",context:null,tlUpdateSign:!1,templateUsageText:"[]",animationText:"[]",refinementsText:"[]",constraintsText:"[]",alignConstraintsText:"[]",refinementEnable:!1,constraintEnable:!1,alignConsEnable:!1,audioEl:null,audioSrc:"",audioReady:!1,useAudio:!0,setAudioReadyFunc:null,renderingSign:!1,url:"https://cxl-services.appspot.com/proxy?url=https://texttospeech.googleapis.com/v1beta1/text:synthesize&token=03AGdBq27DaxcABwq_0pTZClIUmToiLE2mvyLHZ1g2Eq2fJdP4ISGp3ukTZA9XC5CX6laO4lmFunh9B-TgqFkg7jFe6C1N0l980uRYmFIgmj2kQ1MJxajd_a5KQa7QsrMmPUUgTW-9eJLxS861gPa0BlfBsvCJ_Un1YNy3_pDrTiQsqdEliT00UHUGYsMOZBz2qX4W-wSvFLFPLaXgz3y-LrXenKx7YHmRhDbzswTqcwepdlrtmXtW8Wnkx6CmYJn0ZDWbtEYeZMTGqQDLgME42uLeyE5UyoeQ0sVS9lgGQqBZNqi6uXxsaI7cBptLrkVJJYwTrqS5i_pwdBni-FM4yKVbPkjqeovxkQtgjg-YwIsrRYBP2EhZoxKI_mFa6B-uPlAWH2Xlb-XQk2s_efZ5dCp_HB0Y6F8-9-l4a71PvPq8HtdACWkpPne_Dsmn-5-8_NhreFJNwr8eHChc8WbnOA5nI5wX7jds6IzElduQo5ct3UeeLoFOpVaRdjBY20aQ2o9MQueQ6qn8"}),Ja={},qa={queryTTSAudioGoogle(e,{el:t}){e.commit("changeAudioReady",!1);let a={};e.state.context.ssml?a.ssml=e.state.context.ssml:a.text=e.state.context.text;const r={audioConfig:{audioEncoding:"LINEAR16",pitch:0,speakingRate:.8},input:a,voice:{languageCode:"en-US",name:"en-US-Wavenet-D"}};Ha(e.state.url,r,a=>{console.log("audio rep",a);const r="data:audio/wav;base64,"+a.data.audioContent;e.commit("setAudioSrc",r);const i=new Blob([r],{type:"text/plain;charset=utf-8"});console.log(e.state.context),t.$saveAs(i,(e.state.context.ctxName||"tts")+".txt"),t.$message({message:"Generate audio successfully",type:"success"})},e=>{console.error(e),t.$message({message:"Fail to generate audio",type:"fail"})})},queryTTSAudioBaidu(e,{el:t,text:a}){e.commit("changeAudioReady",!1);const r={lan:"en",ie:"UTF-8",spd:1,text:a};Fa(r,a=>{console.log("audio rep",a);const r="data:audio/mp3;base64,"+a.data;e.commit("setAudioSrc",r),t.$message({message:"Generate audio successfully",type:"success"})},e=>{console.error(e),t.$message({message:"Fail to generate audio",type:"fail"})})},queryStaticAudio({state:e,commit:t},a){t("changeAudioReady",!1),e.context?Va(e.context.ctxName+".txt",e=>{t("setAudioSrc",e.data)},e=>{a.$notify({title:"Fail to get static audio.",message:e.message,type:"error"}),console.log(e)}):a.$notify({title:"Fail to get static audio.",message:"Context are not loaded",type:"warning"})},initContext({commit:e,dispatch:t},{context:a,el:r}){e("changeContext",a),t("queryStaticAudio",r)}},za={compile(e,t){e.context.onUpdateFunc=t,e.audioEl&&(e.context.audioDuration=e.audioEl.duration);let a=new Ra(e.context,{templateUsageText:e.templateUsageText,animationText:e.animationText,refinementsText:e.refinementEnable?e.refinementsText:"[]",constraintsText:e.constraintEnable?e.constraintsText:"[]",alignConstraintsText:e.alignConsEnable?e.alignConstraintsText:"[]"});try{a.execute()}catch(i){return alert(i),void console.error(i)}let r=new Da(e.context);try{r.execute()}catch(i){return alert(i),void console.error(i)}e.tlUpdateSign^=!0},addTemplate(e,t){e.context.templateUsage.push({use:t.id}),e.context.addTemplate(t);const a=e.context.getAnimationJsonObj();console.log("aniJsonObj",a),e.animationText=JSON.stringify(a,null,2),e.templateUsageText=JSON.stringify(e.context.templateUsage,null,2)},emptyAnimation(e){e.context.templateUsage=[],e.context.emptyAnimation();let t=e.context.getAnimationJsonObj();e.animationText=JSON.stringify(t,null,2),e.templateUsageText=JSON.stringify(e.context.templateUsage,null,2)},changeContext(e,t){e.context=t,console.log("vuex ",t);let a=t.getAnimationJsonObj();e.templateUsageText=JSON.stringify(t.templateUsage,null,2),e.animationText=JSON.stringify(a,null,2),e.refinementsText=JSON.stringify(t.refinements,null,2),e.constraintsText=JSON.stringify(t.constraints,null,2),e.alignConstraintsText=JSON.stringify(t.alignConstraints,null,2)},changeTemplateText(e,t){e.templateUsageText=t},changeAnimationText(e,t){e.animationText=t},changeRefinementsText(e,t){e.refinementsText=t},changeConstraintsText(e,t){e.constraintsText=t},changeAlignConstraintsText(e,t){e.alignConstraintsText=t},changeRefinementEnable(e,t){e.refinementEnable=t},changeConstraintEnable(e,t){e.constraintEnable=t},changeAlignConsEnable(e,t){e.alignConsEnable=t},enableAllSettings(e){e.refinementEnable=!0,e.constraintEnable=!0,e.alignConsEnable=!0},changeUseAudio(e,t){e.useAudio=t},changeRenderingSign(e){e.renderingSign^=!0},registerAudioEl(e,t){e.audioEl=t},setAudioSrc(e,t){e.audioSrc=t,console.log("load audio src"),e.setAudioReadyFunc?e.audioEl.removeEventListener("canplaythrough",e.setAudioReadyFunc,!1):e.setAudioReadyFunc=function(){e.audioReady=!0},e.audioReady=!0,e.audioEl.addEventListener("canplaythrough",e.setAudioReadyFunc,!1)},changeAudioReady(e,t){e.audioReady=t}};var Ka={namespaced:!0,state:Wa,getters:Ja,actions:qa,mutations:za};a("5b81");class Ya{constructor(){Object(me["a"])(this,"charts",[]),Object(me["a"])(this,"imports",[]),Object(me["a"])(this,"targetDefs",[]),Object(me["a"])(this,"templates",[]),Object(me["a"])(this,"animation",void 0)}}var Xa=a("7891"),Za=a("52d4"),Qa=a("95d5");class er{static reviver(e,t){return""===e?er.fromJSON(t):t}static fromJSON(e){if(null==e||"object"!==typeof e)return null;switch(e.type){case"filter":return Object.assign(new Za["a"],e);case"sort":return Object.assign(new Qa["a"],e);default:return console.warn("Unsupported transform type "+e.type),null}}static fromObjectOrArray(e){if(null==e||"object"!==typeof e)return[];Array.isArray(e)||(e=[e]);const t=e.map(e=>er.fromJSON(e));return t.filter(e=>null!=e),t}}class tr{static reviver(e,t){return""===e?tr.fromJSON(t):t}static fromJSON(e){if(null==e||""===e)return Xa["b"].getDefaultTarget();if("string"===typeof e)return new Xa["a"](e);if("object"!==typeof e)return Xa["b"].getDefaultTarget();if("selector"in e||"transform"in e&&1===Object.keys(e).length){const t=er.fromObjectOrArray(e.transform);return Object.assign(Xa["b"].getDefaultTarget(),e,{transform:t})}throw"Target type is not supported"}}var ar=a("f720");class rr extends ar["a"]{constructor(e=[]){super(),Object(me["a"])(this,"sequence",void 0),this.type="sync",this.sequence={sync:e}}append(e){return this.sequence.sync.push(e),this}computeDuration(e){var t;const{yoyo:a}=this.timing.getComputedTiming();if(null!==(t=this.timing)&&void 0!==t&&t.duration)return this.timing.duration;let r=0;return this.sequence.sync.forEach(t=>{var a,i;const n=t.computeDuration(e.deriveBy(this.target));r=Math.max(r,n+(null!==(a=t.timing.start)&&void 0!==a?a:0)+(null!==(i=t.timing.offset)&&void 0!==i?i:0))}),a?r*(a.repeat+1)+a.delay*a.repeat:r}computePossibleElements(e){const t=new Set;return this.sequence.sync.forEach(a=>{const r=a.computePossibleElements(e.deriveByWithoutTransform(this.target));r.forEach(e=>t.add(e))}),t}create(e){var t;const a=be["a"].timeline();this.sequence.sync.forEach(t=>{const r=t.create(e.deriveBy(this.target));null!==r&&a.add(r,t.timing.startPlusOffset())});const{yoyo:r}=this.timing.getComputedTiming();return null!==(t=this.timing)&&void 0!==t&&t.duration&&a.duration(this.timing.duration),r&&(a.yoyo(!0),a.repeat(r.repeat),a.repeatDelay(r.delay)),a}}class ir extends ar["a"]{constructor(e=[]){super(),Object(me["a"])(this,"sequence",void 0),this.type="concat",this.sequence={concat:e}}append(e){return this.sequence.concat.push(e),this}computeDuration(e){var t;const{yoyo:a}=this.timing.getComputedTiming();if(null!==(t=this.timing)&&void 0!==t&&t.duration)return this.timing.duration;let r=0;return this.sequence.concat.forEach(t=>{var a;const i=t.computeDuration(e.deriveBy(this.target));r=Math.max(r,r+i+(null!==(a=t.timing.offset)&&void 0!==a?a:0))}),a?r*(a.repeat+1)+a.delay*a.repeat:r}computePossibleElements(e){const t=new Set;return this.sequence.concat.forEach(a=>{const r=a.computePossibleElements(e.deriveByWithoutTransform(this.target));r.forEach(e=>t.add(e))}),t}create(e){var t;const a=be["a"].timeline();this.sequence.concat.forEach(t=>{var r;const i=t.create(e.deriveBy(this.target));null!==i&&a.add(i,">"+(null!==(r=t.timing.offset)&&void 0!==r?r:0))});const{yoyo:r}=this.timing.getComputedTiming();return null!==(t=this.timing)&&void 0!==t&&t.duration&&a.duration(this.timing.duration),r&&(a.yoyo(!0),a.repeat(r.repeat),a.repeatDelay(r.delay)),a}}class nr extends ar["a"]{constructor(){super(),Object(me["a"])(this,"sequence",void 0),this.type="group"}computePossibleElements(e){return new Set}create(e){const t=be["a"].timeline();return t}}class sr extends ar["a"]{constructor(e="",t={}){super(t),Object(me["a"])(this,"use",void 0),this.use=e,this.type="usage"}useTemplate(e){return this.use=e,this}computeDuration(e){var t,a;const{yoyo:r}=this.timing.getComputedTiming();if(null!==(t=this.timing)&&void 0!==t&&t.duration)return this.timing.duration;const i=this.instantiateUsingTemplate(e);let n=null!==(a=null===i||void 0===i?void 0:i.computeDuration(e.deriveBy(this.target)))&&void 0!==a?a:0;return r?n*(r.repeat+1)+r.delay*r.repeat:n}computePossibleElements(e){const t=this.instantiateUsingTemplate(e,!1);return t?t.computePossibleElements(e.deriveByWithoutTransform(this.target)):new Set}create(e){var t;const a=this.instantiateUsingTemplate(e);if(!a)return null;const r=a.create(e.deriveBy(this.target)),{yoyo:i}=this.timing.getComputedTiming();return null!==(t=this.timing)&&void 0!==t&&t.duration&&r.duration(this.timing.duration),i&&(r.yoyo(!0),r.repeat(i.repeat),r.repeatDelay(i.delay)),r}instantiateUsingTemplate(e,t=!0){if(!this.use||""===this.use)return null;const a=e.getTemplate(this.use);return null!=a?a.instantiate(this.settings,t):(console.warn(`Template ${this.use} not found.`),null)}}var or=a("5e48"),lr=a.n(or),cr=a("0764");class dr{static reviver(e,t){return""===e?dr.fromJSON(t):t}static fromJSON(e){return"string"===typeof e?lr.a.parse(e,dr.reviver):"sequence"in e?dr.createSequenceAnimation(e):"use"in e?dr.createTemplateUsage(e):null}static createSequenceAnimation(e){var t;let a,r;if("sync"in e.sequence&&Array.isArray(e.sequence.sync))a=new rr,r={sync:e.sequence.sync.map(e=>dr.fromJSON(e))};else if("concat"in e.sequence&&Array.isArray(e.sequence.concat))a=new ir,r={concat:e.sequence.concat.map(e=>dr.fromJSON(e))};else{if(!("animation"in e.sequence))return console.warn("create sequence animation failed",e),null;a=new nr,r={grouping:e.sequence.grouping,animation:dr.fromJSON(e.sequence.animation)}}const i=tr.fromJSON(e.target),n=Object.assign(a.timing,null!==(t=e.timing)&&void 0!==t?t:{});return!0===n.yoyo&&(n.yoyo=cr["a"].getDefaultYoyo()),Object.assign(a,e,{target:i,sequence:r,timing:n})}static createTemplateUsage(e){var t,a;const r=new sr,i=tr.fromJSON(e.target),n=Object.assign(r.timing,null!==(t=e.timing)&&void 0!==t?t:{});!0===n.yoyo&&(n.yoyo=cr["a"].getDefaultYoyo());const s=Object.assign(r.settings,null!==(a=e.settings)&&void 0!==a?a:{});return Object.assign(r,e,{target:i,timing:n,settings:s})}}var ur=a("4b58");function hr(e,t){null!=e&&pr(e,t)}function pr(e,t){if(null==e||"object"!==typeof e)return!1;for(let a of Object.keys(e)){const r=e[a];let i=t(a,r,e);if(i)return!0;pr(r,t)}return!1}function gr(e){if(void 0===e||null===e)return e;let t=Array.isArray(e)?[]:{};for(let a in e)t[a]="object"===typeof e[a]?gr(e[a]):e[a];return void 0!==e.prototype&&(t.prototype=e.prototype),t}const mr={traversalObject:hr,deepCopy:gr};class fr extends ar["a"]{constructor(){super(),this.type="empty"}computeDuration(e){return 0}computePossibleElements(e){return new Set}create(e){return null}}class wr extends ur["a"]{constructor(e=null){super(),Object(me["a"])(this,"animation",void 0),this.animation=e,this.type="json"}createAnimation(){if(!this.animation)return new fr;const e=JSON.parse(JSON.stringify(this.animation)),t=this.settings;return mr.traversalObject(e,(e,a,r)=>{if("string"===typeof a&&a.includes("$"))if(a=a.trim(),a.match(/^\$[0-9a-zA-Z]*$/)){const i=a.substr(1);i in t&&(r[e]=t[i])}else{let i=a;Object.keys(t).forEach(e=>{i=i.replaceAll("$"+e,t[e])}),r[e]=i}}),dr.fromJSON(e)}}var yr=a("a979");class br{static reviver(e,t){return""===e?br.fromJSON(t):t}static fromJSON(e){if("string"===typeof e)return lr.a.parse(e,br.reviver);{const t=new yr["a"];return Object.assign(t,e)}}}class xr{static reviver(e,t){return""===e?xr.fromJSON(t):t}static fromJSON(e){if("string"===typeof e)return lr.a.parse(e,xr.reviver);if("object"!==typeof e)return null;const t=new wr;let a;return a=e.parameters&&Array.isArray(e.parameters)?e.parameters.map(e=>br.fromJSON(e)):[],Object.assign(t,e,{parameters:a})}}class vr{static reviver(e,t){return""===e?vr.fromJSON(t):t}static fromJSON(e){if("string"===typeof e)return lr.a.parse(e,vr.reviver);{const t=new Ya;let a;a=e.templates&&Array.isArray(e.templates)?e.templates.map(e=>xr.fromJSON(e)):[];const r=dr.fromJSON(e.animation);return Object.assign(t,e,{templates:a,animation:r})}}}class _r{constructor(){Object(me["a"])(this,"json",void 0)}init(e){this.json=e}parse(){return vr.fromJSON(this.json)}}class Tr{constructor(e,t,a,r=!1){Object(me["a"])(this,"renderContext",void 0),Object(me["a"])(this,"parentSelection",void 0),Object(me["a"])(this,"fakeRender",void 0),Object(me["a"])(this,"parentTarget",void 0),this.renderContext=e,this.parentSelection=t,this.parentTarget=a,this.fakeRender=r}derive(e,t){return new Tr(this.renderContext,e,t,this.fakeRender)}deriveBy(e){const t=this.getSelection(e);var a,r;0!==this.parentSelection.size()&&0===t.size()&&console.warn(`Empty select result. \n      parentSelector=${null!==(a=null===(r=this.parentTarget)||void 0===r?void 0:r.selector)&&void 0!==a?a:"null"} \n      selector="${e.selector}"`,this);return this.derive(t,e)}deriveByWithoutTransform(e){if(e.selector.includes("$"))return this.derive(this.parentSelection);{const t=this.getSelectionWithoutTransform(e);return this.derive(t,e)}}getGlyphs(e){return this.fakeRender?this.getSelection(e).nodes().map(e=>e.cloneNode(!0)):this.getSelection(e).nodes()}getExclusiveGlyphs(e,t){let a=this.renderContext.targetModel.getExclusiveGlyphs(this.renderContext.rootSel.selectAll(t),this.parentTarget).nodes();return this.fakeRender?a.map(e=>e.cloneNode(!0)):a}getBBoxPosition(e){var t,a,r;const i=this.renderContext.rootSel,n=null!==(t=i.select("svg").node())&&void 0!==t?t:i.node(),s=n.createSVGPoint(),o=null!==(a=null===(r=e._original)||void 0===r?void 0:r.CTM)&&void 0!==a?a:e.getCTM(),l=s.matrixTransform(o),c=e.getBBox();var{x:d,y:u,width:h,height:p}={x:l.x,y:l.y,width:c.width,height:c.height};if("text"===e.nodeName)switch(e.getAttribute("text-anchor")){case"start":u-=.75*p;break;case"end":d-=h,u-=.75*p;break;case"middle":d-=h/2,u-=.75*p;break;default:break}else"path"===e.nodeName&&(u+=p/2);return{x:d,y:u,width:h,height:p}}getSelection(e){return this.renderContext.targetModel.getGlyphs(this.parentSelection,e)}getSelectionWithoutTransform(e){return this.renderContext.targetModel.getGlyphsWithoutTransform(this.parentSelection,e)}getTemplate(e){return this.renderContext.templateLib.getTemplate(e)}getRootSel(){return this.renderContext.rootSel}getDefsSel(){return this.renderContext.getDefsSel()}getRootSvg(){const e=this.renderContext.rootSel.node();return"svg"===e.tagName?e:e.querySelector("svg")}}var Er=a("ba84");class Sr{constructor(e,t){Object(me["a"])(this,"rootSel",void 0),Object(me["a"])(this,"defsSel",void 0),Object(me["a"])(this,"templateLib",void 0),Object(me["a"])(this,"globalSelection",void 0),Object(me["a"])(this,"targetModel",void 0),this.rootSel=e,this.defsSel=null,this.templateLib=t,this.globalSelection=e.selectAll("*")}getTemplate(e){return this.templateLib.getTemplate(e)}createRootContext(e=!1){return new Tr(this,this.globalSelection,null,e)}clean(){this.defsSel&&!this.defsSel.empty()&&(this.defsSel.selectAll(Er["c"]).remove(),this.defsSel.selectAll(Er["a"]).remove())}getDefsSel(){if(!this.defsSel){let e=this.rootSel.select("defs");e.empty()&&(e=this.rootSel.append("defs")),this.defsSel=e}return this.defsSel}}class Ar{constructor(){Object(me["a"])(this,"globalSelection",void 0)}getGlyphs(e,t){throw"Target model is abstract"}getGlyphsWithoutTransform(e,t){throw"Target model is abstract"}}class Nr extends Ar{constructor(e){super(),Object(me["a"])(this,"globalSelection",void 0),this.globalSelection=e}getGlyphsWithoutTransform(e,t){return e.filter(t.selector)}getGlyphs(e,t){let a=e.filter(t.selector);return t.transform.forEach(e=>{a=e.execute(a)}),a}getExclusiveGlyphs(e,t){let a=e.filter(`:not(${t.selector})`);return t.transform.forEach(e=>{a=e.execute(a)}),a}}class Or{constructor(){Object(me["a"])(this,"renderContext",void 0),Object(me["a"])(this,"animationSpec",void 0)}init(e,t,a){this.renderContext=new Sr(e,t),this.animationSpec=a}generate(){this.renderContext.targetModel=new Nr(this.renderContext.globalSelection),this.renderContext.clean();const e=this.renderContext.createRootContext();return this.animationSpec.create(e)}computeDuration(){this.renderContext.targetModel=new Nr(this.renderContext.globalSelection),this.renderContext.clean();const e=this.renderContext.createRootContext(!0);return this.animationSpec.computeDuration(e)}computePossibleElements(e){const t=this.renderContext.getTemplate(e);if(!t)return new Set;const a=t.instantiate({},!1);this.renderContext.targetModel=new Nr(this.renderContext.globalSelection),this.renderContext.clean();const r=this.renderContext.createRootContext(!0);return a.computePossibleElements(r)}}class Rr{constructor(){Object(me["a"])(this,"buildInTemplateMap",void 0),Object(me["a"])(this,"templateMap",void 0),this.buildInTemplateMap=new Map,this.templateMap=new Map}registerBuildInTemplate(e){this.buildInTemplateMap.has(e.templateName)&&console.warn("Duplicated template name in build-in scope"+e.templateName),this.buildInTemplateMap.set(e.templateName,e)}registerBuildInTemplates(...e){e.forEach(e=>this.registerBuildInTemplate(e))}registerTemplate(e){this.templateMap.has(e.templateName)&&console.warn("Duplicated template name in custom scope"+e.templateName),this.templateMap.set(e.templateName,e)}registerTemplates(...e){e.forEach(e=>this.registerTemplate(e))}getTemplate(e){var t;const a=null!==(t=this.templateMap.get(e))&&void 0!==t?t:this.buildInTemplateMap.get(e);return a?a.clone():null}getAllBuildInTemplates(){return Array.from(this.buildInTemplateMap.values())}getAllCustomTemplate(){return Array.from(this.templateMap.values())}reset(){this.templateMap=new Map}}const Mr={CUSTOM:"custom",TITLE:"title",BLANK:"blank",GENERAL:"general",HIGHLIGHT:"highlight",MOVE:"move",PATH:"path",TEXT:"text",CAMERA:"camera",ANNOTATION_ARROW:"annotation-arrow",BAR_CHART:"bar-chart",BAR_CHART_WITH_LEGEND:"bar-chart-with-legend",CIRCLE_CHART:"circle-chart",CIRCLE_CHART_WITH_LEGEND:"circle-chart-with-legend",PIE_CHART:"pie-chart",PIE_WITH_LEGEND:"pie-with-legend",LINE_CHART:"line-chart",LINE_CHART_WITH_LEGEND:"line-chart-with-legend",CHART_FRAMEWORK:"chart-framework"},Cr={ENTER:"Enter",EXIT:"Exit",HIGHLIGHT:"Emphasis",ANNOTATION:"Annotate",OTHER:"Other"};class Ir{constructor(e,t=Mr.BLANK,a=Cr.OTHER,r=[],i={},n,s=1,o={}){Object(me["a"])(this,"template",void 0),Object(me["a"])(this,"previewerType",void 0),Object(me["a"])(this,"animationType",void 0),Object(me["a"])(this,"templateLabels",void 0),Object(me["a"])(this,"templateSettings",void 0),Object(me["a"])(this,"target",void 0),Object(me["a"])(this,"staticProgress",void 0),Object(me["a"])(this,"previewSettings",void 0),this.type="previewer",this.template=e,this.previewerType=t,this.animationType=a,this.templateLabels=r,this.templateSettings=i,this.previewSettings=o,this.staticProgress=s,n?n instanceof Xa["b"]?this.target=n:this.target=tr.fromJSON(n):this.target=Xa["b"].getDefaultTarget()}clone(){return new Ir(this.template.clone(),this.previewerType,this.animationType,[...this.templateLabels],mr.deepCopy(this.templateSettings),Object.assign(new Xa["b"],this.target),this.staticProgress,mr.deepCopy(this.previewSettings))}getTemplateName(){return this.template.templateName}getTemplateType(){return this.template.type}getTemplateParameters(){return this.template.parameters}createPreviewAnimation(){return null!=this.template?this.template.instantiate(this.templateSettings):(console.warn("Can't create animation since preview template is null"),null)}}class Lr{constructor(e){Object(me["a"])(this,"templateLib",void 0),Object(me["a"])(this,"previewWrapperMap",void 0),Object(me["a"])(this,"previewerMap",void 0),this.templateLib=e,this.previewWrapperMap=new Map,this.previewerMap=new Map}registerPreviewWrapper(e){this.previewWrapperMap.set(e.template.templateName,e)}registerPreviewer(e){this.previewerMap.set(e.previewerType,e)}createDefaultPreviewer(e,t){const a=this.getDefaultWrapper(e),r=new Sr(t,this.templateLib);r.targetModel=new Nr(r.globalSelection);const i=this.previewerMap.get(a.previewerType).clone();return i.init(a,r),i}getDefaultWrapper(e){var t;let a=null===(t=this.previewWrapperMap.get(e))||void 0===t?void 0:t.clone();if(!a){const t=this.templateLib.getTemplate(e);a=new Ir(t)}return a}}var kr=a("618e"),Pr=a("c66e");class Br extends kr["a"]{constructor(){super(),this.templateName="Fade-in",this.parameters=[new yr["a"]("duration",Pr["a"].NUMBER,!1,.5),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0)]}createAnimation(){const e=new sr("Fade");return e.updateSettings(this.getParamValues()),e.updateSettings({fadeType:"in"}),e}}var jr=a("2bc8");const Gr={TOP:"top",BOTTOM:"bottom",LEFT:"left",RIGHT:"right",CENTER:"center",UNKNOWN:"unknown",AUTO:"auto"};class Dr extends kr["a"]{constructor(){super(),this.templateName="Grow",this.parameters=[new yr["a"]("direction",Pr["a"].STRING,!1,Gr.BOTTOM),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0)]}createAnimation(){const e=new Ur;return e.updateSettings(this.getParamValues()),e}}class Ur extends jr["a"]{getDefaultSettings(){return{direction:Gr.BOTTOM,ease:"power1.out",stagger:0,duration:1}}create(e){const{stagger:t}=this.settings,a=e.getGlyphs(this.target),r=be["a"].timeline();return a.forEach((e,a)=>{const i=this.createTwForOneGlyph(e),n=0===a?0:"<"+t;r.add(i,n)}),r}createTwForOneGlyph(e){const{direction:t,ease:a,duration:r}=this.settings,i=e.getBBox();let n,s,o;switch(t){case Gr.TOP:n="scaleY",s=.5,o=0;break;case Gr.BOTTOM:n="scaleY",s=.5,o=1;break;case Gr.LEFT:n="scaleX",s=0,o=.5;break;case Gr.RIGHT:n="scaleX",s=1,o=.5;break;default:return null}const l=`${s*i.width}px ${o*i.height}px`,c={transformOrigin:l,duration:r,ease:a};return c[n]=0,be["a"].from(e,c)}}class $r extends kr["a"]{constructor(){super(),this.templateName="Move-to",this.parameters=[new yr["a"]("x",Pr["a"].ANY,!1,"+=0"),new yr["a"]("y",Pr["a"].ANY,!1,"+=0"),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0),new yr["a"]("yoyo",Pr["a"].OBJECT,!1,null)]}createAnimation(){const e=new sr("move"),t={x:this.getParamValue("x"),y:this.getParamValue("y")};return e.set("to",t),e.set("duration",this.getParamValue("duration")),e.set("ease",this.getParamValue("ease")),e.set("stagger",this.getParamValue("stagger")),e.set("yoyo",this.getParamValue("yoyo")),e}}class Hr extends kr["a"]{constructor(){super(),this.templateName="Move-from",this.parameters=[new yr["a"]("x",Pr["a"].ANY,!1,"+=0"),new yr["a"]("y",Pr["a"].ANY,!1,"+=0"),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0)]}createAnimation(){const e=new sr("move"),t={x:this.getParamValue("x"),y:this.getParamValue("y")};return e.set("from",t),e.set("duration",this.getParamValue("duration")),e.set("ease",this.getParamValue("ease")),e.set("stagger",this.getParamValue("stagger")),e}}class Fr extends kr["a"]{constructor(){super(),this.templateName="Float",this.parameters=[new yr["a"]("enterOrExit",Pr["a"].STRING,!1,"enter"),new yr["a"]("direction",Pr["a"].STRING,!1,"bottom"),new yr["a"]("distance",Pr["a"].NUMBER,!1,30),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0)]}createAnimation(){const e=new Vr;return e.updateSettings(this.getParamValues()),e}}class Vr extends jr["a"]{create(e){const{enterOrExit:t,distance:a,direction:r,ease:i,stagger:n,duration:s}=this.settings,o=r===Gr.LEFT||r===Gr.RIGHT?"x":"y",l=r===Gr.RIGHT||r===Gr.BOTTOM?1:-1;let c;const d=e.getGlyphs(this.target),u={opacity:0,ease:i,duration:s,stagger:n};if("enter"===t)u[o]=`+=${a*l}px`,c=be["a"].from(d,u);else{if("exit"!==t)return console.warn("Wrong value of enterOrExit: "+t),null;u[o]=`-=${a*l}px`,c=be["a"].to(d,u)}return c}}class Wr extends kr["a"]{constructor(){super(),this.templateName="basic-zoom",this.parameters=[new yr["a"]("enterOrExit",Pr["a"].STRING,!1,"enter"),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"back.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0)]}createAnimation(){const e=new Jr;return e.updateSettings(this.getParamValues()),e}}class Jr extends jr["a"]{getDefaultSettings(){return{enterOrExit:"enter",ease:"power1.out",stagger:0,duration:1}}create(e){const{enterOrExit:t,ease:a,stagger:r}=this.settings,i=be["a"].timeline(),n=e.getGlyphs(this.target);return n.forEach(e=>{let n;const s={scale:0,transformOrigin:"center center",ease:a};if("enter"===t)n=be["a"].from(e,s);else{if("exit"!==t)return console.warn("Wrong value of enterOrExit: "+t),null;n=be["a"].to(e,s)}const{duration:o,yoyo:l}=this.timing.getComputedTiming();n.duration(o),l&&(n.yoyo(!0),n.repeat(l.repeat),n.repeatDelay(l.delay)),i.add(n,"<"+r)}),i}}class qr extends kr["a"]{constructor(){super(),this.templateName="Zoom",this.parameters=[new yr["a"]("enterOrExit",Pr["a"].STRING,!1,"enter"),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("FadeEase",Pr["a"].STRING,!1,"power1.inOut"),new yr["a"]("zoomEase",Pr["a"].STRING,!1,"back.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0)]}createAnimation(){const e=this.getParamValue("enterOrExit");if("enter"===e){const e=new sr("Fade-in").set("ease",this.getParamValue("FadeEase")).set("duration",this.getParamValue("duration")).set("stagger",this.getParamValue("stagger")),t=new sr("Basic-zoom-enter").set("ease",this.getParamValue("zoomEase")).set("duration",this.getParamValue("duration")).set("stagger",this.getParamValue("stagger"));return new rr([e,t])}if("exit"===e){const e=new sr("Fade-out").set("ease",this.getParamValue("FadeEase")).set("duration",this.getParamValue("duration")).set("stagger",this.getParamValue("stagger")),t=new sr("basic-zoom-exit").set("ease",this.getParamValue("zoomEase")).set("duration",this.getParamValue("duration")).set("stagger",this.getParamValue("stagger"));return new rr([e,t])}return console.warn("Wrong value of param enterOrExit",e),null}}var zr=a("8bce");class Kr extends kr["a"]{constructor(){super(),this.templateName="Wipe",this.parameters=[new yr["a"]("enterOrExit",Pr["a"].STRING,!1,"enter"),new yr["a"]("direction",Pr["a"].STRING,!1,Gr.BOTTOM),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0),new yr["a"]("yoyo",Pr["a"].OBJECT,!1,null)]}createAnimation(){const e=new Yr;return e.updateSettings(this.getParamValues()),e}}class Yr extends jr["a"]{create(e){const t=e.getGlyphs(this.target),a=e.getDefsSel(),r=be["a"].timeline(),{stagger:i}=this.settings;return t.forEach((e,t)=>{const n=this.addMaskRectToGlyph(a,e),s=this.createTwForMask(n,e),o=0===t?0:"<"+i;r.add(s,o)}),r}addMaskRectToGlyph(e,t){var a;t.getAttribute("id")||t.setAttribute("id",Object(zr["a"])());const r="mask-"+t.getAttribute("id");let i=e.select("#"+r);i.empty()&&(i=e.append("mask").attr("id",r).classed(Er["c"],!0).attr("maskUnits","userSpaceOnUse"),t.setAttribute("mask",`url(#${r})`));const{enterOrExit:n}=this.settings,s=i.select(".wipe");if(!s.empty()&&"exit"===n)return s.node();const o=t.getBBox();let l,c,d,u,h=parseFloat(null!==(a=t.getAttribute("stroke-width"))&&void 0!==a?a:"0");Ma["k"](t).selectAll("*").each((function(){var e;const t=parseFloat(null!==(e=this.getAttribute("stroke-width"))&&void 0!==e?e:"0");h=Math.max(t,h)})),d=o.width+2*h,u=o.height+2*h,l=o.x-h,c=o.y-h;const p=i.append("rect").attr("transform","translate("+[l,c]+")").attr("class","Wipe").attr("width",d).attr("height",u).attr("stroke-width",h).attr("fill","white").attr("stroke","white");return p.node()}createTwForMask(e,t){const{enterOrExit:a,direction:r,ease:i,duration:n,yoyo:s}=this.settings,o=e.getBBox();let l,c;switch(r){case Gr.TOP:l=0,c=-1;break;case Gr.BOTTOM:l=0,c=1;break;case Gr.LEFT:l=-1,c=0;break;case Gr.RIGHT:l=1,c=0;break}const d=parseFloat(t.getAttribute("stroke-width")||"0"),u={x:"+="+l*(o.width+d),y:"+="+c*(o.height+d),duration:n,ease:i};var h,p;s&&(u.yoyo=!0,u.repeatDelay=null!==(h=s.delay)&&void 0!==h?h:0,u.repeat=null!==(p=s.repeat)&&void 0!==p?p:1);return"exit"===a?be["a"].to(e,u):be["a"].from(e,u)}}const Xr="ac-original-data--",Zr="@original-fill";class Qr extends kr["a"]{constructor(){super(),this.templateName="Change-color",this.parameters=[new yr["a"]("fill",Pr["a"].STRING,!0,"#ff0000"),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0),new yr["a"]("yoyo",Pr["a"].OBJECT,!0,null)]}createAnimation(){const e=new ei;return e.updateSettings(this.getParamValues()),e}}class ei extends jr["a"]{getDefaultSettings(){return{duration:1,ease:"power1.out",stagger:0,yoyo:null}}create(e){const{stagger:t}=this.settings,a=e.getGlyphs(this.target),{duration:r,yoyo:i}=this.timing.getComputedTiming(),n=be["a"].timeline();return a.forEach((e,a)=>{const r=this.createTwForOneGlyph(e);i&&(r.yoyo(!0),r.repeat(i.repeat),r.repeatDelay(i.delay));const s=0===a?0:"<"+t;n.add(r,s)}),n.duration(r),n}createTwForOneGlyph(e){let{fill:t,duration:a,ease:r,yoyo:i}=this.settings;const n={};i&&(!0===i&&(i=cr["a"].getDefaultYoyo()),n.yoyo=!0,n.repeat=i.repeat,n.repeatDelay=i.delay,a/=n.repeat+1);const s=Xr+"color";if(t===Zr)t=e.getAttribute(s);else{const t=e.getAttribute("fill");e.setAttribute(s,t)}const o=["line","tick","rule","circle"];var l={fill:t,duration:a,ease:r,...n};if(o.indexOf(e.tagName)>0)l={stroke:t,duration:a,ease:r,...n};else if("path"===e.tagName){const i=e.getAttribute("class");o.forEach(e=>{i.includes(e)&&(l={stroke:t,duration:a,ease:r,...n})})}return be["a"].to(e,l)}}class ti extends kr["a"]{constructor(){super(),this.templateName="Show-path",this.parameters=[new yr["a"]("reverseDirection",Pr["a"].BOOLEAN,!1,!1),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0),new yr["a"]("displayTime",Pr["a"].NUMBER,!1,3)]}createAnimation(){const e=new ai;return e.updateSettings(this.getParamValues()),e}}class ai extends jr["a"]{create(e){const{displayTime:t,ease:a,stagger:r,duration:i,reverseDirection:n}=this.settings,s=be["a"].timeline(),o=e.getGlyphs(this.target);return o.forEach((e,o)=>{let l,c=0;try{c=e.getTotalLength()}catch(d){}e.setAttribute("stroke-dasharray",c),l=be["a"].fromTo(e,{strokeDashoffset:n?-c:c},{strokeDashoffset:0,ease:a,duration:i}),s.add(l,0===o?0:"<"+r),l=be["a"].to(e,{strokeDashoffset:n?c:-c,ease:a,duration:i}),s.add(l,"+="+t)}),s}}class ri extends kr["a"]{constructor(){super(),this.templateName="Highlight",this.parameters=[new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0)]}createAnimation(){const e=new ii;return e.updateSettings(this.getParamValues()),e}}class ii extends jr["a"]{getDefaultSettings(){return{duration:1,ease:"power1.out",stagger:0}}create(e){const{ease:t,stagger:a,duration:r}=this.settings;let i;const n=e.getGlyphs(this.target);let s=null;for(let u of n){let e=Vt.getLastItem(u.classList);if(null===s)s=e;else if(s!=e){s=null;break}}let o=null===s?"*":`.${s}, .mark`;const l=e.getExclusiveGlyphs(this.target,o),c={opacity:.13,ease:t,duration:.5,stagger:a},d=be["a"].timeline();return i=be["a"].to(l,c),i.yoyo(!0),i.repeat(1),i.repeatDelay(3),d.add(i,0),d}}class ni extends kr["a"]{constructor(){super(),this.templateName="Camera-zoom",this.parameters=[new yr["a"]("scaleFactor",Pr["a"].STRING,!1,1.5),new yr["a"]("transformOrigin",Pr["a"].STRING,!1,"50% 50%"),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new si;return e.updateSettings(this.getParamValues()),e}}class si extends jr["a"]{getDefaultSettings(){return{transformOrigin:"50% 50%",duration:1,ease:"power1.out"}}create(e){const{scaleFactor:t,transformOrigin:a,ease:r,duration:i}=this.settings;let n;const s=e.renderContext.rootSel,o={scale:t,transformOrigin:a,ease:r,duration:i};return n=be["a"].to(s.node(),o),n}}var oi={templateName:"Zoom-exit",parameters:[{paramName:"duration",paramType:"number",required:!1,defaultValue:.5},{paramName:"zoomEase",paramType:"string",required:!1,defaultValue:"back.in"},{paramName:"FadeEase",paramType:"string",required:!1,defaultValue:"power1.inOut"},{paramName:"stagger",paramType:"string",required:!1,defaultValue:0}],animation:{use:"Zoom",target:"*",settings:{duration:"$duration",zoomEase:"$zoomEase",fadeEase:"$fadeEase",stagger:"$stagger",enterOrExit:"exit"}}},li={templateName:"basic-zoom-exit",parameters:[{paramName:"duration",paramType:"number",required:!1,defaultValue:1},{paramName:"ease",paramType:"string",required:!1,defaultValue:"back.in"},{paramName:"stagger",paramType:"number",required:!1,defaultValue:0}],animation:{use:"basic-zoom",target:"*",settings:{duration:"$duration",ease:"$ease",stagger:"$stagger",enterOrExit:"exit"}}};class ci extends kr["a"]{constructor(){super(),this.templateName="Fade-out",this.parameters=[new yr["a"]("duration",Pr["a"].NUMBER,!1,.5),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0)]}createAnimation(){const e=new sr("Fade");return e.updateSettings(this.getParamValues()),e.updateSettings({fadeType:"out"}),e}}class di extends kr["a"]{constructor(){super(),this.templateName="Shine",this.parameters=[]}createAnimation(){const e=new sr("Change-color").updateSettings({fill:"#fff",yoyo:!0,stagger:.03});return(new rr).append(e)}}class ui extends kr["a"]{constructor(){super(),this.templateName="Title",this.parameters=[new yr["a"]("titleStagger",Pr["a"].NUMBER,!1,.3)]}createAnimation(){const e=new sr("Fade-in").setTarget(".title,.subtitle,.main-title,.sub-title").set("stagger",this.getParamValue("titleStagger"));return(new rr).append(e)}}class hi extends kr["a"]{constructor(){super(),this.templateName="Axes float in",this.parameters=[new yr["a"]("titleStagger",Pr["a"].NUMBER,!1,.2),new yr["a"]("symbolStagger",Pr["a"].NUMBER,!1,.04),new yr["a"]("axisElementStagger",Pr["a"].NUMBER,!1,.04),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new sr("Float").setTarget(".title").set("stagger",this.getParamValue("titleStagger")),t=new sr("Float").setTarget(".axis.symbol").set("stagger",this.getParamValue("symbolStagger")),a=new sr("Fade-in").setTarget(".x-axis.domain").updateSettings({ease:this.getParamValue("ease")}),r=new sr("Fade-in").setTarget(".y-axis.domain").updateSettings({ease:this.getParamValue("ease")}),i=new sr("Float").setTarget(".axis.label").set("stagger",this.getParamValue("axisElementStagger")).updateTiming({offset:1}),n=new sr("Fade-in").setTarget(".axis.tick").set("stagger",this.getParamValue("axisElementStagger")).updateTiming({offset:1});return(new rr).append(e).append(t).append(a).append(r).append(i).append(n)}}var pi={templateName:"Axes fade in",animation:{target:"*",sequence:{sync:[{use:"Fade-in",target:".title, .subtitle, .axis, .tick-group"}]}}};class gi extends kr["a"]{constructor(){super(),this.templateName="Bar chart",this.parameters=[new yr["a"]("barDirection",Pr["a"].STRING,!1,"bottom"),new yr["a"]("titleStagger",Pr["a"].NUMBER,!1,.2),new yr["a"]("symbolStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("axisElementStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new sr("Axes fade in").setTarget(".chart").updateSettings(this.getParamValues()),t=new sr("Grow").setTarget(".bar").updateTiming({offset:1}).updateSettings({ease:this.getParamValue("ease"),direction:this.getParamValue("barDirection")}),a=new sr("Fade-in").setTarget(".bar-label,.label").updateTiming({offset:2});return(new rr).append(e).append(t).append(a)}}class mi extends kr["a"]{constructor(){super(),this.templateName="Bar chart with legend",this.parameters=[new yr["a"]("barDirection",Pr["a"].STRING,!1,"bottom"),new yr["a"]("titleStagger",Pr["a"].NUMBER,!1,.2),new yr["a"]("symbolStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("axisElementStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new sr("Axes fade in").setTarget(".chart").updateSettings(this.getParamValues()),t=new sr("Fade-in").setTarget(".legend").updateTiming({offset:1}).updateSettings({stagger:.25}),a=new sr("Grow").setTarget(".bar").updateTiming({offset:1}).updateSettings({ease:this.getParamValue("ease"),direction:this.getParamValue("barDirection"),stagger:.25}),r=new sr("Fade-in").setTarget(".bar-label,.label").updateTiming({offset:2});return(new rr).append(e).append(t).append(a).append(r)}}class fi extends kr["a"]{constructor(){super(),this.templateName="Scatter chart with legend",this.parameters=[new yr["a"]("titleStagger",Pr["a"].NUMBER,!1,.2),new yr["a"]("symbolStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("axisElementStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new sr("Axes fade in").setTarget(".chart").updateSettings(this.getParamValues()),t=new sr("Fade-in").setTarget(".legend").updateTiming({offset:1}),a=new sr("Fade-in").setTarget(".circle, .point, .scatter").updateTiming({offset:2}).updateSettings({stagger:.02}),r=new sr("Fade-in").setTarget(".circle-label").updateTiming({offset:3});return(new rr).append(e).append(t).append(a).append(r)}}class wi extends kr["a"]{constructor(){super(),this.templateName="Line chart",this.parameters=[new yr["a"]("titleStagger",Pr["a"].NUMBER,!1,.2),new yr["a"]("symbolStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("axisElementStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("duration",Pr["a"].NUMBER,!1,1.5)]}createAnimation(){const e=new sr("Axes fade in").setTarget(".chart").updateSettings(this.getParamValues()),t=new sr("Fade-in").setTarget(".circle, .point, .scatter").updateTiming({offset:1}).set("duration",this.getParamValue("duration")),a=new sr("Wipe").setTarget(".mark.line").updateTiming({start:1}).updateSettings({stagger:.5,ease:this.getParamValue("ease"),direction:"left"}),r=new sr("Fade-in").setTarget(".mark.label").updateTiming({start:1}).updateSettings({stagger:.1});return(new rr).append(e).append(t).append(a).append(r)}}class yi extends kr["a"]{constructor(){super(),this.templateName="Line chart by legend",this.parameters=[new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("duration",Pr["a"].NUMBER,!1,1.5)]}createAnimation(){const e=new sr("Axes fade in").setTarget(".chart").updateSettings(this.getParamValues()),t=new sr("Fade-in").setTarget(".legend").updateTiming({offset:1}).updateSettings({stagger:.25}),a=new sr("Fade-in").setTarget(".circle, .point, .scatter").updateTiming({offset:1}).set("duration",this.getParamValue("duration")),r=new sr("Wipe").setTarget(".mark.line").updateTiming({offset:1}).updateSettings({stagger:.5,ease:this.getParamValue("ease"),direction:"left"});return(new rr).append(e).append(t).append(a).append(r)}}class bi extends kr["a"]{constructor(){super(),this.templateName="Line chart by order",this.parameters=[new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("duration",Pr["a"].NUMBER,!1,1.5)]}createAnimation(){const e=new sr("Axes fade in").setTarget(".chart").updateSettings(this.getParamValues()),t=new sr("Fade-in").setTarget(".legend").updateTiming({offset:1}),a=new sr("Fade-in").setTarget(".circle, .point, .scatter").updateTiming({offset:1}).set("duration",this.getParamValue("duration")),r=new sr("Wipe").setTarget(".mark.line").updateTiming({offset:1}).updateSettings({ease:this.getParamValue("ease"),direction:"left"});return(new rr).append(e).append(t).append(a).append(r)}}class xi extends kr["a"]{constructor(){super(),this.templateName="Pie-wheel",this.parameters=[new yr["a"]("titleStagger",Pr["a"].NUMBER,!1,.2),new yr["a"]("sectorStagger",Pr["a"].NUMBER,!1,.1),new yr["a"]("lineStagger",Pr["a"].NUMBER,!1,.1),new yr["a"]("labelStagger",Pr["a"].NUMBER,!1,.1)]}createAnimation(){const e=new sr("Fade-in").setTarget(".title").set("stagger",this.getParamValue("titleStagger")),t=new sr("simple-sector-wheel").setTarget(".sector,.arc,.pie").set("centerSelector",".sector,.arc,.pie").set("stagger",this.getParamValue("sectorStagger")),a=new sr("Draw-path").setTarget(".sector-line,.arc-line").set("stagger",this.getParamValue("lineStagger")),r=new sr("Fade-in").setTarget(".sector-label,.arc-label").set("stagger",this.getParamValue("labelStagger"));return(new rr).append(e).append(t).append(a).append(r)}}class vi extends kr["a"]{constructor(){super(),this.templateName="Bar-grow",this.parameters=[new yr["a"]("barDirection",Pr["a"].STRING,!1,"auto"),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new sr("Grow-bar").setTarget(".bar").updateSettings({ease:this.getParamValue("ease"),direction:this.getParamValue("barDirection")}),t=new sr("Fade-in").setTarget(".bar-label,.label").updateTiming({offset:1});return(new rr).append(e).append(t)}}class _i extends kr["a"]{constructor(){super(),this.templateName="Bar with legend",this.parameters=[new yr["a"]("barDirection",Pr["a"].STRING,!1,"bottom"),new yr["a"]("titleStagger",Pr["a"].NUMBER,!1,.2),new yr["a"]("symbolStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("axisElementStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new sr("Fade-in").setTarget(".legend").updateSettings({stagger:.25}),t=new sr("Bar-grow").setTarget(".bar").updateSettings({ease:this.getParamValue("ease"),direction:this.getParamValue("barDirection"),stagger:.25}),a=new sr("Fade-in").setTarget(".bar-label,.label").updateTiming({offset:1});return(new rr).append(e).append(t).append(a)}}class Ti extends kr["a"]{constructor(){super(),this.templateName="Bar with axis label",this.parameters=[new yr["a"]("symbol-ease",Pr["a"].STRING,!1,"back.out"),new yr["a"]("bar-ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("duration",Pr["a"].NUMBER,!1,1.5)]}createAnimation(){const e=new sr("basic-zoom").setTarget(".axis.symbol").updateSettings({ease:this.getParamValue("symbol-ease"),duration:this.getParamValue("duration")}),t=new sr("Fade-in").setTarget(".x-axis.label").set("duration",this.getParamValue("duration")),a=new sr("Grow").setTarget(".bar").updateSettings({ease:this.getParamValue("bar-ease"),duration:this.getParamValue("duration")}),r=new sr("Fade-in").setTarget(".bar-label,.label").set("duration",this.getParamValue("duration"));return(new rr).append(e).append(t).append(a).append(r)}}class Ei extends kr["a"]{constructor(){super(),this.templateName="Scatter-fade in",this.parameters=[new yr["a"]("duration",Pr["a"].NUMBER,!1,1.5),new yr["a"]("titleStagger",Pr["a"].NUMBER,!1,.2),new yr["a"]("symbolStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("axisElementStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new sr("Fade-in").setTarget(".circle, .point, .scatter").set("duration",this.getParamValue("duration")),t=new sr("Fade-in").setTarget(".circle-label,.point-label,.scatter-label").set("duration",this.getParamValue("duration"));return(new rr).append(e).append(t)}}class Si extends kr["a"]{constructor(){super(),this.templateName="Scatter with legend",this.parameters=[new yr["a"]("titleStagger",Pr["a"].NUMBER,!1,.2),new yr["a"]("symbolStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("axisElementStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new sr("Fade-in").setTarget(".legend"),t=new sr("Fade-in").setTarget(".circle, .point, .scatter").updateTiming({offset:1}).updateSettings({stagger:.02}),a=new sr("Fade-in").setTarget(".circle-label,.point-label,.scatter-label").updateTiming({offset:2});return(new rr).append(e).append(t).append(a)}}class Ai extends kr["a"]{constructor(){super(),this.templateName="Scatter chart",this.parameters=[new yr["a"]("titleStagger",Pr["a"].NUMBER,!1,.2),new yr["a"]("symbolStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("axisElementStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new sr("Axes fade in").setTarget(".chart").updateSettings(this.getParamValues()),t=new sr("Fade-in").setTarget(".circle, .point, .scatter").updateTiming({offset:1}),a=new sr("Fade-in").setTarget(".circle-label").updateTiming({offset:2});return(new rr).append(e).append(t).append(a)}}a("13d5");function Ni(e,t){const a=e.createSVGPoint(),r=t.getCTM(),i=a.matrixTransform(r);return{x:i.x,y:i.y}}function Oi(e,t){const a=Ni(e,t),{x:r,y:i,width:n,height:s}=t.getBBox();return{x:r+a.x,y:i+a.y,width:n,height:s}}class Ri extends kr["a"]{constructor(){super(),this.templateName="Grow-bar",this.parameters=[new yr["a"]("barDirection",Pr["a"].STRING,!1,"auto"),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new Mi;return e.updateSettings(this.getParamValues()),e}}class Mi extends jr["a"]{getDefaultSettings(){return{direction:Gr.AUTO,ease:"power1.out",stagger:0,duration:1}}create(e){const{stagger:t,direction:a}=this.settings,r=e.getGlyphs(this.target),i=be["a"].timeline();return a===Gr.AUTO&&(this.settings.direction=this.inferDirection(e)),r.forEach((e,a)=>{const r=this.createTwForOneGlyph(e),n=0===a?0:"<"+t;i.add(r,n)}),i}createTwForOneGlyph(e){const{ease:t,duration:a,direction:r}=this.settings,i=e.getBBox();let n,s,o;switch(r){case Gr.TOP:n="scaleY",s=.5,o=0;break;case Gr.BOTTOM:n="scaleY",s=.5,o=1;break;case Gr.LEFT:n="scaleX",s=0,o=.5;break;case Gr.RIGHT:n="scaleX",s=1,o=.5;break;default:return null}const l=`${s*i.width}px ${o*i.height}px`,c={transformOrigin:l,duration:a,ease:t};return c[n]=0,be["a"].from(e,c)}inferDirection(e){const t=e.getRootSel(),a=t.selectAll(".bar"),r=t.selectAll(".x-axis");return 0!==r.length&&0!==a.length?this.inferDirectionByBarsAndAxis(e,a,r):a.length>1?this.inferDirectionByBars(e,a):Gr.BOTTOM}inferDirectionByBars(e,t){const a=Array.from(t.nodes()),r=a.map(t=>Oi(e.getRootSvg(),t)),i=r.map(e=>e.x),n=r.map(e=>e.x+e.width),s=r.map(e=>e.y),o=r.map(e=>e.y+e.height),l=[i,n,o,s].map(e=>Mi.getVariance(e));let c=0,d=l[0];for(let u=1;u<4;u++)l[u]<d&&(d=l[u],c=u);switch(c){case 0:return Gr.LEFT;case 1:return Gr.RIGHT;case 2:return Gr.BOTTOM;case 3:return Gr.TOP}}inferDirectionByBarsAndAxis(e,t,a){const r=Array.from(t.nodes()),i=Array.from(a.nodes()),n=r.map(t=>Oi(e.getRootSvg(),t)),s=i.map(t=>Oi(e.getRootSvg(),t)),o=s.map(e=>e.x+e.width/2).reduce((e,t)=>e+t,0),l=s.map(e=>e.y+e.height/2).reduce((e,t)=>e+t,0),c=o/s.length,d=l/s.length,u=n.map(e=>e.x),h=n.map(e=>e.x+e.width),p=n.map(e=>e.y),g=n.map(e=>e.y+e.height),m=[u,h].map(e=>Mi.getMSE(e,c)),f=[g,p].map(e=>Mi.getMSE(e,d)),w=[...m,...f];let y=0,b=w[0];for(let x=1;x<4;x++)w[x]<b&&(b=w[x],y=x);switch(y){case 0:return Gr.LEFT;case 1:return Gr.RIGHT;case 2:return Gr.BOTTOM;case 3:return Gr.TOP}}static getVariance(e){let t=e.reduce((e,t)=>e+t,0);const a=t/e.length;return Mi.getMSE(e,a)}static getMSE(e,t){let a=0;for(let r=0;r<e.length;r++)a+=Math.pow(e[r]-t,2);return a/e.length}}class Ci extends kr["a"]{constructor(){super(),this.templateName="Line-wipe",this.parameters=[new yr["a"]("titleStagger",Pr["a"].NUMBER,!1,.2),new yr["a"]("symbolStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("axisElementStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("duration",Pr["a"].NUMBER,!1,1.5)]}createAnimation(){const e=new sr("Fade-in").setTarget(".circle, .point, .scatter").set("duration",this.getParamValue("duration")),t=new sr("Wipe").setTarget(".mark.line").updateTiming({start:0}).updateSettings({ease:this.getParamValue("ease"),direction:"left"}),a=new sr("Fade-in").setTarget(".mark.label").updateTiming({start:0});return(new rr).append(e).append(t).append(a)}}class Ii extends kr["a"]{constructor(){super(),this.templateName="Lines by legend",this.parameters=[new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("duration",Pr["a"].NUMBER,!1,1.5)]}createAnimation(){const e=new sr("Fade-in").setTarget(".legend").updateSettings({stagger:.25}),t=new sr("Fade-in").setTarget(".circle, .point, .scatter").set("duration",this.getParamValue("duration")),a=new sr("Wipe").setTarget(".mark.line").updateSettings({stagger:.5,ease:this.getParamValue("ease"),direction:"left"});return(new rr).append(e).append(t).append(a)}}class Li extends kr["a"]{constructor(){super(),this.templateName="Lines by order",this.parameters=[new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("duration",Pr["a"].NUMBER,!1,1.5)]}createAnimation(){const e=new sr("Fade-in").setTarget(".legend"),t=new sr("Fade-in").setTarget(".circle, .point, .scatter").set("duration",this.getParamValue("duration")),a=new sr("Wipe").setTarget(".mark.line").updateSettings({ease:this.getParamValue("ease"),direction:"left"});return(new rr).append(e).append(t).append(a)}}class ki extends kr["a"]{constructor(){super(),this.templateName="Line-highlight",this.parameters=[new yr["a"]("titleStagger",Pr["a"].NUMBER,!1,.2),new yr["a"]("symbolStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("axisElementStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new sr("Draw-path").setTarget(".mark.line");return(new rr).append(e)}}class Pi extends kr["a"]{constructor(){super(),this.templateName="Pie with legend",this.parameters=[new yr["a"]("sectorStagger",Pr["a"].NUMBER,!1,1),new yr["a"]("legendStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("labelStagger",Pr["a"].NUMBER,!1,1)]}createAnimation(){const e=new sr("simple-sector-wheel").setTarget(".sector,.arc,.pie").set("centerSelector",".sector,.arc,.pie").set("duration",1),t=new sr("Fade-in").setTarget(".sector-label,.arc-label,.label"),a=new sr("Fly-in").setTarget(".legend");return(new rr).append(a).append(e).append(t)}}class Bi extends kr["a"]{constructor(){super(),this.templateName="show-annotation-zoom",this.parameters=[new yr["a"]("displayTime",Pr["a"].NUMBER,!1,3),new yr["a"]("enter-ease",Pr["a"].STRING,!1,"back.out"),new yr["a"]("exit-ease",Pr["a"].STRING,!1,"back.in"),new yr["a"]("effect-duration",Pr["a"].NUMBER,!1,1)]}createAnimation(){const e=(new sr).useTemplate("Zoom-enter").set("Zoom-ease",this.getParamValue("enter-ease")).set("duration",this.getParamValue("effect-duration")),t=(new sr).useTemplate("Zoom-exit").set("Zoom-ease",this.getParamValue("exit-ease")).set("duration",this.getParamValue("effect-duration")).updateTiming({offset:this.getParamValue("displayTime")});return(new ir).append(e).append(t).setTarget(new Xa["a"](".annotation"))}}class ji extends kr["a"]{constructor(){super(),this.templateName="Show-arrow-label",this.parameters=[new yr["a"]("distance",Pr["a"].NUMBER,!1,30),new yr["a"]("displayTime",Pr["a"].NUMBER,!1,3),new yr["a"]("effect-duration",Pr["a"].NUMBER,!1,1.5)]}createAnimation(){const e=(new sr).useTemplate("Float").setTarget(".arrow").set("distance",this.getParamValue("distance")).set("duration",this.getParamValue("effect-duration")),t=new sr("Fade-in").setTarget(".label,.text").set("duration",this.getParamValue("effect-duration")),a=(new sr).useTemplate("Fade-out").setTarget("*").updateTiming({start:this.getParamValue("displayTime")});return(new rr).append(e).append(t).append(a).setTarget(new Xa["a"](".annotation"))}}class Gi extends kr["a"]{constructor(){super(),this.templateName="Circle",this.parameters=[new yr["a"]("reverseDirection",Pr["a"].BOOLEAN,!1,!1),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0),new yr["a"]("displayTime",Pr["a"].NUMBER,!1,3),new yr["a"]("r",Pr["a"].NUMBER,!1,15),new yr["a"]("stroke",Pr["a"].STRING,!1,"#000")]}createAnimation(){const e=new Di;return e.updateSettings(this.getParamValues()),e}}class Di extends jr["a"]{create(e){const{displayTime:t,ease:a,stagger:r,duration:i,reverseDirection:n,r:s,stroke:o}=this.settings,l=e.getGlyphs(this.target),c=be["a"].timeline();return l.forEach((l,d)=>{const u=this.addMaskRectToGlyph(e,l,s,o);let h,p=0;try{p=u.getTotalLength()}catch(g){}u.setAttribute("stroke-dasharray",p),h=be["a"].fromTo(u,{strokeDashoffset:n?-p:p},{strokeDashoffset:0,ease:a,duration:i}),c.add(h,0===d?0:"<"+r),h=be["a"].to(u,{strokeDashoffset:n?p:-p,ease:a,duration:i}),c.add(h,"+="+t)}),c}addMaskRectToGlyph(e,t,a,r){t.getAttribute("id")||t.setAttribute("id",Object(zr["a"])());let i=Ma["k"](t.parentNode).append("ellipse").attr("transform",t.getAttribute("transform")+"translate(0,0)").classed(Er["a"],!0).attr("rx",a-3).attr("ry",a-3).attr("stroke-width",2.5).attr("fill","none").attr("stroke",r);return i.node()}}class Ui extends kr["a"]{constructor(){super(),this.templateName="Arrow",this.parameters=[new yr["a"]("reverseDirection",Pr["a"].BOOLEAN,!1,!1),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0),new yr["a"]("displayTime",Pr["a"].NUMBER,!1,3),new yr["a"]("x",Pr["a"].NUMBER,!1,50),new yr["a"]("y",Pr["a"].NUMBER,!1,50),new yr["a"]("color",Pr["a"].STRING,!1,"#000"),new yr["a"]("scale",Pr["a"].NUMBER,!1,1)]}createAnimation(){const e=new $i;return e.updateSettings(this.getParamValues()),e}}class $i extends jr["a"]{create(e){const{displayTime:t,ease:a,duration:r,reverseDirection:i,x:n,y:s,color:o,scale:l}=this.settings,c=be["a"].timeline(),d=e.getRootSel(),u=d.select("svg").node()?d.select("svg"):d;let h=u.append("path").attr("transform",`translate(${n}, ${s}), scale(${l}, ${(i?-1:1)*l})`).classed(Er["a"],!0).attr("d","M16 9L12 5M12 5L8 9M12 5V19").attr("stroke-width",2).attr("stroke-linecap","round").attr("fill","none").attr("stroke",o);const p=h.node();let g;return g=be["a"].fromTo(p,{opacity:0},{opacity:1,ease:a,duration:r}),c.add(g,0),g=be["a"].to(p,{opacity:0,ease:a,duration:r}),c.add(g,"+="+t),c}}class Hi extends kr["a"]{constructor(){super(),this.templateName="Text",this.parameters=[new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0),new yr["a"]("displayTime",Pr["a"].NUMBER,!1,3),new yr["a"]("x",Pr["a"].NUMBER,!1,50),new yr["a"]("y",Pr["a"].NUMBER,!1,50),new yr["a"]("fontSize",Pr["a"].NUMBER,!1,20),new yr["a"]("fill",Pr["a"].STRING,!1,"#000"),new yr["a"]("textContent",Pr["a"].STRING,!1,"text")]}createAnimation(){const e=new Fi;return e.updateSettings(this.getParamValues()),e}}class Fi extends jr["a"]{create(e){const{displayTime:t,ease:a,duration:r,x:i,y:n,fill:s,fontSize:o,textContent:l}=this.settings,c=be["a"].timeline(),d=e.getRootSel(),u=d.select("svg").node()?d.select("svg"):d;let h=u.append("text").text(l).classed("anno-text-"+l,!0).attr("x",i).attr("y",n).attr("font-size",o).attr("fill",s);const p=h.node();let g;return g=be["a"].fromTo(p,{opacity:0},{opacity:1,ease:a,duration:r}),c.add(g,0),g=be["a"].to(p,{opacity:0,ease:a,duration:r}),c.add(g,"+="+t),c}}class Vi extends kr["a"]{constructor(){super(),this.templateName="Contour",this.parameters=[new yr["a"]("reverseDirection",Pr["a"].BOOLEAN,!1,!1),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0),new yr["a"]("displayTime",Pr["a"].NUMBER,!1,3),new yr["a"]("stroke",Pr["a"].STRING,!1,"#ff0"),new yr["a"]("customTransform",Pr["a"].STRING,!1,"")]}createAnimation(){const e=new Wi;return e.updateSettings(this.getParamValues()),e}}class Wi extends jr["a"]{create(e){const{displayTime:t,ease:a,stagger:r,duration:i,reverseDirection:n,stroke:s,customTransform:o}=this.settings,l=be["a"].timeline(),c=e.getGlyphs(this.target);return c.forEach((e,c)=>{if(!e.getAttribute("id").includes("label")){const u=this.addMaskRectToGlyph(e,s,o);let h,p=0;try{p=e.getTotalLength()}catch(d){}u.setAttribute("stroke-dasharray",p),h=be["a"].fromTo(u,{strokeDashoffset:n?-p:p},{strokeDashoffset:0,ease:a,duration:i}),l.add(h,0===c?0:"<"+r),h=be["a"].to(u,{strokeDashoffset:n?p:-p,ease:a,duration:i}),l.add(h,"+="+t)}}),l}addMaskRectToGlyph(e,t,a){console.log(e);let r=Ma["k"](e.parentNode).append("path").attr("d",e.getAttribute("d")).classed(Er["a"],!0).attr("stroke-linejoin","round").attr("stroke-width",3).attr("fill","none").attr("stroke",t);return""===a?r.attr("transform",e.getAttribute("transform")):"none"!==a&&r.attr("transform",a),r.node()}}var Ji={templateName:"Fade-in-then-fade-out",parameters:[{paramName:"displayTime",paramType:"number",required:!1,defaultValue:3}],animation:{target:"*",sequence:{sync:[{use:"Fade-in"},{use:"Fade-out",timing:{offset:"$displayTime"}}]}}};class qi extends kr["a"]{constructor(){super(),this.templateName="Dynamic-number",this.parameters=[new yr["a"]("start",Pr["a"].NUMBER,!1,0),new yr["a"]("end",Pr["a"].NUMBER,!1,"@num"),new yr["a"]("formatter",Pr["a"].STRING,!1,"auto"),new yr["a"]("toFixed",Pr["a"].NUMBER,!1,0),new yr["a"]("duration",Pr["a"].NUMBER,!1,2),new yr["a"]("ease",Pr["a"].STRING,!1,"power3.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0)]}createAnimation(){const e=new zi;return e.updateSettings(this.getParamValues()),e}}class zi extends jr["a"]{create(e){const{start:t,end:a,formatter:r,toFixed:i,ease:n,stagger:s,duration:o}=this.settings,l=be["a"].timeline(),c=e.getGlyphs(this.target);return c.forEach(e=>{let d;if("auto"===r){const t=e.innerHTML.match(/([^\d]*)(\d+)(.*)/);d=t?t[1]+"@num"+t[3]:"@num"}else d=r.includes("@num")?r:"@num";let u,h=t,p=a;if("@num"===t||"@num"===a){const r=e.innerHTML.match(d.replace("@num","([\\d.]+)"));"@num"===t&&(h=parseFloat(r[1])),"@num"===a&&(p=parseFloat(r[1]))}const g={tempNum:h},m=()=>{const e=g.tempNum.toFixed(i),t=d.replaceAll("@num",e);c.forEach(e=>e.innerHTML=t)};m(),u=be["a"].to(g,{tempNum:p,ease:n,duration:o,onUpdate:m}),l.add(u,"<"+s)}),l}}class Ki extends kr["a"]{constructor(){super(),this.templateName="Zoom-in-then-zoom-out",this.parameters=[new yr["a"]("displayTime",Pr["a"].STRING,!1,3)]}createAnimation(){const e=new sr("Zoom-enter"),t=new sr("Zoom-exit").updateTiming({offset:this.getParamValue("displayTime")});return new ir([e,t])}}class Yi extends kr["a"]{constructor(){super(),this.templateName="custom-effect",this.parameters=[new yr["a"]("attr",Pr["a"].STRING_OR_ARRAY),new yr["a"]("from",Pr["a"].ANY,!1,null),new yr["a"]("to",Pr["a"].ANY,!1,null),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0)]}isValid(){if(!super.isValid())return!1;const e=this.getParamValues();return!!e.attr&&(Array.isArray(e.attr)?null!==e.from&&null!==e.to?Array.isArray(e.from)&&e.from.length===e.attr.length&&Array.isArray(e.to)&&e.to.length===e.attr.length:null!==e.from?Array.isArray(e.from)&&e.from.length===e.attr.length:null!==e.to&&(Array.isArray(e.to)&&e.to.length===e.attr.length):null!==e.from||null!==e.to)}createAnimation(){const e=new Xi;return e.updateSettings(this.getParamValues()),e}}class Xi extends jr["a"]{create(e){const{attr:t,from:a,to:r,ease:i,stagger:n}=this.settings,{duration:s,yoyo:o}=this.timing.getComputedTiming(),l=e.getGlyphs(this.target);let c,d,u,h;Array.isArray(t)?(c=t,d=a,u=r):(c=[t],null!==a&&(d=[a]),null!==r&&(u=[r]));const p=(e,t,a)=>t.forEach((t,r)=>e[t]=a[r]);if(null!=a&&null!=r){const e={};p(e,c,d);const t={ease:i,duration:s,stagger:n};p(t,c,u),h=be["a"].fromTo(l,e,t)}else if(null!=a){const e={ease:i,duration:s,stagger:n};p(e,c,d),h=be["a"].from(l,e)}else{if(null==r)return null;{const e={ease:i,duration:s,stagger:n};p(e,c,u),h=be["a"].to(l,e)}}return o&&(h.yoyo(!0),h.repeat(o.repeat),h.repeatDelay(o.delay)),h}}class Zi extends kr["a"]{constructor(){super(),this.templateName="Fade",this.parameters=[new yr["a"]("FadeType",Pr["a"].STRING,!1,"in"),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0)]}createAnimation(){const e=new Qi;return e.updateSettings(this.getParamValues()),e}}class Qi extends jr["a"]{create(e){const{fadeType:t,ease:a,stagger:r,duration:i}=this.settings;let n;const s=e.getGlyphs(this.target),o={opacity:0,ease:a,duration:i,stagger:r};if("in"===t)n=be["a"].from(s,o);else{if("out"!==t)return console.warn("Wrong value of fadeType: "+t),null;n=be["a"].to(s,o)}return n}}var en={templateName:"Zoom-enter",parameters:[{paramName:"duration",paramType:"number",required:!1,defaultValue:.5},{paramName:"zoomEase",paramType:"string",required:!1,defaultValue:"back.out"},{paramName:"FadeEase",paramType:"string",required:!1,defaultValue:"power1.inOut"},{paramName:"stagger",paramType:"string",required:!1,defaultValue:0}],animation:{use:"Zoom",target:"*",settings:{duration:"$duration",zoomEase:"$zoomEase",fadeEase:"$fadeEase",stagger:"$stagger",enterOrExit:"enter"}}},tn={templateName:"Basic-zoom-enter",parameters:[{paramName:"duration",paramType:"number",required:!1,defaultValue:1},{paramName:"ease",paramType:"string",required:!1,defaultValue:"back.out"},{paramName:"stagger",paramType:"number",required:!1,defaultValue:0}],animation:{use:"basic-zoom",target:"*",settings:{duration:"$duration",ease:"$ease",stagger:"$stagger",enterOrExit:"enter"}}};class an extends kr["a"]{constructor(){super(),this.templateName="Bar-bounce",this.parameters=[new yr["a"]("symbol-ease",Pr["a"].STRING,!1,"back.out"),new yr["a"]("bar-ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("duration",Pr["a"].NUMBER,!1,1.5)]}createAnimation(){const e=new sr("Move-to").setTarget(".bar").updateSettings({y:"-=15",yoyo:!0}),t=new sr("Move-to").setTarget(".bar-label,.label").updateTiming({start:.4}).updateSettings({y:"-=15",yoyo:!0});return(new rr).append(e).append(t).setTarget(new Xa["a"](".bar,.axis.symbol,.bar-label,.label"))}}class rn extends kr["a"]{constructor(){super(),this.templateName="Bar chart with axis label",this.parameters=[new yr["a"]("barDirection",Pr["a"].STRING,!1,"bottom"),new yr["a"]("titleStagger",Pr["a"].NUMBER,!1,.2),new yr["a"]("symbolStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("axisElementStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new sr("Axes fade in").setTarget(".chart").updateSettings(this.getParamValues()),t=new sr("Grow").setTarget(".bar").updateTiming({offset:2}).updateSettings({ease:this.getParamValue("ease"),direction:this.getParamValue("barDirection")}),a=new sr("Fade-in").setTarget(".bar-label,.label").updateTiming({offset:3});return(new rr).append(e).append(t).append(a)}}class nn extends kr["a"]{constructor(){super(),this.templateName="move",this.parameters=[new yr["a"]("from",Pr["a"].OBJECT,!1,null),new yr["a"]("to",Pr["a"].OBJECT,!1,null),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0),new yr["a"]("yoyo",Pr["a"].OBJECT,!1,null)]}createAnimation(){const e=new sn;return e.updateSettings(this.getParamValues()),e}}class sn extends jr["a"]{getDefaultSettings(){return{duration:1,ease:"power1.out",stagger:0,yoyo:null}}create(e){const{from:t,to:a,ease:r,stagger:i}=this.settings;let n,{duration:s,yoyo:o}=this.settings;const l=e.getGlyphs(this.target),c={};if(o&&(!0===o&&(o=cr["a"].getDefaultYoyo()),c.yoyo=!0,c.repeat=o.repeat,c.repeatDelay=o.delay,s/=c.repeat+1),null!=t&&null!=a){const e={...t},o={...a,ease:r,duration:s,stagger:i,...c};n=be["a"].fromTo(l,e,o)}else if(null!=t){const e={...t,ease:r,duration:s,stagger:i,...c};n=be["a"].from(l,e)}else{if(null==a)return null;{const e={...a,ease:r,duration:s,stagger:i,...c};n=be["a"].to(l,e)}}return n}}class on extends kr["a"]{constructor(){super(),this.templateName="wheel",this.parameters=[new yr["a"]("enterOrExit",Pr["a"].STRING,!1,"enter"),new yr["a"]("direction",Pr["a"].STRING,!1,"clockwise"),new yr["a"]("center",Pr["a"].STRING,!1,"50% 50%"),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0),new yr["a"]("startAngle",Pr["a"].NUMBER,!1,0),new yr["a"]("sweepAngle",Pr["a"].NUMBER,!1,360),new yr["a"]("grouped",Pr["a"].BOOLEAN,!1,!1)]}createAnimation(){const e=new ln;return e.updateSettings(this.getParamValues()),e}}class ln extends jr["a"]{create(e){const t=e.getGlyphs(this.target),a=e.getDefsSel(),r=be["a"].timeline(),{grouped:i,stagger:n}=this.settings;if(0===t.length)return null;if(i&&1!==t.length){const e=this.addClipPathToEntirety(a,t),i=this.createTwForClipEntirety(e,t);r.add(i)}else t.forEach((e,t)=>{const i=this.addClipPathToGlyph(a,e),s=this.createTwForClip(i,e),o=0===t?0:"<"+n;r.add(s,o)});return r}addClipPathToGlyph(e,t){var a;t.getAttribute("id")||t.setAttribute("id",Object(zr["a"])());const r="clip-path-"+t.getAttribute("id");let i=e.select("#"+r);i.empty()&&(i=e.append("clipPath").attr("id",r).classed(Er["b"],!0),t.setAttribute("clip-path",`url(#${r})`));const n=i.select(".wheel");if(!n.empty())return n.node();let s=parseFloat(null!==(a=t.getAttribute("stroke-width"))&&void 0!==a?a:"0");Ma["k"](t).selectAll("*").each((function(){var e;const t=parseFloat(null!==(e=this.getAttribute("stroke-width"))&&void 0!==e?e:"0");s=Math.max(t,s)}));const o=i.append("path").attr("class","wheel").attr("d","");return o.node()}addClipPathToEntirety(e,t){}createTwForClip(e,t){var a;const{ease:r,duration:i,startAngle:n,sweepAngle:s}=this.settings,o=t.getBBox();let l,c,d,u,h,p,g=parseFloat(null!==(a=t.getAttribute("stroke-width"))&&void 0!==a?a:"0");Ma["k"](t).selectAll("*").each((function(){var e;const t=parseFloat(null!==(e=this.getAttribute("stroke-width"))&&void 0!==e?e:"0");g=Math.max(t,g)})),l=o.width+2*g,c=o.height+2*g,d=o.x-g,u=o.y-g,h={startAngle:null!==n&&void 0!==n?n:0,sweepAngle:0,cx:d+l/2,cy:u+c/2,rx:l,ry:c},p=s;const m=function(){const t=cn(h.cx,h.cy,h.rx,h.ry,h.startAngle,h.sweepAngle);e.setAttribute("d",t)};return m(),be["a"].to(h,{sweepAngle:p,ease:r,onUpdate:m,duration:i})}createTwForClipEntirety(e,t){var a;const{ease:r,duration:i,startAngle:n,sweepAngle:s}=this.settings,o=t.getBBox();let l,c,d,u,h,p,g=parseFloat(null!==(a=t.getAttribute("stroke-width"))&&void 0!==a?a:"0");Ma["k"](t).selectAll("*").each((function(){var e;const t=parseFloat(null!==(e=this.getAttribute("stroke-width"))&&void 0!==e?e:"0");g=Math.max(t,g)})),l=o.width+2*g,c=o.height+2*g,d=o.x-g,u=o.y-g,h={startAngle:null!==n&&void 0!==n?n:0,sweepAngle:0,cx:d+l/2,cy:u+c/2,rx:l,ry:c},p=s;const m=function(){const t=cn(h.cx,h.cy,h.rx,h.ry,h.startAngle,h.sweepAngle);e.setAttribute("d",t)};return m(),be["a"].to(h,{sweepAngle:p,ease:r,onUpdate:m,duration:i})}}function cn(e,t,a,r,i,n){if(!n)return`M${e} ${t}`;i%=360,n%=360;const s=0===n;s&&(n=180),n<0&&(n+=360);const o=n>180?1:0,l=i*Math.PI/180,c=(i+n)*Math.PI/180,d=e+a*Math.sin(l),u=t-r*Math.cos(l),h=e+a*Math.sin(c),p=t-r*Math.cos(c);return s?`\n      M ${d} ${u}\n      A ${a} ${r} 0 1 1 ${h} ${p}\n      A ${a} ${r} 0 1 1 ${d} ${u}z`:`\n    M ${d} ${u}\n    A ${a} ${r} 0 ${o} 1 ${h} ${p}\n    L ${e} ${t}z`}var dn=a("6d0c");class un extends kr["a"]{constructor(){super(),this.templateName="Draw-path",this.parameters=[new yr["a"]("enterOrExit",Pr["a"].STRING,!1,"enter"),new yr["a"]("reverseDirection",Pr["a"].BOOLEAN,!1,!1),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0)]}createAnimation(){const e=new hn;return e.updateSettings(this.getParamValues()),e}}class hn extends jr["a"]{create(e){const{enterOrExit:t,ease:a,stagger:r,duration:i,reverseDirection:n}=this.settings,s=be["a"].timeline(),o=e.getGlyphs(this.target);return o.forEach((e,o)=>{let l,c=0;try{c=e.getTotalLength()}catch(d){}if(e.setAttribute("stroke-dasharray",c),"enter"===t)l=be["a"].fromTo(e,{strokeDashoffset:n?-c:c},{strokeDashoffset:0,ease:a,duration:i});else{if("exit"!==t)return void console.warn("Wrong value of enterOrExit: "+t);l=be["a"].fromTo(e,{strokeDashoffset:0},{strokeDashoffset:n?c:-c,ease:a,duration:i})}s.add(l,0===o?0:"<"+r)}),s}}class pn extends kr["a"]{constructor(){super(),this.templateName="Highlight-sector",this.parameters=[new yr["a"]("duration",Pr["a"].NUMBER,!1,1)]}createAnimation(){const e=new sr("show-dynamic-number").setTarget(".anno-label,.sector-label").set("start","@num").set("end","@num").set("formatter","@num%"),t=new sr("Highlight").setTarget(".sector,.arc,.pie").set("centerSelector",".sector,.arc,.pie");return(new rr).append(e).append(t)}}class gn extends kr["a"]{constructor(){super(),this.templateName="arc-wheel-with-legend",this.parameters=[]}createAnimation(){const e=new sr("simple-sector-wheel").setTarget(".arc").updateSettings({centerSelector:".arc",endAngle:360,startAngle:0}),t=new sr("Fly-in").setTarget(".legend").updateSettings({direction:"right"});return(new rr).append(e).append(t)}}class mn extends kr["a"]{constructor(){super(),this.templateName="show-dynamic-number",this.parameters=[new yr["a"]("start",Pr["a"].NUMBER,!1,0),new yr["a"]("end",Pr["a"].NUMBER,!1,100),new yr["a"]("formatter",Pr["a"].STRING,!1,"@num"),new yr["a"]("toFixed",Pr["a"].NUMBER,!1,0),new yr["a"]("numChangeDuration",Pr["a"].NUMBER,!1,1.9),new yr["a"]("FadeInDuration",Pr["a"].NUMBER,!1,.1),new yr["a"]("FadeOutDuration",Pr["a"].NUMBER,!1,1),new yr["a"]("notExit",Pr["a"].BOOLEAN,!1,!1),new yr["a"]("displayTime",Pr["a"].NUMBER,!1,3),new yr["a"]("ease",Pr["a"].STRING,!1,"power3.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0)]}createAnimation(){const e=new sr("Fade-in").set("duration",this.getParamValue("FadeInDuration")),t=new sr("Dynamic-number"),a={...this.getParamValues()};a["duration"]=a["numChangeDuration"],delete a["numChangeDuration"],delete a["FadeInDuration"],delete a["FadeOutDuration"],t.updateSettings(this.getParamValues());const r=[e,t];if(!this.getParamValue("notExit")){const e=new sr("Fade-out").set("duration",this.getParamValue("FadeOutDuration")).updateTiming({offset:this.getParamValue("displayTime")});r.push(e)}return new ir(r)}}class fn extends kr["a"]{constructor(){super(),this.templateName="Show-annotation-auto-effect",this.parameters=[new yr["a"]("stagger",Pr["a"].NUMBER,!1,0),new yr["a"]("duration",Pr["a"].NUMBER,!1,1)]}createAnimation(){const e=new wn;return e.updateSettings(this.getParamValues()),e}}class wn extends jr["a"]{create(e){const{stagger:t,duration:a}=this.settings,r=be["a"].timeline(),i=e.getGlyphs(this.target);return i.forEach(i=>{let n;switch(i.tagName){case"text":n=new sr("Float");break;case"circle":n=new sr("wheel");break;case"path":case"line":n=new sr("Draw-path");break;default:n=new sr("Fade-in")}n.setTarget("#"+i.id).set("duration",a);const s=n.create(e);s.yoyo(!0),s.repeat(1),r.add(s,"<"+t)}),r}}class yn extends kr["a"]{constructor(){super(),this.templateName="Camera-move",this.parameters=[new yr["a"]("x",Pr["a"].ANY,!1,"+=50"),new yr["a"]("y",Pr["a"].ANY,!1,"+=50"),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("yoyo",Pr["a"].OBJECT,!1,null)]}createAnimation(){const e=new bn;return e.updateSettings(this.getParamValues()),e}}class bn extends jr["a"]{create(e){const{x:t,y:a,ease:r}=this.settings;let i,{duration:n,yoyo:s}=this.settings;const o=e.renderContext.rootSel,l={};s&&(!0===s&&(s=cr["a"].getDefaultYoyo()),l.yoyo=!0,l.repeat=s.repeat,l.repeatDelay=s.delay,n/=l.repeat+1);const c=t.replace("+","-").replace("-","+"),d=a.replace("+","-").replace("-","+"),u={translateX:c,translateY:d,ease:r,duration:n};return i=be["a"].to(o.node(),u),i}}class xn extends kr["a"]{constructor(){super(),this.templateName="simple-sector-wheel",this.parameters=[new yr["a"]("enterOrExit",Pr["a"].STRING,!1,"enter"),new yr["a"]("duration",Pr["a"].NUMBER,!1,1),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("centerSelector",Pr["a"].STRING,!1,null),new yr["a"]("startAngle",Pr["a"].NUMBER,!1,0),new yr["a"]("endAngle",Pr["a"].NUMBER,!1,360)]}createAnimation(){const e=new vn;return e.updateSettings(this.getParamValues()),e}}class vn extends jr["a"]{constructor(...e){super(...e),Object(me["a"])(this,"x",void 0),Object(me["a"])(this,"y",void 0),Object(me["a"])(this,"width",void 0),Object(me["a"])(this,"height",void 0)}create(e){const t=e.getGlyphs(this.target),a=e.getDefsSel(),r=be["a"].timeline(),{stagger:i,centerSelector:n,startAngle:s,endAngle:o}=this.settings;let l,c=1/0,d=1/0,u=0,h=0;return l=null!=n?e.getRootSel().selectAll(n).nodes():t,l.forEach(e=>{const t=e.getBBox();c=Math.min(c,t.x),d=Math.min(d,t.y)}),this.x=c,this.y=d,l.forEach(e=>{const t=e.getBBox();u=Math.max(u,t.x+t.width-c),h=Math.max(h,t.y+t.height-d)}),this.width=u,this.height=h,t.forEach((e,t)=>{const n=this.addClipPathToGlyph(a,e),l=this.createTwForClip(n,e,s,o),c=0===t?0:"<"+i;r.add(l,c)}),r}addClipPathToGlyph(e,t){var a;t.getAttribute("id")||t.setAttribute("id",Object(zr["a"])());const r="clip-path-"+t.getAttribute("id");let i=e.select("#"+r);i.empty()&&(i=e.append("clipPath").attr("id",r).classed(Er["b"],!0),t.setAttribute("clip-path",`url(#${r})`));const n=i.select(".sector-wheel");if(!n.empty())return n.node();let s=parseFloat(null!==(a=t.getAttribute("stroke-width"))&&void 0!==a?a:"0");Ma["k"](t).selectAll("*").each((function(){var e;const t=parseFloat(null!==(e=this.getAttribute("stroke-width"))&&void 0!==e?e:"0");s=Math.max(t,s)}));const o=i.append("path").attr("class","sector-wheel").attr("d","");return o.node()}createTwForClip(e,t,a,r){const{ease:i,duration:n}=this.settings,s=a,o=r-a;let l,c;l={startAngle:null!==s&&void 0!==s?s:0,sweepAngle:0,cx:this.x+this.width/2,cy:this.y+this.height/2,rx:Math.max(this.width,this.height),ry:Math.max(this.width,this.height)},c=o;const d=function(){const t=_n(l.cx,l.cy,l.rx,l.ry,l.startAngle,l.sweepAngle);e.setAttribute("d",t)};return d(),be["a"].to(l,{sweepAngle:c,ease:i,onUpdate:d,duration:n})}}function _n(e,t,a,r,i,n){if(!n)return`M${e} ${t}`;i%=360,n%=360;const s=0===n;s&&(n=180),n<0&&(n+=360);const o=n>180?1:0,l=i*Math.PI/180,c=(i+n)*Math.PI/180,d=e+a*Math.sin(l),u=t-r*Math.cos(l),h=e+a*Math.sin(c),p=t-r*Math.cos(c);return s?`\n      M ${d} ${u}\n      A ${a} ${r} 0 1 1 ${h} ${p}\n      A ${a} ${r} 0 1 1 ${d} ${u}z`:`\n    M ${d} ${u}\n    A ${a} ${r} 0 ${o} 1 ${h} ${p}\n    L ${e} ${t}z`}class Tn extends kr["a"]{constructor(){super(),this.templateName="Fly-in",this.parameters=[new yr["a"]("direction",Pr["a"].STRING,!1,Gr.RIGHT),new yr["a"]("duration",Pr["a"].NUMBER,!1,.2),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out"),new yr["a"]("stagger",Pr["a"].NUMBER,!1,0)]}createAnimation(){const e=new En;return e.updateSettings(this.getParamValues()),e}}class En extends jr["a"]{constructor(...e){super(...e),Object(me["a"])(this,"rootBBox",void 0)}create(e){const{stagger:t}=this.settings,a=e.getGlyphs(this.target);this.rootBBox=e.getRootSel().node().getBBox();const r=be["a"].timeline();return a.forEach((e,a)=>{const i=this.createTwForOneGlyph(e),n=0===a?0:"<"+t;r.add(i,n)}),r}createTwForOneGlyph(e){const{direction:t,ease:a,duration:r}=this.settings;let i,n;switch(t){case Gr.TOP:i=0,n=-1;break;case Gr.BOTTOM:i=0,n=1;break;case Gr.LEFT:i=-1,n=0;break;case Gr.RIGHT:i=1,n=0;break;default:return null}const s="+="+i*this.rootBBox.width*.5,o="+="+n*this.rootBBox.height*.5,l={translateX:s,translateY:o,duration:r,ease:a};return be["a"].from(e,l)}}class Sn extends kr["a"]{constructor(){super(),this.templateName="Hide"}createAnimation(){return new An}}class An extends jr["a"]{create(e){const t=e.getGlyphs(this.target),a={opacity:0},r=be["a"].timeline();let i;return i=be["a"].to(t,a),i.yoyo(!0),i.repeat(1),i.repeatDelay(10),r.add(i,0),r}}class Nn extends kr["a"]{constructor(){super(),this.templateName="empty",this.parameters=[new yr["a"]("duration",Pr["a"].NUMBER,!1,1)]}createAnimation(){const e=new On;return e.updateSettings(this.getParamValues()),e}}class On extends jr["a"]{create(e){const{duration:t}=this.settings;return be["a"].to("empty-selector",{duration:t})}}var Rn={templateName:"show number",parameters:[{paramName:"dataName",paramType:"string"}],animation:{target:{selector:".annotation",transform:{type:"filter",expr:'@datum.name === "$dataName"'}},sequence:{sync:[{use:"Dynamic-number",target:".label"},{use:"Float",target:".label",settings:{distance:10}}]}}};const Mn=[new Yi,new Dr,new Zi,new Br,new ci,new Kr,new Gi,new Ui,new Hi,new Vi,new ri,new di,new qr,xr.fromJSON(en),xr.fromJSON(oi),new Wr,xr.fromJSON(tn),xr.fromJSON(li),new nn,new Hr,new $r,new Fr,xr.fromJSON(Ji),new Qr,new on,new Tn,new Sn,new Nn,new ni,new yn,xr.fromJSON(pi),new hi,new gi,new an,new Ti,new rn,new mi,new _i,new vi,new Ri,new Ci,new wi,new yi,new bi,new Ii,new Li,new ki,new Ai,new Ei,new fi,new Si,new un,new ti,new dn["a"],new xn,new xi,new pn,new gn,new Pi,new ji,new Bi,new Ki,new qi,new mn,new fn,xr.fromJSON(Rn),new ui],Cn=new Ir(new Zi,Mr.GENERAL,Cr.OTHER,["general","any","opacity","enter","exit"],{},".second,.forth",.5),In=new Ir(xr.fromJSON(tn),Mr.GENERAL,Cr.ENTER,["general","any","zoom","enter"],{},".second,.forth",.5),Ln=new Ir(xr.fromJSON(li),Mr.GENERAL,Cr.EXIT,["general","any","zoom","exit"],{},".second,.forth",.5),kn=new Ir(new Wr,Mr.GENERAL,Cr.OTHER,["general","any","zoom","enter","exit"],{},".second,.forth",.5),Pn=new Ir(new Qr,Mr.GENERAL,Cr.HIGHLIGHT,["general","any","color","emphasize"],{fill:"#2171b5",duration:2},".second,.first",1),Bn=new Ir(new Yi,Mr.MOVE,Cr.OTHER,["general","any","custom","enter","exit"],{attr:["fill","x"],to:["#fb9b5b","+=70px"],ease:"power1.inOut"},".target",.5),jn=new Ir(new Br,Mr.GENERAL,Cr.ENTER,["general","any","opacity","enter"],{},".second,.forth",.5),Gn=new Ir(new ci,Mr.GENERAL,Cr.EXIT,["general","any","opacity","exit"],{},".second,.forth",.5),Dn=new Ir(new Fr,Mr.GENERAL,Cr.ENTER,["general","any","move","opacity","enter","exit"],{},".second,.forth",.5),Un=new Ir(new Tn,Mr.GENERAL,Cr.ENTER,["general","any","move","opacity","enter","exit"],{},".second,.forth",.5),$n=new Ir(new Dr,Mr.GENERAL,Cr.ENTER,["general","any","width","height","enter"],{},".second,.forth",.5),Hn=new Ir(new nn,Mr.MOVE,Cr.OTHER,["general","any","move","from","to"],{to:{x:"+=70"},ease:"power1.inOut"},".target",.5),Fn=new Ir(new Hr,Mr.MOVE,Cr.ENTER,["general","any","move","from"],{x:"+=70",ease:"power1.inOut"},".target",.5),Vn=new Ir(new $r,Mr.MOVE,Cr.ENTER,["general","any","move","to"],{x:"+=70",ease:"power1.inOut"},".target",.5),Wn=new Ir(new Kr,Mr.GENERAL,Cr.ENTER,["general","any","mask","enter","exit"],{},".second",.5),Jn=new Ir(xr.fromJSON(en),Mr.GENERAL,Cr.ENTER,["general","any","zoom","enter"],{},".second,.forth",.5),qn=new Ir(xr.fromJSON(oi),Mr.GENERAL,Cr.EXIT,["general","any","zoom","exit"],{},".second,.forth",.5),zn=new Ir(new Sn,Mr.GENERAL,Cr.EXIT,["general","any","opacity","exit"],{},".second,.forth",.5),Kn=new Ir(new qr,Mr.GENERAL,Cr.OTHER,["general","any","zoom","enter","exit"],{},".second,.forth",.5),Yn=new Ir(new di,Mr.GENERAL,Cr.HIGHLIGHT,["general","any","color","emphasize"],{},".second,.first",1),Xn=new Ir(new Ki,Mr.GENERAL,Cr.HIGHLIGHT,["annotation","zoom","show"],{displayTime:.5},".second",.5),Zn=new Ir(new ji,Mr.ANNOTATION_ARROW,Cr.HIGHLIGHT,["annotation","arrow","label","zoom","float","show"],{},".annotation",.5),Qn=new Ir(new ni,Mr.CAMERA,Cr.HIGHLIGHT,["camera","zoom"],{scaleFactor:1.5,transformOrigin:"50% 0%"},"*",.5),es=new Ir(new yn,Mr.CAMERA,Cr.HIGHLIGHT,["camera","zoom"],{scaleFactor:1.5,transformOrigin:"50% 0%"},"*",.5),ts=new Ir(new gi,Mr.BAR_CHART,Cr.ENTER,["chart","enter"],{},".chart",1),as=new Ir(new Ti,Mr.BAR_CHART,Cr.ENTER,["mark","label","enter"],{},{selector:".chart",transform:{type:"filter",expr:'@datum.name === "A"'}},1),rs=new Ir(new an,Mr.BAR_CHART,Cr.HIGHLIGHT,["mark","label","enter"],{},{selector:".chart",transform:{type:"filter",expr:'@datum.name === "A"'}},1),is=new Ir(new vi,Mr.BAR_CHART,Cr.ENTER,["chart","enter"],{},".mark",1),ns=new Ir(new mi,Mr.BAR_CHART_WITH_LEGEND,Cr.ENTER,["chart","enter"],{},".chart",1),ss=new Ir(new _i,Mr.BAR_CHART_WITH_LEGEND,Cr.ENTER,["chart","enter"],{},".mark",1);class os extends kr["a"]{constructor(){super(),this.templateName="Axes fade in",this.parameters=[new yr["a"]("titleStagger",Pr["a"].NUMBER,!1,.2),new yr["a"]("symbolStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("axisElementStagger",Pr["a"].NUMBER,!1,0),new yr["a"]("ease",Pr["a"].STRING,!1,"power1.out")]}createAnimation(){const e=new sr("Fade-in").setTarget(".title,.subtitle,.main-title,.sub-title").set("stagger",this.getParamValue("titleStagger")),t=new sr("Fade-in").setTarget(".x-axis.symbol").set("stagger",this.getParamValue("symbolStagger")),a=new sr("Grow").setTarget(".x-axis.domain").updateSettings({direction:"left",ease:this.getParamValue("ease")}),r=new sr("Grow").setTarget(".y-axis.domain").updateSettings({ease:this.getParamValue("ease")}),i=new sr("Fade-in").setTarget(".axis.label").set("stagger",this.getParamValue("axisElementStagger")).updateTiming({offset:1}),n=new sr("Fade-in").setTarget(".axis.tick").set("stagger",this.getParamValue("axisElementStagger")).updateTiming({offset:1});return(new rr).append(e).append(t).append(a).append(r).append(i).append(n)}}const ls=new Ir(new os,Mr.CHART_FRAMEWORK,Cr.ENTER,["chart","without-mark","enter"],{},".chart",1),cs=new Ir(new hi,Mr.CHART_FRAMEWORK,Cr.ENTER,["chart","without-mark","enter"],{},".chart",1);class ds extends kr["a"]{constructor(){super(),this.templateName="Fade-in-then-fade-out",this.parameters=[new yr["a"]("displayTime",Pr["a"].STRING,!1,2)]}createAnimation(){const e=new sr("Fade-in"),t=new sr("Fade-out").updateTiming({offset:this.getParamValue("displayTime")});return new ir([e,t])}}const us=new Ir(new ds,Mr.GENERAL,Cr.HIGHLIGHT,["general","any","opacity","show"],{displayTime:.5},".second,.forth",.5),hs=new Ir(new Gi,Mr.CHART_FRAMEWORK,Cr.HIGHLIGHT,["general","any","annotation","circle"],{},{selector:".chart",transform:{type:"filter",expr:"@datum === 20"}},1),ps=new Ir(new Ui,Mr.CHART_FRAMEWORK,Cr.HIGHLIGHT,["general","any","annotation","Arrow"],{scale:2,color:"#f00",reverseDirection:!0},{selector:".chart",transform:{type:"filter",expr:"@datum === 20"}},1),gs=new Ir(new Hi,Mr.CHART_FRAMEWORK,Cr.HIGHLIGHT,["general","any","annotation","Text"],{},".chart",1),ms=new Ir(new ti,Mr.PATH,Cr.HIGHLIGHT,["general","any","show","path","enter"],{},".annotation",.5),fs=new Ir(new ri,Mr.GENERAL,Cr.HIGHLIGHT,["general","any","highlight"],{},".first,.second",1),ws=new Ir(new Ai,Mr.CIRCLE_CHART,Cr.ENTER,[],{},".chart",1),ys=new Ir(new Ei,Mr.CIRCLE_CHART,Cr.ENTER,[],{},".mark",1),bs=new Ir(new fi,Mr.CIRCLE_CHART_WITH_LEGEND,Cr.ENTER,[],{},".chart",1),xs=new Ir(new Si,Mr.CIRCLE_CHART_WITH_LEGEND,Cr.ENTER,[],{},".mark",1),vs=new Ir(new xi,Mr.PIE_CHART,Cr.ENTER,[],{},".third",1),_s=new Ir(new Pi,Mr.PIE_WITH_LEGEND,Cr.ENTER,[],{},".third",1),Ts=new Ir(new pn,Mr.PIE_CHART,Cr.HIGHLIGHT,[],{},".third",1),Es=new Ir(new ui,Mr.TITLE,Cr.ENTER,[],{},".chart",1),Ss=new Ir(new qi,Mr.TEXT,Cr.HIGHLIGHT,["chart","without-mark","enter"],{},".annotation",1),As=new Ir(new yi,Mr.LINE_CHART_WITH_LEGEND,Cr.ENTER,[],{},".chart",1),Ns=new Ir(new Ii,Mr.LINE_CHART_WITH_LEGEND,Cr.ENTER,[],{},".mark",1),Os=new Ir(new bi,Mr.LINE_CHART_WITH_LEGEND,Cr.ENTER,[],{},".chart",1),Rs=new Ir(new Li,Mr.LINE_CHART_WITH_LEGEND,Cr.ENTER,[],{},".mark",1),Ms=new Ir(new wi,Mr.LINE_CHART,Cr.ENTER,[],{},".chart",1),Cs=new Ir(new Ci,Mr.LINE_CHART,Cr.ENTER,[],{},".mark",1),Is=new Ir(new ki,Mr.LINE_CHART_WITH_LEGEND,Cr.HIGHLIGHT,[],{},".first",1),Ls=[jn,$n,Vn,Fn,Dn,kn,Kn,Yn,Wn,Pn,ms,fs,Qn,es,Jn,Ln,Gn,Un,Zn,hs,ps,gs,us,Xn,Ss,Es,ls,cs,ts,ns,bs,Ms,As,Os,vs,is,ss,as,ys,xs,ws,_s,Ts,In,Bn,Cn,Hn,qn,zn,rs,Cs,Rs,Ns,Is];var ks=a("2ef0"),Ps=a.n(ks);class Bs{constructor(){Object(me["a"])(this,"previewerType",void 0),Object(me["a"])(this,"previewWrapper",void 0),Object(me["a"])(this,"previewerContext",void 0),Object(me["a"])(this,"timeline",void 0),this.previewerType=Mr.BLANK}init(e,t){this.previewerContext=t,this.previewWrapper=e}clone(){return Ps.a.cloneDeep(this)}render(){this.clear();const{width:e,height:t}=this.getCanvasSize();this.previewerContext.rootSel.attr("viewBox",`0 0 ${e} ${t}`),this.draw(),setTimeout(()=>this.apply(),0)}clear(){this.previewerContext.rootSel.selectAll("*").remove(),this.previewerContext.globalSelection=null}draw(){throw"This previewer is abstract"}getCanvasSize(){return{width:200,height:150}}apply(){if(this.previewerType===Mr.BLANK)return void(this.timeline=be["a"].timeline());this.previewerContext.globalSelection=this.previewerContext.rootSel.selectAll("*");const e=this.previewWrapper.createPreviewAnimation(),t=this.previewerContext.createRootContext(),a=t.deriveBy(this.previewWrapper.target);this.timeline=e.create(a),this.timeline.repeat(-1).repeatDelay(1).pause().progress(this.previewWrapper.staticProgress)}pause(){this.timeline?this.timeline.pause().progress(this.previewWrapper.staticProgress):console.warn("Previewer timeline is not ready")}getDuration(){if(this.timeline)return this.timeline.duration();console.warn("Previewer timeline is not ready")}restart(){this.timeline?this.timeline.restart():console.warn("Previewer timeline is not ready")}}class js extends Bs{constructor(){super(),this.previewerType=Mr.BLANK}draw(){const e=this.previewerContext.rootSel,{width:t,height:a}=this.getCanvasSize();e.append("text").attr("transform","translate("+[t/2,a/2]+")").attr("text-anchor","middle").attr("fill","gray").attr("opacity",.5).style("font-family","Verdana, Arial, Helvetica, sans-serif").text("No preview is available")}}class Gs extends Bs{constructor(){super(),this.previewerType=Mr.GENERAL}draw(){const e=this.previewerContext.rootSel,{width:t,height:a}=this.getCanvasSize(),r=25,i=5,n=[70,70],s=n.length*r+(n.length+3)*i,o=(t-s)/2,l=(a+Math.max(...n))/2,c=["first","second","third","forth"],d=e.append("g").classed("chart group",!0),u=d.append("g").classed("mark group",!0);u.selectAll(".bar.glyph").data(n).enter().append("rect").each((function(e,t){Ma["k"](this).classed("bar glyph "+c[t],!0)})).attr("width",r).attr("height",e=>e).attr("x",(e,t)=>o+(t+2)*i+t*r).attr("y",e=>l-e).attr("fill","#409eff").attr("rx",5).attr("ry",5)}}class Ds extends Bs{constructor(){super(),this.previewerType=Mr.MOVE}draw(){const e=this.previewerContext.rootSel,{width:t,height:a}=this.getCanvasSize(),r=20,i=70;e.append("circle").classed("start circle shadow",!0).attr("fill","#409eff").attr("r",r).attr("cx",(t-i)/2).attr("cy",a/2).attr("opacity",.5),e.append("circle").classed("target circle",!0).attr("fill","#409eff").attr("r",r).attr("cx",(t-i)/2).attr("cy",a/2)}}class Us extends Bs{constructor(){super(),this.previewerType=Mr.ANNOTATION_ARROW}draw(){const e=this.previewerContext.rootSel,{width:t,height:a}=this.getCanvasSize(),r=25,i=5,n=[70,83,70,110],s=n.length*r+(n.length+3)*i,o=(t-s)/2,l=(a+Math.max(...n))/2,c=["first","second","third","forth"],d=e.append("g").classed("chart group",!0).attr("transform","scale(1.4)").style("transform-origin",t/2+"px 0px"),u=d.append("g").classed("mark-group",!0);u.selectAll(".bar.mark").data(n).enter().append("rect").each((function(e,t){Ma["k"](this).classed("mark bar "+c[t],!0)})).attr("width",r).attr("height",e=>e).attr("x",(e,t)=>o+(t+2)*i+t*r).attr("y",e=>l-e).attr("fill","#409eff").attr("rx",5).attr("ry",5),d.append("line").classed("line axis domain",!0).attr("x1",o).attr("y1",l).attr("x2",o+s).attr("y2",l).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round");const h=d.append("g").classed("annotation-group",!0),p=o+2*i+r/2,g=l-n[0];h.append("text").classed("annotation label",!0).attr("transform",`translate(${p},${g-30})`).style("text-anchor","middle").attr("font-size",20).attr("font-weight","bold").attr("font-family","system-ui").attr("fill","#3b3b3b").text("21"),h.append("g").classed("annotation arrow",!0).attr("transform",`translate(${p-16},${g-30})`).append("svg").attr("width",30).attr("height",30).attr("viewBox","0 0 1024 1024").append("path").attr("d","M819.07712 636.39552l-225.4848 191.488a81.73568 81.73568 0 0 1-53.0432 19.47648 81.77664 81.77664 0 0 1-53.02272-19.47648l-225.4848-191.488a81.92 81.92 0 1 1 106.06592-124.86656l90.5216 76.88192v-329.8304a81.92 81.92 0 0 1 163.84 0v329.8304l90.54208-76.88192a81.89952 81.89952 0 1 1 106.06592 124.86656z").attr("stroke","#3b3b3b")}}class $s extends Bs{constructor(){super(),this.previewerType=Mr.CAMERA}draw(){const e=this.previewerContext.rootSel,{width:t,height:a}=this.getCanvasSize(),r=25,i=5,n=[70,83,70,110],s=n.length*r+(n.length+3)*i,o=(t-s)/2,l=(a+Math.max(...n))/2,c=["first","second","third","forth"],d=e.append("g").classed("scene chart-group group container",!0),u=d.append("g").classed("mark group",!0);u.selectAll(".bar.glyph").data(n).enter().append("rect").each((function(e,t){Ma["k"](this).classed("chart mark bar "+c[t],!0)})).attr("width",r).attr("height",e=>e).attr("x",(e,t)=>o+(t+2)*i+t*r).attr("y",e=>l-e).attr("fill","#409eff").attr("rx",5).attr("ry",5),d.append("line").classed("chart line axis domain",!0).attr("x1",o).attr("y1",l).attr("x2",o+s).attr("y2",l).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round")}}class Hs{constructor({width:e,height:t,topRatio:a,bottomRatio:r,leftRatio:i,rightRatio:n}){Object(me["a"])(this,"width",void 0),Object(me["a"])(this,"height",void 0),Object(me["a"])(this,"topRatio",void 0),Object(me["a"])(this,"bottomRatio",void 0),Object(me["a"])(this,"leftRatio",void 0),Object(me["a"])(this,"rightRatio",void 0),Object(me["a"])(this,"origin",void 0),Object(me["a"])(this,"top",void 0),Object(me["a"])(this,"bottom",void 0),Object(me["a"])(this,"left",void 0),Object(me["a"])(this,"right",void 0),Object(me["a"])(this,"chartHeight",void 0),Object(me["a"])(this,"chartWidth",void 0),this.width=e,this.height=t,this.topRatio=a,this.bottomRatio=r,this.leftRatio=i,this.rightRatio=n,this.initLayout()}initLayout(){this.origin={x:this.width*this.leftRatio,y:this.height*(1-this.bottomRatio)},this.top=this.height*this.topRatio,this.bottom=this.height*this.bottomRatio,this.left=this.width*this.leftRatio,this.right=this.width*this.rightRatio,this.chartHeight=this.height-this.top-this.bottom,this.chartWidth=this.width-this.left-this.right}}class Fs extends Bs{constructor(){super(),this.previewerType=Mr.BAR_CHART}draw(){const e=this.previewerContext.rootSel,{width:t,height:a}=this.getCanvasSize(),r=[{name:"A",value:22},{name:"B",value:37}],i=[0,20,40],n=new Hs({width:t,height:a,topRatio:.3,bottomRatio:.17,leftRatio:.2,rightRatio:.2}),s=.3,o=.8,l=Ma["g"]().domain(r.map(e=>e.name)).range([0,n.chartWidth]).padding(s),c=Ma["h"]().domain([0,Ma["e"](r,e=>e.value)/o]).range([0,n.chartHeight]),d=e.append("g").classed("chart-group",!0),u=d.append("g").classed("axis-group",!0),h=u.append("g").classed("x-axis-group",!0).attr("transform",`translate(${n.origin.x},${n.origin.y})`);h.selectAll("text").data(r).enter().append("text").classed("chart axis x-axis label",!0).attr("ac-data",e=>JSON.stringify(e)).attr("transform",e=>`translate(${l(e.name)+l.bandwidth()/2},0)`).attr("dy",18).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text((e,t)=>["A","B"][t]),h.append("text").classed("chart axis x-axis title",!0).attr("transform",`translate(${n.chartWidth},0)`).attr("dx",10).attr("dy",5).attr("font-weight","bold").attr("fill","#3d3d3d").text("X"),h.append("line").classed("chart axis x-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",n.chartWidth).attr("y2",0).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round");const p=u.append("g").classed("y-axis-group",!0).attr("transform",`translate(${n.origin.x},${n.top})`);p.selectAll("line.tick").data(i.slice(1)).enter().append("line").classed("chart axis y-axis tick",!0).attr("transform",e=>`translate(0,${n.chartHeight-c(e)})`).attr("x1",0).attr("y1",0).attr("x2",n.chartWidth).attr("y2",0).attr("stroke","#d9d9d9").attr("stroke-width",4).attr("stroke-linecap","round"),p.selectAll("text").data(i).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(0,${n.chartHeight-c(e)})`).attr("dx",-14).attr("dy",8.5).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),p.append("line").classed("chart axis y-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",n.chartHeight).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round"),p.append("text").classed("chart axis y-axis title",!0).attr("dy",-5).attr("dx",-8).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Y");const g=d.append("g").classed("mark-group",!0).attr("transform",`translate(${n.left},${n.top})`);g.selectAll("rect").data(r).enter().append("rect").classed("chart mark bar",!0).attr("ac-data",e=>JSON.stringify(e)).attr("width",l.bandwidth()).attr("height",e=>c(e.value)).attr("x",e=>l(e.name)).attr("y",e=>n.chartHeight-c(e.value)).attr("fill","#409eff").attr("rx",5).attr("ry",5),g.selectAll("text").data(r).enter().append("text").attr("ac-data",e=>JSON.stringify(e)).classed("chart mark label bar-label",!0).attr("transform",e=>`translate(${l(e.name)+l.bandwidth()/2},${n.chartHeight-c(e.value)})`).attr("dy",-10).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e.value);const m=d.append("g").classed("title-group",!0);m.append("text").classed("chart title main-title",!0).attr("transform",`translate(${n.left+n.chartWidth/2},${n.top})`).attr("dy",-20).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Bar Chart")}}class Vs extends Bs{constructor(){super(),this.previewerType=Mr.BAR_CHART_WITH_LEGEND}draw(){const e=this.previewerContext.rootSel,{width:t,height:a}=this.getCanvasSize(),r=[{name:"A",value:22},{name:"B",value:37}],i=[{name:"A",value:30},{name:"B",value:15}],n=[0,20,40],s=new Hs({width:t,height:a,topRatio:.3,bottomRatio:.17,leftRatio:.2,rightRatio:.2}),o=.3,l=.8,c=Ma["g"]().domain(r.map(e=>e.name)).range([0,s.chartWidth]).padding(o),d=Ma["h"]().domain([0,Ma["e"](r,e=>e.value)/l]).range([0,s.chartHeight]),u=e.append("g").classed("chart-group",!0),h=u.append("g").classed("axis-group",!0),p=h.append("g").classed("x-axis-group",!0).attr("transform",`translate(${s.origin.x},${s.origin.y})`);p.selectAll("text").data(r).enter().append("text").classed("chart axis x-axis label",!0).attr("ac-data",e=>JSON.stringify(e)).attr("transform",e=>`translate(${c(e.name)+c.bandwidth()/2},0)`).attr("dy",18).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text((e,t)=>["A","B"][t]),p.append("text").classed("chart axis x-axis title",!0).attr("transform",`translate(${s.chartWidth},0)`).attr("dx",10).attr("dy",5).attr("font-weight","bold").attr("fill","#3d3d3d").text("X"),p.append("line").classed("chart axis x-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",s.chartWidth).attr("y2",0).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round");const g=h.append("g").classed("y-axis-group",!0).attr("transform",`translate(${s.origin.x},${s.top})`);g.selectAll("line.tick").data(n.slice(1)).enter().append("line").classed("chart axis y-axis tick",!0).attr("transform",e=>`translate(0,${s.chartHeight-d(e)})`).attr("x1",0).attr("y1",0).attr("x2",s.chartWidth).attr("y2",0).attr("stroke","#d9d9d9").attr("stroke-width",4).attr("stroke-linecap","round"),g.selectAll("text").data(n).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(0,${s.chartHeight-d(e)})`).attr("dx",-14).attr("dy",8.5).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),g.append("line").classed("chart axis y-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",s.chartHeight).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round"),g.append("text").classed("chart axis y-axis title",!0).attr("dy",-5).attr("dx",-8).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Y");const m=u.append("g").classed("mark-group",!0).attr("transform",`translate(${s.left},${s.top})`),f=m.append("g").classed("mark-1-group",!0);f.selectAll("rect").data(r).enter().append("rect").classed("chart mark bar",!0).attr("ac-data",e=>JSON.stringify(e)).attr("width",c.bandwidth()/2).attr("height",e=>d(e.value)).attr("x",e=>c(e.name)-1).attr("y",e=>s.chartHeight-d(e.value)).attr("fill","#409eff").attr("rx",5).attr("ry",5),f.selectAll("text").data(r).enter().append("text").attr("ac-data",e=>JSON.stringify(e)).classed("chart mark label bar-label",!0).attr("transform",e=>`translate(${c(e.name)+c.bandwidth()/4-3},${s.chartHeight-d(e.value)})`).attr("dy",-4).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e.value);const w=m.append("g").classed("mark-2-group",!0);w.selectAll("rect").data(i).enter().append("rect").classed("chart mark bar",!0).attr("ac-data",e=>JSON.stringify(e)).attr("width",c.bandwidth()/2).attr("height",e=>d(e.value)).attr("x",e=>c(e.name)+c.bandwidth()/2+1).attr("y",e=>s.chartHeight-d(e.value)).attr("fill","#9ecae1").attr("rx",5).attr("ry",5),w.selectAll("text").data(i).enter().append("text").attr("ac-data",e=>JSON.stringify(e)).classed("chart mark label bar-label",!0).attr("transform",e=>`translate(${c(e.name)+.75*c.bandwidth()+1},${s.chartHeight-d(e.value)})`).attr("dy",-4).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e.value);const y=u.append("g").classed("mark-group",!0);y.append("text").classed("chart mark legend",!0).attr("transform",`translate(${t-s.right},${s.top})`).attr("dx",0).attr("dy",8).attr("font-weight","bold").attr("fill","#409eff").text("ta"),y.append("rect").classed("chart mark legend",!0).attr("transform",`translate(${t-s.right},${s.top})`).attr("width",18).attr("height",8).attr("x",20).attr("y",0).attr("fill","#409eff"),y.append("text").classed("chart mark legend",!0).attr("transform",`translate(${t-s.right},${s.top})`).attr("dx",0).attr("dy",26).attr("font-weight","bold").attr("fill","#9ecae1").text("tb"),y.append("rect").classed("chart mark legend",!0).attr("transform",`translate(${t-s.right},${s.top})`).attr("width",18).attr("height",8).attr("x",20).attr("y",18).attr("fill","#9ecae1");const b=u.append("g").classed("title-group",!0);b.append("text").classed("chart title main-title",!0).attr("transform",`translate(${s.left+s.chartWidth/2},${s.top})`).attr("dy",-20).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Bar Chart with Legend")}}class Ws extends Bs{constructor(){super(),this.previewerType=Mr.CHART_FRAMEWORK}draw(){const e=this.previewerContext.rootSel,{width:t,height:a}=this.getCanvasSize(),r=[{name:"A",value:22},{name:"B",value:37}],i=[0,20,40],n=new Hs({width:t,height:a,topRatio:.3,bottomRatio:.17,leftRatio:.2,rightRatio:.2}),s=.3,o=.8,l=Ma["g"]().domain(r.map(e=>e.name)).range([0,n.chartWidth]).padding(s),c=Ma["h"]().domain([0,Ma["e"](r,e=>e.value)/o]).range([0,n.chartHeight]),d=e.append("g").classed("chart-group",!0),u=d.append("g").classed("axis-group",!0),h=u.append("g").classed("x-axis-group",!0).attr("transform",`translate(${n.origin.x},${n.origin.y})`);h.selectAll("text").data(r).enter().append("text").classed("chart axis x-axis label",!0).attr("ac-data",e=>JSON.stringify(e)).attr("transform",e=>`translate(${l(e.name)+l.bandwidth()/2},0)`).attr("dy",18).attr("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text((e,t)=>["A","B"][t]),h.append("text").classed("chart axis x-axis title",!0).attr("transform",`translate(${n.chartWidth},0)`).attr("dx",10).attr("dy",5).attr("font-weight","bold").attr("fill","#3d3d3d").text("X"),h.append("line").classed("chart axis x-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",n.chartWidth).attr("y2",0).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round");const p=u.append("g").classed("y-axis-group",!0).attr("transform",`translate(${n.origin.x},${n.top})`);p.selectAll("line.tick").data(i.slice(1)).enter().append("line").classed("chart axis y-axis tick",!0).attr("transform",e=>`translate(0,${n.chartHeight-c(e)})`).attr("x1",0).attr("y1",0).attr("x2",n.chartWidth).attr("y2",0).attr("stroke","#d9d9d9").attr("stroke-width",4).attr("stroke-linecap","round"),p.selectAll("text").data(i).enter().append("text").classed("chart axis y-axis label",!0).attr("ac-data",e=>e).attr("transform",e=>`translate(0,${n.chartHeight-c(e)})`).attr("dx",-14).attr("dy",8.5).attr("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),p.append("line").classed("chart axis y-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",n.chartHeight).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round"),p.append("text").classed("chart axis y-axis title",!0).attr("dy",-5).attr("dx",-8).attr("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Y");const g=d.append("g").classed("title-group",!0);g.append("text").classed("chart title main-title",!0).attr("transform",`translate(${n.left+n.chartWidth/2},${n.top})`).attr("dy",-20).attr("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Chart Title")}}class Js extends Bs{constructor(){super(),this.previewerType=Mr.CIRCLE_CHART}draw(){const e=this.previewerContext.rootSel,{width:t,height:a}=this.getCanvasSize(),r=[[22,11],[16,39],[22,20],[5,5],[29,39],[30,20],[10,18]],i=[0,15,30],n=[20,40],s=new Hs({width:t,height:a,topRatio:.3,bottomRatio:.17,leftRatio:.2,rightRatio:.2}),o=.8,l=.8,c=Ma["h"]().domain([0,Ma["e"](r,e=>e[0])/o]).range([0,s.chartWidth]),d=Ma["h"]().domain([0,Ma["e"](r,e=>e[1])/l]).range([0,s.chartHeight]),u=e.append("g").classed("chart-group",!0),h=u.append("g").classed("axis-group",!0),p=h.append("g").classed("x-axis-group",!0).attr("transform",`translate(${s.origin.x},${s.origin.y})`);p.selectAll("text").data(i).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(${c(e)},0)`).attr("dx",0).attr("dy",17).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),p.append("text").classed("chart axis x-axis title",!0).attr("transform",`translate(${s.chartWidth},0)`).attr("dx",10).attr("dy",5).attr("font-weight","bold").attr("fill","#3d3d3d").text("X"),p.append("line").classed("chart axis x-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",s.chartWidth).attr("y2",0).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round");const g=h.append("g").classed("y-axis-group",!0).attr("transform",`translate(${s.origin.x},${s.top})`);g.selectAll("text").data(n).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(0,${s.chartHeight-d(e)})`).attr("dx",-14).attr("dy",0).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),g.append("line").classed("chart axis y-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",s.chartHeight).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round"),g.append("text").classed("chart axis y-axis title",!0).attr("dy",-10).attr("dx",-5).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Y");const m=u.append("g").classed("mark-group",!0).attr("transform",`translate(${s.left},${s.top})`);m.selectAll("circle").data(r).enter().append("circle").classed("chart mark circle",!0).attr("cx",e=>c(e[0])).attr("cy",e=>s.chartHeight-d(e[1])).attr("r",5).attr("fill","#409eff");const f=u.append("g").classed("title-group",!0);f.append("text").classed("chart title main-title",!0).attr("transform",`translate(${s.left+s.chartWidth/2},${s.top})`).attr("dy",-20).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Scatter Chart")}}class qs extends Bs{constructor(){super(),this.previewerType=Mr.CIRCLE_CHART_WITH_LEGEND}draw(){const e=this.previewerContext.rootSel,{width:t,height:a}=this.getCanvasSize(),r=[[22,11],[16,39],[22,20],[5,5],[29,39],[30,20],[10,18]],i=[[29,39],[30,20],[10,18]],n=[[22,11],[16,39],[22,20],[5,5]],s=[0,15,30],o=[20,40],l=new Hs({width:t,height:a,topRatio:.3,bottomRatio:.17,leftRatio:.2,rightRatio:.35}),c=.8,d=.8,u=Ma["h"]().domain([0,Ma["e"](r,e=>e[0])/c]).range([0,l.chartWidth]),h=Ma["h"]().domain([0,Ma["e"](r,e=>e[1])/d]).range([0,l.chartHeight]),p=e.append("g").classed("chart-group",!0),g=p.append("g").classed("mark-group",!0);g.append("text").classed("chart mark legend",!0).attr("transform",`translate(${t-l.right},${l.top})`).attr("dx",0).attr("dy",8).attr("font-weight","bold").attr("fill","#409eff").text("ta"),g.append("rect").classed("chart mark legend",!0).attr("transform",`translate(${t-l.right},${l.top})`).attr("width",18).attr("height",8).attr("x",20).attr("y",0).attr("fill","#409eff"),g.append("text").classed("chart mark legend",!0).attr("transform",`translate(${t-l.right},${l.top})`).attr("dx",0).attr("dy",26).attr("font-weight","bold").attr("fill","#9ecae1").text("tb"),g.append("rect").classed("chart mark legend",!0).attr("transform",`translate(${t-l.right},${l.top})`).attr("width",18).attr("height",8).attr("x",20).attr("y",18).attr("fill","#9ecae1");const m=p.append("g").classed("axis-group",!0),f=m.append("g").classed("x-axis-group",!0).attr("transform",`translate(${l.origin.x},${l.origin.y})`);f.selectAll("text").data(s).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(${u(e)},0)`).attr("dx",0).attr("dy",17).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),f.append("text").classed("chart axis x-axis title",!0).attr("transform",`translate(${l.chartWidth},0)`).attr("dx",10).attr("dy",5).attr("font-weight","bold").attr("fill","#3d3d3d").text("X"),f.append("line").classed("chart axis x-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",l.chartWidth).attr("y2",0).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round");const w=m.append("g").classed("y-axis-group",!0).attr("transform",`translate(${l.origin.x},${l.top})`);w.selectAll("text").data(o).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(0,${l.chartHeight-h(e)})`).attr("dx",-14).attr("dy",0).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),w.append("line").classed("chart axis y-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",l.chartHeight).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round"),w.append("text").classed("chart axis y-axis title",!0).attr("dy",-10).attr("dx",-5).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Y");const y=p.append("g").classed("mark-group",!0),b=y.append("g").classed("x-axis-group",!0).attr("transform",`translate(${l.left},${l.top})`);b.selectAll("circle").data(i).enter().append("circle").classed("chart mark circle",!0).attr("cx",e=>u(e[0])).attr("cy",e=>l.chartHeight-h(e[1])).attr("r",5).attr("fill","#409eff");const x=y.append("g").classed("x-axis-group",!0).attr("transform",`translate(${l.left},${l.top})`);x.selectAll("circle").data(n).enter().append("circle").classed("chart mark circle",!0).attr("cx",e=>u(e[0])).attr("cy",e=>l.chartHeight-h(e[1])).attr("r",5).attr("fill","#9ecae1");const v=p.append("g").classed("title-group",!0);v.append("text").classed("chart title main-title",!0).attr("transform",`translate(${l.left+l.chartWidth/2},${l.top})`).attr("dy",-30).attr("dx",5).attr("font-size",13).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Scatter Chart with Legend")}}class zs extends Bs{constructor(){super(),this.previewerType=Mr.PIE_CHART}draw(){const e=this.previewerContext.rootSel,{width:t,height:a}=this.getCanvasSize(),r=[20,25,55],i=55,n=20,s=Ma["f"]()(r),o=["#409eff","#9ecae1","#2171b5"],l=Ma["i"](o),c=["first","second","third"],d=Ma["a"]().innerRadius(n).outerRadius(i).padAngle(.02),u=e.append("g").classed("chart-group",!0),h=u.append("g").classed("mark-group",!0);h.selectAll("path").data(s).enter().append("path").each((function(e,t){Ma["k"](this).classed("chart mark sector sector-wheel "+c[t],!0)})).attr("transform","translate("+t/2+","+(a/2+10)+")").attr("fill",(e,t)=>l(t)).attr("d",e=>d(e));const p=u.append("g").classed("label-group",!0);p.selectAll("text").data(s).enter().append("text").each((function(e,t){Ma["k"](this).classed("cchart label sector-label "+c[t],!0)})).attr("transform",e=>"translate("+d.centroid(e)+")").attr("dx",100).attr("dy",90).attr("fill","white").attr("text-anchor","middle").text(e=>e.data+"%")}}class Ks extends Bs{constructor(){super(),this.previewerType=Mr.PIE_WITH_LEGEND}draw(){const e=this.previewerContext.rootSel,{width:t,height:a}=this.getCanvasSize(),r=[20,25,55],i=55,n=20,s=new Hs({width:t,height:a,topRatio:.3,bottomRatio:.17,leftRatio:.2,rightRatio:.35}),o=Ma["f"]()(r),l=["#409eff","#9ecae1","#2171b5"],c=Ma["i"](l),d=Ma["a"]().innerRadius(n).outerRadius(i).padAngle(.02),u=["first","second","third"],h=e.append("g").classed("chart-group",!0),p=h.append("g").classed("mark-group",!0),g=h.append("g").classed("label-group",!0),m=h.append("g").classed("mark-group",!0);for(var f=0;f<r.length;f++)p.append("path").classed("chart mark sector sector-wheel "+u[f],!0).attr("transform","translate("+(t/2-20)+","+(a/2+10)+")").attr("fill",c(f)).attr("d",d(o[f])),g.append("text").classed("chart mark arc-label "+u[f],!0).attr("transform","translate("+d.centroid(o[f])+")").attr("dx",80).attr("dy",90).attr("fill","white").attr("text-anchor","middle").text(o[f].data+"%"),m.append("text").classed("chart mark legend legend-label "+u[f],!0).attr("transform",`translate(${t-40},${s.top})`).attr("dx",0).attr("dy",13*(f+1)-4).attr("font-weight","bold").attr("fill",c(f)).text("ta"),m.append("rect").classed("chart mark legend legend-symbol "+u[f],!0).attr("transform",`translate(${t-40},${s.top})`).attr("width",18).attr("height",8).attr("x",20).attr("y",13*f).attr("fill",c(f))}}class Ys extends Bs{constructor(){super(),this.previewerType=Mr.TEXT}draw(){const e=this.previewerContext.rootSel,{width:t,height:a}=this.getCanvasSize(),r=e.append("g").classed("chart-group",!0),i=r.append("g").classed("annotation-group",!0);i.append("text").classed("annotation label number",!0).attr("transform","translate("+t/2+","+(a/2+10)+")").attr("dy",0).attr("dx",0).attr("font-size",35).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("66%")}}class Xs extends Bs{constructor(){super(),this.previewerType=Mr.TITLE}draw(){const e=this.previewerContext.rootSel,{width:t,height:a}=this.getCanvasSize(),r=e.append("g").classed("chart-group",!0),i=r.append("g").classed("title-group",!0);i.append("text").classed("chart title main-title",!0).attr("transform","translate("+t/3+","+a/3+")").attr("dy",0).attr("dx",0).attr("font-size",25).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("main title"),i.append("text").classed("chart title sub-title",!0).attr("transform","translate("+t/2+","+(a/2+10)+")").attr("dy",0).attr("dx",0).attr("font-size",20).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("—— sub title")}}class Zs extends Bs{constructor(){super(),this.previewerType=Mr.LINE_CHART}draw(){const e=this.previewerContext.rootSel,{width:t,height:a}=this.getCanvasSize(),r=[[5,15],[15,18],[22,20],[29,39]],i=[0,15,30],n=[20,40],s=new Hs({width:t,height:a,topRatio:.3,bottomRatio:.17,leftRatio:.2,rightRatio:.2}),o=.8,l=.8,c=Ma["h"]().domain([0,Ma["e"](r,e=>e[0])/o]).range([0,s.chartWidth]),d=Ma["h"]().domain([0,Ma["e"](r,e=>e[1])/l]).range([0,s.chartHeight]),u=e.append("g").classed("chart-group",!0),h=u.append("g").classed("axis-group",!0),p=h.append("g").classed("x-axis-group",!0).attr("transform",`translate(${s.origin.x},${s.origin.y})`);p.selectAll("text").data(i).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(${c(e)},0)`).attr("dx",0).attr("dy",17).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),p.append("text").classed("chart axis x-axis title",!0).attr("transform",`translate(${s.chartWidth},0)`).attr("dx",10).attr("dy",5).attr("font-weight","bold").attr("fill","#3d3d3d").text("X"),p.append("line").classed("chart axis x-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",s.chartWidth).attr("y2",0).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round");const g=h.append("g").classed("y-axis-group",!0).attr("transform",`translate(${s.origin.x},${s.top})`);g.selectAll("text").data(n).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(0,${s.chartHeight-d(e)})`).attr("dx",-14).attr("dy",0).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),g.append("line").classed("chart axis y-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",s.chartHeight).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round"),g.append("text").classed("chart axis y-axis title",!0).attr("dy",-10).attr("dx",-5).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Y");const m=u.append("g").classed("mark-group",!0),f=m.append("g").classed("label-group",!0).attr("transform",`translate(${s.left},${s.top})`);f.selectAll("text").data(r).enter().append("text").classed("chart mark label",!0).attr("dx",e=>c(e[0])).attr("dy",e=>s.chartHeight-d(e[1])-15).style("text-anchor","middle").attr("fill","#3d3d3d").text(e=>e[1]);const w=m.append("g").classed("mark-group",!0).attr("transform",`translate(${s.left},${s.top})`);w.selectAll("circle").data(r).enter().append("circle").classed("chart mark circle",!0).attr("cx",e=>c(e[0])).attr("cy",e=>s.chartHeight-d(e[1])).attr("r",5).attr("fill","#409eff");const y=m.append("g").classed("line-group",!0);for(var b=0;b<r.length;b++)r[b][0]=c(r[b][0]),r[b][1]=s.chartHeight-d(r[b][1]);y.append("polyline").classed("chart mark line",!0).attr("transform",`translate(${s.left},${s.top})`).attr("points",r).attr("fill","none").attr("stroke","#409eff").attr("stroke-width",4).attr("stroke-linecap","round");const x=u.append("g").classed("title-group",!0);x.append("text").classed("chart title main-title",!0).attr("transform",`translate(${s.left+s.chartWidth/2},${s.top})`).attr("dy",-20).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Line Chart")}}class Qs extends Bs{constructor(){super(),this.previewerType=Mr.LINE_CHART_WITH_LEGEND}draw(){const e=this.previewerContext.rootSel,{width:t,height:a}=this.getCanvasSize(),r=[[5,15],[15,18],[22,20],[29,39]],i=[[5,26],[15,28],[22,36],[29,10]],n=[0,15,30],s=[20,40],o=new Hs({width:t,height:a,topRatio:.3,bottomRatio:.17,leftRatio:.2,rightRatio:.2}),l=.8,c=.8,d=Ma["h"]().domain([0,Ma["e"](r,e=>e[0])/l]).range([0,o.chartWidth]),u=Ma["h"]().domain([0,Ma["e"](r,e=>e[1])/c]).range([0,o.chartHeight]),h=e.append("g").classed("chart-group",!0),p=h.append("g").classed("axis-group",!0),g=p.append("g").classed("x-axis-group",!0).attr("transform",`translate(${o.origin.x},${o.origin.y})`);g.selectAll("text").data(n).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(${d(e)},0)`).attr("dx",0).attr("dy",17).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),g.append("text").classed("chart axis x-axis title",!0).attr("transform",`translate(${o.chartWidth},0)`).attr("dx",10).attr("dy",5).attr("font-weight","bold").attr("fill","#3d3d3d").text("X"),g.append("line").classed("chart axis x-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",o.chartWidth).attr("y2",0).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round");const m=p.append("g").classed("y-axis-group",!0).attr("transform",`translate(${o.origin.x},${o.top})`);m.selectAll("text").data(s).enter().append("text").classed("chart axis y-axis label",!0).attr("transform",e=>`translate(0,${o.chartHeight-u(e)})`).attr("dx",-14).attr("dy",0).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text(e=>e),m.append("line").classed("chart axis y-axis domain",!0).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",o.chartHeight).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round"),m.append("text").classed("chart axis y-axis title",!0).attr("dy",-3).attr("dx",-5).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Y");const f=h.append("g").classed("mark-group",!0);f.append("text").classed("chart mark legend",!0).attr("transform",`translate(${t-o.right},${o.top})`).attr("dx",0).attr("dy",8).attr("font-weight","bold").attr("fill","#409eff").text("ta"),f.append("rect").classed("chart mark legend",!0).attr("transform",`translate(${t-o.right},${o.top})`).attr("width",18).attr("height",8).attr("x",20).attr("y",0).attr("fill","#409eff"),f.append("text").classed("chart mark legend",!0).attr("transform",`translate(${t-o.right},${o.top})`).attr("dx",0).attr("dy",26).attr("font-weight","bold").attr("fill","#9ecae1").text("tb"),f.append("rect").classed("chart mark legend",!0).attr("transform",`translate(${t-o.right},${o.top})`).attr("width",18).attr("height",8).attr("x",20).attr("y",18).attr("fill","#9ecae1");const w=h.append("g").classed("mark-group",!0),y=w.append("g").classed("mark-group",!0).attr("transform",`translate(${o.left},${o.top})`),b=y.append("g").classed("scatter1-group",!0);b.selectAll("circle").data(r).enter().append("circle").classed("chart mark circle",!0).attr("cx",e=>d(e[0])).attr("cy",e=>o.chartHeight-u(e[1])).attr("r",5).attr("fill","#409eff");const x=y.append("g").classed("scatter2-group",!0);x.selectAll("circle").data(i).enter().append("circle").classed("chart mark circle",!0).attr("cx",e=>d(e[0])).attr("cy",e=>o.chartHeight-u(e[1])).attr("r",5).attr("fill","#9ecae1");for(var v=0;v<r.length;v++)r[v][0]=d(r[v][0]),r[v][1]=o.chartHeight-u(r[v][1]);for(v=0;v<i.length;v++)i[v][0]=d(i[v][0]),i[v][1]=o.chartHeight-u(i[v][1]);const _=w.append("g").classed("line-group",!0),T=_.append("g").classed("line1-group",!0);T.append("polyline").classed("chart mark line first",!0).attr("transform",`translate(${o.left},${o.top})`).attr("points",r).attr("fill","none").attr("stroke","#409eff").attr("stroke-width",4).attr("stroke-linecap","round");const E=_.append("g").classed("line2-group",!0);E.append("polyline").classed("chart mark line second",!0).attr("transform",`translate(${o.left},${o.top})`).attr("points",i).attr("fill","none").attr("stroke","#9ecae1").attr("stroke-width",4).attr("stroke-linecap","round");const S=h.append("g").classed("title-group",!0);S.append("text").classed("chart title main-title",!0).attr("transform",`translate(${o.left+o.chartWidth/2},${o.top})`).attr("dy",-20).style("text-anchor","middle").attr("font-weight","bold").attr("fill","#3d3d3d").text("Line Chart with Legend")}}class eo extends Bs{constructor(){super(),this.previewerType=Mr.PATH}draw(){const e=this.previewerContext.rootSel,{width:t,height:a}=this.getCanvasSize(),r=[[5,10],[40,10],[40,35],[5,35],[5,10]],i=new Hs({width:t,height:a,topRatio:.3,bottomRatio:.17,leftRatio:.2,rightRatio:.2}),n=.8,s=.8,o=Ma["h"]().domain([0,Ma["e"](r,e=>e[0])/n]).range([0,i.chartWidth]),l=Ma["h"]().domain([0,Ma["e"](r,e=>e[1])/s]).range([0,i.chartHeight]),c=e.append("g").classed("chart-group",!0),d=c.append("g").classed("annotation-group",!0);for(var u=0;u<r.length;u++)r[u][0]=o(r[u][0]),r[u][1]=i.chartHeight-l(r[u][1]);d.append("polyline").classed("chart annotation path",!0).attr("transform",`translate(${i.left},${i.top})`).attr("points",r).attr("fill","none").attr("stroke","#409eff").attr("stroke-width",4).attr("stroke-linecap","round")}}class to extends Bs{constructor(){super(),this.previewerType=Mr.HIGHLIGHT}draw(){const e=this.previewerContext.rootSel,{width:t,height:a}=this.getCanvasSize(),r=25,i=5,n=[70,70,70],s=n.length*r+(n.length+3)*i,o=(t-s)/2,l=(a+Math.max(...n))/2,c=["first","second","third","forth"],d=e.append("g").classed("chart group",!0),u=d.append("g").classed("mark group",!0);u.selectAll(".bar.glyph").data(n).enter().append("rect").each((function(e,t){Ma["k"](this).classed("bar glyph "+c[t],!0)})).attr("width",r).attr("height",e=>e).attr("x",(e,t)=>o+(t+2)*i+t*r).attr("y",e=>l-e).attr("fill","#409eff").attr("rx",5).attr("ry",5),d.append("rect").attr("width",r).attr("height",70).attr("x",o+5*i+3*r).attr("y",l-70).attr("fill","#409eff").attr("rx",5).attr("ry",5),d.append("line").classed("line axis domain",!0).attr("x1",o).attr("y1",l).attr("x2",o+s).attr("y2",l).attr("stroke","#808080").attr("stroke-width",4).attr("stroke-linecap","round")}}const ao=[new js,new Gs,new Ds,new Us,new $s,new Fs,new Vs,new Ws,new Js,new qs,new zs,new Ks,new Ys,new Xs,new Zs,new Qs,new eo,new to];function ro(e){this.message=e}class io{constructor(){Object(me["a"])(this,"parser",void 0),Object(me["a"])(this,"generator",void 0),Object(me["a"])(this,"templateLib",void 0),Object(me["a"])(this,"previewerManager",void 0),this.parser=new _r,this.templateLib=new Rr,Mn.forEach(e=>this.templateLib.registerBuildInTemplate(e)),this.previewerManager=new Lr(this.templateLib),Ls.forEach(e=>this.previewerManager.registerPreviewWrapper(e)),ao.forEach(e=>this.previewerManager.registerPreviewer(e))}compile(e,t,a={}){console.log("animationJSON",t),null!=t.variable&&null!=t.sequence&&(t=this.createReplacedAnimationJSON(t,t.variable)),jt.traversalObject(t,(e,t,a)=>{t&&null!=t.variable&&null!=t.sequence&&(a[e]=this.createReplacedAnimationJSON(t,t.variable))});const r=dr.fromJSON(t);if(!r)throw new ro("No Animation!");const i=Ma["k"](e);this.generator=new Or,this.generator.init(i,this.templateLib,r),i.selectAll("*").each((function(){this._original={},"function"===typeof this.getCTM&&(this._original.CTM=this.getCTM())}));const n=this.generator.generate(),s=be["a"].timeline({autoRemoveChildren:!1,...a});return s.add(n),s.pause(),s}computePossibleElements(e,t){const a=Ma["k"](e).node(),r=Ma["k"](a.cloneNode(!0));return this.generator=new Or,this.generator.init(r,this.templateLib,null),this.generator.computePossibleElements(t)}computeDuration(e,t,a){null!=a&&(t=this.createReplacedAnimationJSON(t,a));const r=dr.fromJSON(t),i=Ma["k"](e).node(),n=Ma["k"](i.cloneNode(!0));return this.generator=new Or,this.generator.init(n,this.templateLib,r),this.generator.computeDuration()||1}createReplacedAnimationJSON(e,t){const a=mr.deepCopy(e);return mr.traversalObject(a,(e,a,r)=>{if("string"===typeof a&&a.includes("$"))if(a=a.trim(),a.match(/^\$[0-9a-zA-Z]*$/)){const i=a.substr(1);i in t&&(r[e]=t[i])}else{let i=a;Object.keys(t).forEach(e=>{i=i.replaceAll("$"+e,t[e])}),r[e]=i}}),console.log("animationJSON",a),a}}const no={GENERAL:"General",MARK:"Mark",ANNOTATION:"Annotation",CHART:"Chart"};class so{constructor(e,t,a,r,i,n){Object(me["a"])(this,"name",void 0),Object(me["a"])(this,"hardElement",void 0),Object(me["a"])(this,"softElement",void 0),Object(me["a"])(this,"componentType",void 0),Object(me["a"])(this,"animationType",void 0),Object(me["a"])(this,"effectList",void 0),this.name=e,this.hardElement=t,this.softElement=a,this.componentType=r,this.animationType=i,this.effectList=n}clone(){return new so(this.name,this.hardElement,this.softElement,this.componentType,this.animationType,this.effectList)}getName(){return this.name}getHardElement(){return this.hardElement}getSoftElement(){return this.softElement}getComponentType(){return this.componentType}getAnimationType(){return this.animationType}getEffectList(){return this.effectList}relatedTargets(e){const t=[];return e.forEach(e=>{const a=e.classList;(this.hardElement.some(e=>a.includes(e))||this.softElement.some(e=>a.includes(e)))&&t.push(e)}),t}hasLabel(e){const t=e.classList;return t.includes("x-label")||t.includes("y-label")||t.includes("sector-label")||t.includes("legend-label")}isWanted(e,t){const a=e.classList;let r=[];return t.forEach(e=>{const t=e.split(" | ");r=r.concat(t)}),r.some(e=>a.includes(e))}shouldAppear(e){return 0===this.hardElement.length&&0===this.softElement.length||!!this.hardElement.every(t=>{const a=t.split(" | "),r=a.length;if(1===r)return e.some(e=>e.classList.includes(t));{let t=!1;return a.forEach(a=>{t||(t=e.some(e=>e.classList.includes(a)))}),t}})&&e.every(e=>this.isWanted(e,this.hardElement)||this.isWanted(e,this.softElement))}}const oo=new so("Bar with axis label",["bar","axis symbol | x-symbol | y-symbol"],["bar-label","label"],no.MARK,Cr.ENTER,["grow bar and zoom label"]),lo=new so("Bar with legend",["bar","legend"],["bar-label","label"],no.MARK,Cr.ENTER,["grow bar and fade in legend"]),co=new so("Line-wipe",["line"],["scatter","label","point"],no.MARK,Cr.ENTER,["wipe line"]),uo=new so("Lines by legend",["line","legend"],["scatter","label","point"],no.MARK,Cr.ENTER,["wipe line and fade in legend"]),ho=new so("Lines by order",["line","legend"],["scatter","label","point"],no.MARK,Cr.ENTER,["wipe line and fade in legend"]),po=new so("Scatter chart",["scatter | point","axis"],["title","label"],no.MARK,Cr.ENTER,["fade in scatter and axis"]),go=new so("Scatter-fade in",["scatter | point"],["label"],no.MARK,Cr.ENTER,["fade in scatter"]),mo=new so("Scatter with legend",["scatter | point","legend"],["label"],no.MARK,Cr.ENTER,["fade in legend and scatter"]),fo=new so("Bar-grow",["bar"],["bar-label","label"],no.MARK,Cr.ENTER,["grow bar"]),wo=new so("Bar-bounce",["bar"],["bar-label","label"],no.MARK,Cr.HIGHLIGHT,["move to bar"]),yo=new so("Pie-wheel",["arc | sector | pie"],["sector-label","label","sector-line","anno-label"],no.MARK,Cr.ENTER,["fade in pie"]),bo=new so("Pie with legend",["arc | sector | pie","legend"],["sector-label","label","sector-line","anno-label","annotation"],no.MARK,Cr.ENTER,["fade in pie and fly in legend"]),xo=new so("Highlight-sector",["arc | sector | pie"],["sector-label","label","sector-line","anno-label"],no.MARK,Cr.HIGHLIGHT,["fade in pie"]),vo=new so("Line-highlight",["line"],[],no.MARK,Cr.HIGHLIGHT,["highlight line"]),_o=new so("Fade-in",[],[],no.GENERAL,Cr.ENTER,["fade in"]),To=new so("Hide",[],[],no.GENERAL,Cr.EXIT,["hide"]),Eo=new so("Grow",[],[],no.GENERAL,Cr.ENTER,["grow"]),So=new so("Float",[],[],no.GENERAL,Cr.ENTER,["float"]),Ao=new so("Zoom-enter",[],[],no.GENERAL,Cr.ENTER,["zoom"]),No=new so("Change-color",[],[],no.GENERAL,Cr.HIGHLIGHT,["change color"]),Oo=new so("Shine",[],[],no.GENERAL,Cr.HIGHLIGHT,["shine"]),Ro=new so("Show-path",["annotation"],[],no.ANNOTATION,Cr.HIGHLIGHT,["show path"]),Mo=new so("Highlight",[],[],no.GENERAL,Cr.HIGHLIGHT,["highlight"]),Co=new so("Camera-zoom",[],[],no.GENERAL,Cr.HIGHLIGHT,["camera zoom"]),Io=new so("Camera-move",[],[],no.GENERAL,Cr.HIGHLIGHT,["camera move"]),Lo=new so("Move-to",[],[],no.GENERAL,Cr.ENTER,["move to"]),ko=new so("Move-from",[],[],no.GENERAL,Cr.ENTER,["move from"]),Po=new so("Zoom-exit",[],[],no.GENERAL,Cr.EXIT,["zoom exit"]),Bo=new so("Fade-out",[],[],no.GENERAL,Cr.EXIT,["fade out"]),jo=new so("Fly-in",[],[],no.GENERAL,Cr.ENTER,["Fly-in"]),Go=new so("Zoom-in-then-zoom-out",[],[],no.GENERAL,Cr.HIGHLIGHT,["zoom-in-then-zoom-out"]),Do=new so("Show-arrow-label",["annotation","arrow"],[],no.ANNOTATION,Cr.HIGHLIGHT,["fade in then fade out annotation"]),Uo=new so("Circle",[],[],no.ANNOTATION,Cr.HIGHLIGHT,["circle"]),$o=new so("Arrow",[],[],no.ANNOTATION,Cr.HIGHLIGHT,["arrow"]),Ho=new so("Text",[],[],no.ANNOTATION,Cr.HIGHLIGHT,["text"]),Fo=new so("Contour",[],[],no.ANNOTATION,Cr.HIGHLIGHT,["contour"]),Vo=new so("Fade-in-then-fade-out",[],[],no.GENERAL,Cr.HIGHLIGHT,["fade in then fade out"]),Wo=new so("Dynamic-number",[],[],no.ANNOTATION,Cr.HIGHLIGHT,["dynamtic number"]),Jo=new so("Title",["title"],["subtitle"],no.CHART,Cr.ENTER,["fade in title"]),qo=new so("Axes float in",["axis"],["title"],no.CHART,Cr.ENTER,["float in axis"]),zo=new so("Axes fade in",["axis"],["title"],no.CHART,Cr.ENTER,["fade in axis"]),Ko=new so("Bar chart",["bar","axis"],["title","bar-label","label"],no.CHART,Cr.ENTER,["grow bar and fade in axis"]),Yo=new so("Bar chart with legend",["bar","axis","legend"],["title","bar-label","label"],no.CHART,Cr.ENTER,["grow bar and fade in axis and legend"]),Xo=new so("Scatter chart with legend",["scatter | point","legend","axis"],["title","label"],no.CHART,Cr.ENTER,["fade in scatter and axis"]),Zo=new so("Line chart",["line","axis"],["scatter","title","label","point"],no.CHART,Cr.ENTER,["wipe line and fade in axis"]),Qo=new so("Line chart by legend",["line","axis"],["scatter","title","legend","label","point"],no.CHART,Cr.ENTER,["wipe line and fade in axis"]),el=new so("Line chart by order",["line","axis"],["scatter","title","legend","label","point"],no.CHART,Cr.ENTER,["wipe line and fade in axis"]),tl=[Jo,qo,zo,fo,wo,oo,Ko,lo,Yo,co,Zo,vo,uo,ho,Qo,el,go,po,mo,Xo,yo,xo,bo,Do,Ro,Wo,Go,Vo,No,Oo,Mo,Uo,$o,Ho,Fo,_o,Eo,So,jo,Ao,To,Lo,ko,Co,Io,Po,Bo];be["a"].defaults({immediateRender:!1});const al=new io;function rl(e,t,a){return al.compile(e,t,a)}function il(){return al.previewerManager}function nl(e){return al.templateLib.getTemplate(e)}function sl(){al.templateLib.reset()}function ol(...e){e.forEach(e=>{const t=xr.fromJSON(e);al.templateLib.registerTemplates(t)})}function ll(e){const t=il().getDefaultWrapper(e);return t?t.templateLabels[0]:"custom"}function cl(){const e=[];return al.templateLib.getAllBuildInTemplates().forEach(t=>{e.push({templateName:t.templateName,isBuildIn:!0})}),al.templateLib.getAllCustomTemplate().forEach(t=>{e.push({templateName:t.templateName,isBuildIn:!1})}),e}function dl(e,t,a){return al.computeDuration(e,t,a)}function ul(e,t){return al.computePossibleElements(e,t)}const hl={compiler:al,buildInWrappers:Ls,buildInPreviewers:ao,buildInFilters:tl,render:rl,getPreviewerManager:il,getTemplate:nl,getTemplateInfoList:cl,resetTemplateLib:sl,registerTemplates:ol,getTemplateClass:ll,computeDuration:dl,computePossibleElements:ul};var pl=a("5c96"),gl=a.n(pl);const ml="api";function fl(e,t,a){const r=ml+"/nlp/parse";console.log("post",e),$a.a.post(r,e).then(e=>{t(e.data)}).catch(e=>{a(e)})}function wl(e,t,a){const r=ml+"/nlp/generate";console.log("post",e),$a.a.post(r,e).then(e=>{t(e.data)}).catch(e=>{a(e)})}function yl(e,t,a){const{x:r,y:i,width:n,height:s}=a.getBoundingClientRect(),o=r+n,l=i+s;return r<=e&&e<=o&&i<=t&&t<=l}function bl(e,t,a){return a.filter(a=>yl(e,t,a))}function xl(e,t,a){const r=bl(e,t,a);if(r.length>1){let e=1/0,t=null;return r.forEach(a=>{const{x:r,y:i,height:n,width:s}=a.getBoundingClientRect(),o=r+s/2,l=i+n/2,c=Math.pow(o-r,2)+Math.pow(l-i,2);e>c&&(e=c,t=a)}),t}return 1===r.length?r[0]:null}const vl={isPointInElement:yl,getHoveredElements:bl,getMostPossibleElement:xl},_l={NORMAL:"normal",RECT:"rect",LASSO:"lasso",CLICK:"click",COMP:"component"};a("907a"),a("fa9e"),a("77d9"),a("3c5d");function Tl(e,t){var r=a("b2ba"),i="7b4c3cc3778e44c0ad79d8c5afa48590",n="eastus",s=r.SpeechConfig.fromSubscription(i,n),o=new r.SpeechSynthesizer(s,null);const l={transcript:e,words:[]},c=[];var d=0;o.wordBoundary=function(e,t){let a=parseFloat((t.audioOffset/1e7).toFixed(3));l.words.push({startTime:d,endTime:a,selected:!1,speakerTag:0}),c.push(t.textOffset),d=a},o.speakTextAsync(e,(function(a){a.reason===r.ResultReason.SynthesizingAudioCompleted?console.log("synthesis finished."):console.error("Speech synthesis canceled, "+a.errorDetails+"\nDid you update the subscription info?"),o.close(),o=void 0;for(let t=0;t<c.length;t++){var i="";i=t!=c.length-1?e.slice(c[t],c[t+1]):e.slice(c[t]),l.words[t].word=i.trim()}console.log("Audio result:",l);const n=new AudioContext;t(l,n.decodeAudioData(a.audioData))}),(function(e){console.trace("err - "+e),o.close(),o=void 0,t(void 0,void 0)}))}function El(e,t){var r=a("b2ba"),i="7b4c3cc3778e44c0ad79d8c5afa48590",n="eastus",s=r.SpeechConfig.fromSubscription(i,n),o=new r.SpeechSynthesizer(s,null);const[l,c,d]=Sl(e),u={transcript:l,words:[]},h=[];var p=0;o.wordBoundary=function(e,t){let a=parseFloat((t.audioOffset/1e7).toFixed(3)),r=0;while(c[r]<=t.textOffset)r++;u.words.push({startTime:p,endTime:a,selected:!1,speakerTag:0,insightTag:d[r]}),h.push(t.textOffset),p=a},o.speakTextAsync(l,(function(e){e.reason===r.ResultReason.SynthesizingAudioCompleted?console.log("synthesis finished."):console.error("Speech synthesis canceled, "+e.errorDetails+"\nDid you update the subscription info?"),o.close(),o=void 0;for(let t=0;t<h.length;t++){var a="";a=t!=h.length-1?l.slice(h[t],h[t+1]):l.slice(h[t]),u.words[t].word=a.trim()}const i=new AudioContext;t(u,i.decodeAudioData(e.audioData))}),(function(e){console.trace("err - "+e),o.close(),o=void 0,t(void 0,void 0)}))}function Sl(e){let t="",a=[],r=[];for(const i of e){let e=i["insightWords"];t+=e,a.push(i["pos"][1]),r.push(i["subType"])}return console.log(a,r),[t,a,r]}function Al(e){if(!e)return null;const t=e.split(",")[0].split(":")[1].split(";")[0],a=atob(e.split(",")[1]),r=new ArrayBuffer(a.length),i=new Uint8Array(r);for(let n=0;n<a.length;n++)i[n]=a.charCodeAt(n);return new Blob([i],{type:t})}async function Nl(e){if(!e)return new Promise(e=>{e(new AudioBuffer({length:8e3,numberOfChannels:2,sampleRate:8e3}))});const t=await e.arrayBuffer(),a=new AudioContext;return a.decodeAudioData(t)}function Ol(e){return e.length/e.sampleRate}function Rl(e){const t=e.numberOfChannels,a=e.sampleRate,r=4*a,i=3*a,n=(new AudioContext).createBuffer(t,r,a),s=new Float32Array(i);for(let o=0;o<t;o++)e.copyFromChannel(s,o,0),n.copyToChannel(s,o,0);return n}function Ml(e){const t=e.numberOfChannels,a=e.sampleRate,r=e.length+a,i=e.length,n=(new AudioContext).createBuffer(t,r,a),s=new Float32Array(i);for(let o=0;o<t;o++)e.copyFromChannel(s,o,0),n.copyToChannel(s,o,0);return n}function Cl(e,t){if(0===e.length)return(new AudioContext).createBuffer(2,0,1);const a=e[0].numberOfChannels,r=e[0].sampleRate;let i=e.reduce((e,t)=>e+t.length,0);t&&t.forEach(e=>i+=e*r);const n=(new AudioContext).createBuffer(a,i,r);let s=0;for(let o=0;o<e.length;++o){const r=e[o],i=r.length,l=new Float32Array(i);for(let e=0;e<a;e++)r.copyFromChannel(l,e,0),n.copyToChannel(l,e,s);s+=i,s+=t?t[o]:0}return n}function Il(e){let t,a,r=e.numberOfChannels,i=e.length*r*2+44,n=new ArrayBuffer(i),s=new DataView(n),o=[],l=0,c=0;for(h(1179011410),h(i-8),h(1163280727),h(544501094),h(16),u(1),u(r),h(e.sampleRate),h(2*e.sampleRate*r),u(2*r),u(16),h(1635017060),h(i-c-4),t=0;t<e.numberOfChannels;t++)o.push(e.getChannelData(t));while(c<i){for(t=0;t<r;t++)a=Math.max(-1,Math.min(1,o[t][l])),a=0|(.5+a<0?32768*a:32767*a),s.setInt16(c,a,!0),c+=2;l++}var d=new Blob([n],{type:"audio/wav"});return d;function u(e){s.setUint16(c,e,!0),c+=2}function h(e){s.setUint32(c,e,!0),c+=4}}const Ll={dataURItoBlob:Al,blobToAudioBuffer:Nl,audioBufferToBlob:Il,concatAudio:Cl,computeAudioDuration:Ol,generateTranscript:Tl,generateTranscript2:El,extend1Sec:Ml,copy3Sec:Rl};function kl(e,t){console.log("targetUtil used");const a=(new DOMParser).parseFromString(e,"image/svg+xml").querySelector("svg"),r=Array.from(a.querySelectorAll("*:not(g,svg,defs,defs *)"));var i=[];const n=Array.from(a.querySelectorAll("g"));n.forEach(e=>{const t=Array.from(e.children);var a=[],r=1;if(t.length>1){for(var n=0;n<t.length;n++){if("g"===t[n].tagName){r=0;break}a.push(t[n].id)}r&&i.push(a)}}),r.forEach(e=>{const t=e.getAttribute("id");t&&""!==t?e.setAttribute("id",t.replaceAll(" ","-")):e.setAttribute("id","ac-"+Object(fe["a"])())}),r.forEach(e=>{e.classList.contains(t)||(e.classList.add(t),e.classList.add("unknown-type"))});const{elements:s,chartType:o,tableTitle:l}=jl(r),c={chartType:o,elements:s,groups:i,tableTitle:l},d=Bl(a);return console.log("svg model",c),{targetModel:c,svgStr:d}}function Pl(e){const t=e=>{if(e.startsWith("rgb")){const t=e.match(/\d+/g);return t.map(e=>parseInt(e))}if(e.startsWith("#")){const t=e.substring(1);if(3===t.length){const e=parseInt(t[0]+t[0],16),a=parseInt(t[1]+t[1],16),r=parseInt(t[2]+t[2],16);return[e,a,r]}if(6===t.length)return[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)]}return null},a=e=>{const t={Red:[255,0,0],Orange:[255,165,0],Yellow:[255,255,0],Green:[0,128,0],Blue:[0,0,255],Purple:[128,0,128],Gray:[128,128,128],Black:[0,0,0],White:[255,255,255]};let a=1/0,i=null;for(const[n,s]of Object.entries(t)){const t=r(e,s);t<a&&(a=t,i=n)}return i},r=(e,t)=>{const a=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(a**2+r**2+i**2)},i=t(e);if(i){const e=a(i);return e||null}return null}function Bl(e){const t=document.createElement("div");return t.appendChild(e),t.innerHTML}function jl(e){const t=[];var a=new Set,r=null,i=null,n=null;let s=null,o=null,l=null;e.forEach(e=>{const c={},d=e.getAttribute("id"),u=e.getAttribute("class"),h=e.getAttribute("fill");l=h?Pl(h):null;const p=e.getAttribute("x");if(p)s=parseFloat(p),o=parseFloat(e.getAttribute("y"));else{const t=e.getAttribute("transform");if(t){const e=t.match(/translate\(([\d.-]+),([\d.-]+)\)/);e&&(s=parseFloat(e[1]),o=parseFloat(e[2]))}}const g=u.split(" "),m=g[g.length-1],f=e.tagName;if(a.add(m.toLowerCase()),"text"===f?0!==e.children.length?c.text=Array.from(e.children).reduce((e,t)=>e+" "+t.innerHTML,"").trim():c.text=e.innerHTML:c.text=null,"x-title"===m?r=c.text:"y-title"===m?i=c.text:"main-title"!==m&&"sub-title"!==m||(n=n+c.text+" "),"unknown-type"!=m){var w=e.getAttribute("ac-data");w&&(w=JSON.parse(w)),c.type=m,c.id=d,c.clazz=u,c.data=w,c.tag=f,c.color=l,c.x=s,c.y=o,t.push(c)}});const c=Array.from(a);var d="unknown";const u=["arc","sec","donut","pie"],h=["bar"],p=["area"],g=["scatter","point","circle"],m=["line"];c.filter(e=>u.includes(e)).length>0?d="pie-chart":c.filter(e=>h.includes(e)).length>0?d="bar-chart":c.filter(e=>p.includes(e)).length>0?d="map-chart":c.filter(e=>m.includes(e)).length>0?d="line-chart":c.filter(e=>g.includes(e)).length>0&&(d="scatter-chart");const f={title:n,xtitle:r,ytitle:i};return{elements:t,chartType:d,tableTitle:f}}const Gl={updateSVGModel:kl,domElToString:Bl};var Dl=a("c074"),Ul={"vega-lite1":{xAxis:"left",yAxis:"bottom",title:"top"},"vega-lite2":{xAxis:"left",yAxis:"bottom",title:"top"},"vega-lite3":{xAxis:"left",yAxis:"bottom",title:"top"},"vega-lite4":{xAxis:"left",yAxis:"bottom",title:"top"},"vega-lite5":{xAxis:"bottom",yAxis:"left",title:"bottom"},"vega-lite6":{xAxis:"bottom",yAxis:"left",title:"bottom"},"vega-lite7":{xAxis:"bottom",yAxis:"left",title:"bottom"},"vega-lite8":{xAxis:"left",yAxis:"bottom",title:"bottom"}};const $l={"Axes fade in":1.5,"Fade-in":1.5,"Lines by legend":3,"Pie with legend":3,"Pie-wheel":3,"Bar-bounce":1,"Fade-in-then-fade-out":3,"Zoom-enter":1,"Zoom-exit":1,"Show-path":3,"Fly-in":1,"Change-color":3,"Highlight-sector":3,"Bar with legend":3,Arrow:3,Text:3,Circle:3,Contour:3,Shine:3},Hl=1;function Fl(e){for(var t=e.split("; "),a={},r=0;r<t.length;r++){var i=t[r].split(": ");a[i[0]]=i[1]}return a}function Vl(e,t){console.log("vegatargetUtil used");var a=t.split("-")[0];const r=["pie","line","bar"];r.indexOf(a)<0&&(a="bar-chart");const i=(new DOMParser).parseFromString(e,"image/svg+xml").querySelector("svg"),n=Array.from(i.querySelectorAll("*:not(g,svg,defs,defs *)")).filter(e=>"true"!=e.ariaHidden),s=Array.from(i.querySelectorAll("*")).filter(e=>null!=e.ariaRoleDescription);var o=[];n.forEach(e=>{e.classList.add("chart"),null!=e.ariaLabel&&(e.setAttribute("ac-data",JSON.stringify(Fl(e.ariaLabel))),o.push(Fl(e.ariaLabel)))}),s.forEach(e=>{const r=e.ariaLabel;switch(e.ariaRoleDescription){case"axis":var i=e.ariaLabel[0].toLowerCase();e.getElementsByClassName("role-axis-tick").length>0&&Array.from(e.getElementsByClassName("role-axis-tick")).forEach(e=>{Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)")).forEach(e=>{e.classList.add(t),e.classList.add("axis"),e.classList.add(i+"-axis"),e.classList.add(i+"-tick")})}),e.getElementsByClassName("role-axis-label").length>0&&Array.from(e.getElementsByClassName("role-axis-label")).forEach(e=>{Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)")).forEach(e=>{r.includes("discrete")&&e.setAttribute("ac-data",JSON.stringify({TEXT:e.innerHTML})),e.classList.add(t),e.classList.add("axis"),e.classList.add(i+"-axis"),e.classList.add(i+"-label")})}),e.getElementsByClassName("role-axis-domain").length>0&&Array.from(e.getElementsByClassName("role-axis-domain")).forEach(e=>{Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)")).forEach(e=>{e.classList.add(t),e.classList.add("axis"),e.classList.add(i+"-axis"),e.classList.add(i+"-domain")})}),e.getElementsByClassName("role-axis-title").length>0&&Array.from(e.getElementsByClassName("role-axis-title")).forEach(e=>{Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)")).forEach(e=>{e.classList.add(t),e.classList.add("axis"),e.classList.add(i+"-title")})});break;case"rect mark container":var n=Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)"));n.length>0&&n.forEach(e=>{e.classList.add(t),e.classList.add("mark"),e.classList.add("bar")});break;case"line mark container":var s=Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)"));s.length>0&&s.forEach(e=>{e.classList.add(t),e.classList.add("mark"),e.classList.add("line")});break;case"arc mark container":var o=Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)"));o.length>0&&o.forEach(e=>{e.classList.add(t),e.classList.add("mark"),e.classList.add("sector")});break;case"text mark container":var l=Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)"));l.length>0&&l.forEach(e=>{e.classList.add(t),e.classList.add("label"),e.classList.add("pie"===a?"sector-label":"annotation")});break;case"annotation container":var c=Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)"));c.length>0&&c.forEach(e=>{e.classList.add(t),e.classList.add("annotation")});break;case"point":e.classList.add(t),e.classList.add("mark"),e.classList.add("point");break;case"legend":if(e.getElementsByClassName("role-legend-label").length>0&&e.getElementsByClassName("role-legend-symbol").length>0){var d=Array.from(e.getElementsByClassName("role-legend-label")),u=Array.from(e.getElementsByClassName("role-legend-symbol"));d.forEach((e,a)=>{var r=e.textContent.trim(),i=u[a];Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)")).forEach(e=>{e.setAttribute("ac-data",JSON.stringify({TEXT:r})),e.classList.add(t),e.classList.add("legend"),e.classList.add("legend-label")}),Array.from(i.querySelectorAll("*:not(g,svg,defs,defs *)")).forEach(e=>{e.setAttribute("ac-data",JSON.stringify({TEXT:r})),e.classList.add(t),e.classList.add("legend"),e.classList.add("legend-symbol")})})}break;case"title":Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)")).forEach(e=>{e.classList.add(t),e.classList.add("title"),e.classList.add("sub-title")});break}}),Array.from(i.getElementsByClassName("role-axis-grid")).forEach(e=>{Array.from(e.querySelectorAll("*:not(g,svg,defs,defs *)")).forEach(e=>{e.classList.add(t),e.classList.add("axis"),e.classList.add("grid")})});const l=new Map;n.forEach(e=>{let t=e.classList[e.classList.length-1];var a;t&&l.set(t,(null!==(a=l.get(t))&&void 0!==a?a:0)+1)}),l.forEach((e,t)=>{e>=1&&n.filter(e=>e.classList[e.classList.length-1]===t).forEach((e,a)=>e.setAttribute("id",`${t}-${a}`))}),n.forEach(e=>{const t=e.getAttribute("id");t&&""!==t||e.setAttribute("id",e.classList[e.classList.length-1]+"-ac-"+Object(fe["a"])())}),n.forEach(e=>{e.classList.contains(t)||(e.classList.add(t),"rect"===e.tagName?(e.classList.add("background"),e.classList.add("bg-rect")):e.classList.add("unknown-type"))});const c=Xl(n,o),d=void 0===Ul[t]?{xAxis:"bottom",yAxis:"left",title:"top"}:Ul[t],u={chartType:a,elements:c,layout:d,target_type:"vega"},h=zl(i);return{targetModel:u,svgStr:h}}function Wl(e){return e.map(e=>"."+e).join(",")}function Jl(e,t,a,r,i,n,s){return{target:Wl(e),use:t,timing:{start:s?a:r,duration:$l[t],offset:i},ani_type:"Enter",settings:n}}function ql(e,t,a,r,i){let n=[],s="title",o=!1;console.log(e,t);let l=0,c=0,d=0,u="";console.log("hasNarration: ",i);const h={title:{aniType:"Axes fade in",target:["title"]},x:{aniType:"Fade-in",target:["x-domain","x-tick","x-label","x-axis"]},y:{aniType:"Fade-in",target:["y-domain","y-tick","y-label","y-axis","y-title"]},legendLine:{aniType:"Lines by legend",target:["line","axis","legend","point"]},legendBar:{aniType:"Bar with legend",target:["mark","legend"]},arc:{aniType:r.includes("emission")?"Pie-wheel":"Pie with legend",target:r.includes("emission")?["sector","sector-label"]:["sector","legend","sector-label"]}};return e.words.forEach((a,p)=>{a.insightTag!==s||o||(l=a.startTime,o=!0);const g=e.words.length;if(a.insightTag===s&&(p!=g-1&&e.words[p+1].insightTag!==s||p==g-1)){if(s=s.toLowerCase(),console.log("in ",s,p),o=!1,c=a.endTime,["title","x","y","legend","arc"].includes(s)){let e=s;"legend"===s&&(e="line"===t?"legendLine":"legendBar"),u=h[e].aniType,n.push(Jl(h[e].target,u,l,d,0,{},i)),d+=$l[u]+Hl}else if(["maximum","minimum","majority","minority","outlier","difference","negative","positive","value"].includes(s)||s.includes("rank")||s.includes("minority")||s.includes("value"))if("bar"===t)if(r.includes("nuclear")){const e={89:["#0A3B7E","38582",180,70,14],102:["#d00000","31139",60,190,14]};89!==p&&102!==p||(u="Text",n.push(Jl([s],u,l,d,i?.3*(c-l):0,{fill:e[p][0],textContent:e[p][1],x:e[p][2],y:e[p][3],fontSize:e[p][4]},i)),d+=$l[u]+Hl)}else r.includes("plan")&&["majority","minority"].includes(s)||r.includes("crime")&&s.includes("value")||r.includes("media")&&"difference"===s||r.includes("food")&&"maximum"===s||r.includes("food")&&"minimum"===s?(u="Contour",n.push(Jl([s],u,l,d,i?.3*(c-l):0,{customTransform:"none"},i)),d+=$l[u]+Hl):r.includes("food")&&"outlier"===s?(u="Text",n.push(Jl([],u,l,d,0,{fill:"#f00",textContent:"56",x:100,y:130,fontSize:16},i),Jl([s],"Shine",l,d,i?.3*(c-l):0,{},i)),d+=$l[u]+Hl):r.includes("crime")&&"minority"===s?(u="Arrow",n.push(Jl([],u,l,d,0,{color:"#f00",reverseDirection:!0,scale:1.5,x:305,y:210},i),Jl([],u,l,d,0,{color:"#f00",reverseDirection:!0,scale:1.5,x:343,y:215},i),Jl([s],"Shine",l,d,0,{},i)),d+=$l[u]+Hl):(u="Bar-bounce",n.push(Jl([s],u,l,d,i?.3*(c-l):0,{},i)),d+=$l[u]+Hl);else if("line"===t)if(r.includes("death")){const e={68:[!0,1.5,100,115,67650],77:[!1,1.5,326,57,103400]};68===p||77===p?(u="Arrow",n.push(Jl([],u,l,d,0,{color:"#f00",reverseDirection:e[p][0],scale:e[p][1],x:e[p][2],y:e[p][3]},i),Jl([],"Text",l,d,0,{fill:"#f00",textContent:e[p][4],x:e[p][2],y:e[p][3]-(68===p?35:-50),fontSize:14},i)),d+=$l[u]+Hl):(u="Change-color",n.push(Jl([s],u,l,d,0,{},i),Jl([],"Text",l,d,0,{fill:"#f00",textContent:"67650",x:100,y:100,fontSize:14},i),Jl([],"Text",l,d,0,{fill:"#f00",textContent:"63250",x:525,y:110,fontSize:14},i)),d+=$l[u]+Hl)}else if(r.includes("airport"))u="Circle",n.push(Jl([s],u,l,d,0,{stroke:"#f00"},i)),d+=$l[u]+Hl;else if(r.includes("qatar")){const e={difference:[678,169,146,.915,1.218],value:[747,194,75,.605,2.196]};console.log(e[s],"qatar"),u="Circle",n.push(Jl([s],u,l,d,0,{stroke:"#f00"},i),Jl([s],u,l,d,0,{stroke:"#f00"},i),Jl([],"Text",l,d,0,{x:e[s][0]-20,y:e[s][1]+40,fill:"#f00",textContent:e[s][3],fontSize:16},i),Jl([],"Text",l,d,0,{x:e[s][0]-20,y:e[s][2]-20,fill:"#f00",textContent:e[s][4],fontSize:16},i)),d+=$l[u]+Hl}else r.includes("earnings")&&"value"===s?(u="Circle",n.push(Jl([s],u,l,d,0,{stroke:"#f00"},i)),d+=$l[u]+Hl):(n.push(Jl([s],"Fade-in-then-fade-out",l,d,0,{},i),Jl([s+"-annotation"],"Zoom-enter",l,d,0,{},i),Jl([s+"-annotation"],"Zoom-exit",c-1,d+=$l["Fade-in-then-fade-out"]+2,0,{},i)),d+=$l["Zoom-exit"]+2);else"pie"===t&&(r.includes("emission")?(u="Change-color",n.push(Jl([s],u,l,d,0,{fill:"#f00",yoyo:!0,stagger:.03},i)),d+=$l[u]+Hl):r.includes("mine-production")?s.includes("value")?(u="Zoom-enter",n.push(Jl([s],u,l,d,0,{},i)),d+=$l[u]+Hl):(u="Contour",n.push(Jl([s],u,l,d,0,{customTransform:"maximum"===s?"matrix(0.86603,-0.5,0.5,0.86603,10.0004,100.00023)":"matrix(0.86603,-0.5,0.5,0.86603,10.00038,100.00036)"},i)),d+=$l[u]+Hl):r.includes("poverty")?"majority"===s||"minority"===s?(u="Contour",n.push(Jl([s],u,l,d,0,{},i)),d+=$l[u]+Hl):(u="Change-color",n.push(Jl([s],u,l,d,0,{fill:"#f00",yoyo:!0,stagger:.03},i)),d+=$l[u]+Hl):(u="Contour",n.push(Jl([s],u,l,d,0,{},i)),d+=$l[u]+Hl));else["normal","distribution"].includes(s)?"pie"===t?u="Show-path":"bar"===t&&(u="Zoom-enter",n.push(Jl([s+"-annotation"],"Zoom-enter",l,d,0,{},i),Jl([s+"-annotation"],"Zoom-exit",i?c-3:0,d+=$l[u]+Hl,0,{},i)),d+=$l[u]+Hl):["increase","fluctuate","decrease","fluctuate_increase","fluctuate_decrease"].includes(s)&&("line"===t?(u="Change-color",n.push(Jl([s],u,l,d,0,{fill:"#f00",yoyo:!0,stagger:.03},i),Jl([s+"-annotation"],"Fly-in",l,d,0,{direction:r.includes("earnings")&&"increase"===s?Gr.LEFT:Gr.RIGHT},i)),d+=$l[u]+Hl):(u="Fly-in",n.push(Jl([s+"-annotation"],u,l,d,0,{direction:"bar"===t&&"increase"===s?Gr.LEFT:Gr.RIGHT},i)),d+=$l[u]+Hl));["average","sum","count"].includes(s)&&"pie"===t&&(u="Highlight",n.push(Jl([s],u,l,d,0,{},i),Jl([s],"Fade-in-then-fade-out",l,d,0,{},i)),d+=$l[u]+Hl),p!==g-1&&(s=e.words[p+1].insightTag)}}),console.log(n),{sequence:{sync:n}}}function zl(e){const t=document.createElement("div");return t.appendChild(e),t.innerHTML}function Kl(e){let t=e.getAttribute("ac-data");return t?JSON.parse(t):null}function Yl(e){const t=e=>{if(e.startsWith("rgb")){const t=e.match(/\d+/g);return t.map(e=>parseInt(e))}if(e.startsWith("#")){const t=e.substring(1);if(3===t.length){const e=parseInt(t[0]+t[0],16),a=parseInt(t[1]+t[1],16),r=parseInt(t[2]+t[2],16);return[e,a,r]}if(6===t.length)return[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)]}return null},a=e=>{const t={Red:[255,0,0],Orange:[255,165,0],Yellow:[255,255,0],Green:[0,128,0],Blue:[0,0,255],Purple:[128,0,128],Gray:[128,128,128],Black:[0,0,0],White:[255,255,255]};let a=1/0,i=null;for(const[n,s]of Object.entries(t)){const t=r(e,s);t<a&&(a=t,i=n)}return i},r=(e,t)=>{const a=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(a**2+r**2+i**2)},i=t(e);if(i){const e=a(i);return e||null}return null}function Xl(e,t){const a=[];return e.forEach(e=>{let r=null,i=null,n=null;const s={},o=e.getAttribute("id"),l=e.getAttribute("class"),c=e.getAttribute("fill");n=c?Yl(c):null;const d=e.getAttribute("x");if(d)r=parseFloat(d),i=parseFloat(e.getAttribute("y"));else{const t=e.getAttribute("transform");if(t){const e=t.match(/translate\(([\d.-]+),([\d.-]+)\)/);e&&(r=parseFloat(e[1]),i=parseFloat(e[2]))}}const u=l.split(" "),h=e.tagName,p=Kl(e);s.type=u[u.length-1],s.id=o,s.clazz=l,s.data=p,s.tag=h,s.color=n,s.x=r,s.y=i,"text"===h?0!==e.children.length?s.text=Array.from(e.children).reduce((e,t)=>e+" "+t.innerHTML,"").trim():s.text=e.innerHTML:s.text=null,null!=s.data&&"TEXT"in s.data&&(s.data=t.filter(e=>JSON.stringify(e).toLowerCase().includes(s.data["TEXT"].toLowerCase()))),a.push(s)}),a}const Zl={updateSVGModel:Vl,domElToString:zl,generateAnimationJSON:ql};function Ql(e,t){const a=(e,t)=>Array.from({length:t-e},(t,a)=>a+e),r=a(e,t+1);return"["+r.join(",")+"]"}function ec(e){const t=[];return Object.keys(e).forEach(a=>{const r=JSON.parse(a),i=e[a];t.push({startIdx:r[0],endIdx:r[r.length-1],indices:a,target:i,icon:Dl["c"],id:Object(fe["a"])()})}),t}function tc(e){const t=new Object;return e.forEach(e=>{t[e.indices]=e.target}),t}function ac(e){const t=e.buildInWrappers,a=new Object;return t.forEach(e=>{const t=e.getTemplateName(),r=e.animationType;a[t]=r}),a}const rc=()=>({aniChart:hl,windowWidth:0,windowHeight:0,headerHeight:0,footerHeight:0,scene:null,enableDrag:!1,sceneEl:null,svgEl:null,aniSceneEl:null,aniSvgEl:null,selectionSvgEl:null,resourceJSON:[],templateJSON:[],animationJSON:{sequence:{sync:[]}},previewAniJSON:{sequence:{sync:[]}},resourceJSONRenderSign:0,templateJSONRenderSign:0,animationJSONRenderSign:0,isSpecTextValid:!0,specTextErrorMsg:"",timeline:null,timelinePanelEl:null,textPanelEl:null,targetPanelEl:null,textPanelEmpty:!1,controllerInitSign:0,svgRenderSign:0,aniSvgRenderSign:0,mainContainerEl:null,toolboxEl:null,submitToolboxEl:null,staticToolboxEl:null,time:0,timelineRows:[[],[],[]],timelineScale:Ma["h"]().domain([0,20]),oldTimelineScale:Ma["h"]().domain([0,20]),timelineWidth:1e3,tlContainerWidth:0,tlContainerWidthBuffer:0,timelineRenderSign:0,durationMap:new Map,targetPanelWidth:0,leftPanelWidth:0,wordTargetIconPos:[],transcriptSrc:{transcript:"",words:[]},groupedTargetsMap:new Map,useAudio:!0,showPotential:!0,audioSrc:"",audioEl:null,audioReady:!1,nlpLinking:!1,nlpLoading:!1,selectionTool:_l.NORMAL,selectionConfirm:null,stopConfirm:!1,selectionLeave:null,stopLeave:!1,hideToolbox:!1,animationStyle:{Enter:{color:"#78c679",icon:Dl["e"]},Emphasis:{color:"#238b45",icon:Dl["g"]},Exit:{color:"#99d8c9",icon:Dl["f"]},Annotate:{color:"#f56c6c",icon:Dl["g"]},Other:{color:"#9e4ccd",icon:Dl["a"]}},templateStyle:{Chart:{color:Ma["c"](Ma["j"][6]),icon:Dl["b"]},Mark:{color:Ma["c"](Ma["j"][4]),icon:Dl["d"]},Annotation:{color:Ma["c"](Ma["j"][3]),icon:Dl["h"]}},useToAniMap:ac(hl),animationName:"",animationType:"",itemForSettings:null,aniSettings:{},textPanelText:"",audioCompiling:!1,refresh:!0,scrollLeft:0,aniStatus:"stop",compileSuccess:!1,currentMode:"normal",enableFilter:!0,settingPanelVisible:!1,clearTextHighlightSign:!1,itemUpdateTuple:null,highlightItem:null,clickIconSignal:null,exportSvgEl:null,exportSceneEl:null,exportSign:0,audioBuffer:null,isExportingFiles:!1,hasNarration:!0}),ic={svgPanelInSelecting:e=>e.selectionTool!==_l.NORMAL,aniPlaying:e=>"play"===e.aniStatus},nc={queryNLPParseResult({state:e,commit:t}){t("changeNLPLinking",!0);const a=we(e.transcriptSrc);a.words.forEach(e=>delete e.selected);var r={};this.state.target.groupedTargetsMap.forEach((e,t)=>{r[t]=Array.from(e)});const i={target_model:e.scene.targetModel,transcript:a,dataGroup:r};fl(i,e=>{t("changeNLPLinking",!1),t("computeWordIdxTargets",e.indices_dict)},e=>{t("changeNLPLinking",!1),Object(pl["Notification"])({title:"NLP Parse failed",message:e.message,type:"warning"}),console.log(e)})},queryNLPGenerateResult({state:e,commit:t}){t("changeNLPLoading",!0);const a=we(e.transcriptSrc);a.words.forEach(e=>delete e.selected);var r={};this.state.target.groupedTargetsMap.forEach((e,t)=>{r[t]=Array.from(e)});const i=tc(e.wordTargetIconPos),n={target_model:e.scene.targetModel,transcript:a,dataGroup:r,indices_dict:i};console.log("nlp payload",n),wl(n,a=>{console.log("nlp resp",a);const r=a.AnimationJSON;t("changeNLPLoading",!1),e.wordTargetIconPos=[],t("updateEditorUsingAnimationJSON",null!==r&&void 0!==r?r:{}),t("changeAnimationJSONRenderSign"),Object(pl["Notification"])({title:"Generate finished",type:"success"})},e=>{t("changeNLPLoading",!1),Object(pl["Notification"])({title:"Generate failed",message:e.message,type:"warning"}),console.log(e)})}},sc={changeAniStatus(e,t){e.aniStatus=t},changeWindowSize(e){e.windowWidth=document.body.clientWidth,e.windowHeight=document.body.clientHeight},changeLeftPanelWidth(e,t){e.leftPanelWidth=t},changeHeaderHeight(e,t){e.headerHeight=t},changeFooterHeight(e,t){e.footerHeight=t},changeScene(e,t){e.scene=t},changeSceneById(e,t){e.scene=this.state.project.scenes[t]},changetextPanelText(e,t){e.textPanelText=t,""===t&&(e.textPanelEmpty=!0)},changeRefresh(e){e.refresh=!e.refresh},mountSceneElement(e,t){e.sceneEl=t},mountAniSceneElement(e,t){e.aniSceneEl=t},mountSvgElement(e,t){e.svgEl=t},mountSelectionSvgElement(e,t){e.selectionSvgEl=t},mountAniSvgElement(e,t){e.aniSvgEl=t},mountAudioElement(e,t){e.audioEl=t},mountMainContainer(e,t){e.mainContainerEl=t},mountTb(e,t){e.toolboxEl=t},mountToolbox(e,t){e.submitToolboxEl=t},mountStaticToolbox(e,t){e.staticToolboxEl=t},changeTempAnimationSelection(e,{aniName:t="",aniType:a=""}){e.animationName=t,e.animationType=a},changeItemForSettings(e,t){e.itemForSettings=t,console.log("changeItemForSettings",e.itemForSettings)},updateItemType(e,{aniName:t,aniType:a}){e.itemForSettings&&(e.itemForSettings.use=t,e.itemForSettings.ani_type=a)},changeItemSettings(e,t){e.aniSettings=t},changeMode(e,t){e.currentMode=t},changeFilterSwitch(e,t){e.enableFilter=t},initToolboxPos(e){const t=e.toolboxEl,a=t.getBoundingClientRect();this.commit("editor/moveToolbox",{ele:e.submitToolboxEl,right:a.right,top:a.top+a.height+10}),this.commit("editor/moveToolbox",{ele:e.staticToolboxEl,right:a.right,top:a.top+a.height+10})},moveToolbox(e,{ele:t,left:a=null,top:r=null,right:i=null,bottom:n=null}){if(t||(t=e.submitToolboxEl),!t)return;const s=e.mainContainerEl,o=s.getBoundingClientRect();t.style.left=a?a-o.left+"px":"",t.style.right=i?o.right-i+"px":"",t.style.top=r?r-o.top+"px":"",t.style.bottom=n?o.bottom-n+"px":""},initLinking(e){var t;null!==(t=e.scene)&&void 0!==t&&t.linking&&this.commit("editor/computeWordIdxTargets",we(e.scene.linking))},initWorkspace(e,t=!1){var a,r,i,n,s;e.controllerInitSign^=1,e.selectionTool=_l.NORMAL,e.wordTargetIconPos=[],e.indice_dict=new Map,e.timeline&&(e.timeline.kill(),e.timeline.clear(),e.timeline=null);try{var o,l,c,d;const a=we(null===(o=e.scene)||void 0===o?void 0:o.spec);this.commit("editor/updateEditorUsingResourcesJSON",null!==(l=null===a||void 0===a?void 0:a.charts)&&void 0!==l?l:[]),this.commit("editor/updateEditorUsingTemplateJSON",null!==(c=null===a||void 0===a?void 0:a.templates)&&void 0!==c?c:[]);const r={sequence:{sync:[]}};t?this.commit("editor/updateEditorUsingAnimationJSON",null!==(d=null===a||void 0===a?void 0:a.animation)&&void 0!==d?d:r):this.commit("editor/updateEditorUsingAnimationJSON",r),setTimeout(()=>{e.resourceJSONRenderSign^=1,e.templateJSONRenderSign^=1,e.animationJSONRenderSign^=1},0)}catch(p){console.error(p)}this.commit("editor/changeSvgRenderSign"),null!==(a=this.scene)&&void 0!==a&&a.targetModel&&this.commit("target/initTargetModel",we(e.scene.targetModel));const u=we(null===(r=e.scene)||void 0===r?void 0:r.transcript),h={transcript:"",words:[]};if(null===u||void 0===u||null===(i=u.results)||void 0===i||i.forEach(e=>{e.alternatives.forEach(e=>{h.transcript+=e.transcript,h.words.push(...e.words),e.words.forEach(e=>{e.startTime=parseFloat(e.startTime.replace("s","")),e.endTime=parseFloat(e.endTime.replace("s","")),e.selected=!1})})}),e.transcriptSrc=h,this.commit("editor/changetextPanelText",h.transcript),null!==(n=e.scene)&&void 0!==n&&n.targetModel&&this.commit("target/initTargetModel",we(e.scene.targetModel)),console.log("this.scene",e.scene),null!==(s=e.scene)&&void 0!==s&&s.audioStr){const t=e.scene.audioStr,a=Ll.dataURItoBlob(t);Ll.blobToAudioBuffer(a).then(e=>{const t=Ll.extend1Sec(e),a=Ll.audioBufferToBlob(t),r=window.URL.createObjectURL(a);this.commit("editor/setAudioSrc",r),this.commit("editor/setAudioBuffer",t)})}},updateAudio(e,t){e.audioCompiling=!0;let a=this;"string"!==typeof t&&(e.audioCompiling=!1),Ll.generateTranscript(t,(function(t,r){e.transcriptSrc=t,void 0!=r&&r.then(e=>{const t=Ll.extend1Sec(e),r=Ll.audioBufferToBlob(t),i=window.URL.createObjectURL(r);a.commit("editor/setAudioSrc",i),a.commit("editor/setAudioBuffer",t)}).catch(()=>{e.audioReady=!1,e.audioCompiling=!1})}))},generateAudio(e,{transcript:t,hasNarration:a}){e.audioCompiling=!0;let r=this;e.hasNarration=a,"string"!==typeof t&&(e.audioCompiling=!1),Ll.generateTranscript2(t,(function(t,i){e.transcriptSrc=t,void 0!=i&&i.then(i=>{console.log("audio promise");const n=Ll.extend1Sec(i),s=Ll.audioBufferToBlob(n),o=window.URL.createObjectURL(s);r.commit("editor/setAudioSrc",o),r.commit("editor/setAudioBuffer",n),r.commit("editor/updateEditorUsingAnimationJSON",Zl.generateAnimationJSON(t,e.scene.targetModel.chartType,e.scene.insightDict,e.scene.chartId,a))}).catch(()=>{e.audioReady=!1,e.audioCompiling=!1})}))},resetEditor(e){try{this.commit("editor/updateEditorUsingResourcesJSON",[]),this.commit("editor/updateEditorUsingTemplateJSON",[]),this.commit("editor/updateEditorUsingAnimationJSON",{sequence:{sync:[]}}),e.wordTargetIconPos=[],setTimeout(()=>{e.resourceJSONRenderSign^=1,e.templateJSONRenderSign^=1,e.animationJSONRenderSign^=1},0)}catch(t){console.error(t)}},updateChartSize(e){const t=e.svgEl,a=e.selectionSvgEl,r=e.aniSvgEl;if(!t||!a||!r)return;const i=t.querySelector("svg");if(!i)return;const n=i.getAttribute("width"),s=i.getAttribute("height"),o=Math.max(0,e.windowWidth-e.leftPanelWidth-e.targetPanelWidth),l=Math.max(0,e.windowHeight-e.headerHeight-e.footerHeight),c=o/n*.84,d=l/s*.84,u=Math.min(c,d);t.setAttribute("width",n*u),t.setAttribute("height",s*u),t.setAttribute("viewBox",`0 0 ${n} ${s}`),a.setAttribute("width",n*u),a.setAttribute("height",s*u),a.setAttribute("viewBox",`0 0 ${n} ${s}`),r.setAttribute("width",n*u),r.setAttribute("height",s*u),r.setAttribute("viewBox",`0 0 ${n} ${s}`)},updateEditorUsingResourcesJSON(e,t){e.resourceJSON=t},updateEditorUsingTemplateJSON(e,t){null!==t&&(e.templateJSON=t,hl.resetTemplateLib(),hl.registerTemplates(...t),this.commit("editor/updateEditorUsingAnimationJSON",e.animationJSON),e.animationJSONRenderSign^=1)},updateEditorUsingAnimationJSON(e,t){if(null!==t)try{dr.fromJSON(t),e.animationJSON=t,this.commit("editor/changeSpecTextValidState",{isValid:!0,errorMsg:""}),this.commit("editor/computeTimelineRows",t),setTimeout(()=>{this.commit("editor/updateVisTimeline")},0)}catch(a){console.error("Spec update failed"),console.error(a),this.commit("editor/changeSpecTextValidState",{isValid:!0,errorMsg:a.message}),Object(pl["Notification"])({title:"Update timeline failed",message:a.message,type:"warning"})}},changeSpecTextValidState(e,{isValid:t,errorMsg:a}){e.isSpecTextValid=t,e.specTextErrorMsg=a},mountTimelinePanel(e,t){e.timelinePanelEl=t},mountTextPanel(e,t){e.textPanelEl=t},mountTargetPanel(e,t){e.targetPanelEl=t},compile(e,{onUpdateFunc:t,notification:a=!0}){e.compileSuccess=!1,this.commit("editor/updateElementClasses"),e.timeline&&(e.timeline.kill(),e.timeline.clear(),e.timeline=null);try{console.log("compiling animation json",e.aniSvgEl,e.animationJSON),e.timeline=hl.render(e.aniSceneEl,e.animationJSON,{onUpdate:t});const r=e.timelineScale.invert(e.timelineWidth);e.timeline.add(be["a"].to("empty-selector",{duration:0}),"<"+r),a&&Object(pl["Notification"])({title:"Compile finished",message:"Play the animation!",type:"success"}),e.compileSuccess=!0}catch(r){console.error(r),Object(pl["Notification"])({title:"Compile failed",message:r.message,type:"warning"}),e.compileSuccess=!1}},computeTimelineRows(e,t){var a,r,i,n;const s=t.variable,o=null!==(a=null!==(r=null===(i=t.sequence)||void 0===i?void 0:i.sync)&&void 0!==r?r:null===(n=t.sequence)||void 0===n?void 0:n.concat)&&void 0!==a?a:[],l=e.durationMap=new Map;o.forEach(t=>l.set(t,hl.computeDuration(e.sceneEl,t,s)));const c=e=>{var t,a,r,i;return(null!==(t=null===(a=e.timing)||void 0===a?void 0:a.start)&&void 0!==t?t:0)+(null!==(r=null===(i=e.timing)||void 0===i?void 0:i.offset)&&void 0!==r?r:0)},d=e=>c(e)+l.get(e);o.sort((e,t)=>d(e)-d(t));const u=o.map(()=>-1),h=o.map(()=>[]);for(let p=o.length-1;p>=1;--p)for(let e=p-1;e>=0;--e)c(o[p])<d(o[e])&&h[p].push(e);for(let p=0;p<o.length;++p){const t=o[p];for(let a=0;a<o.length;a++){while(e.timelineRows.length<=a)e.timelineRows.push([]);const r=e.timelineRows[a],i=h[p].some(e=>u[e]===a);if(!i){r.push(t),u[p]=a;break}}}e.timelineRows=[[]],o.forEach((t,a)=>{const r=u[a];while(r>=e.timelineRows.length)e.timelineRows.push([]);e.timelineRows[r].push(t)})},computeWordIdxTargets(e,t){e.wordTargetIconPos=ec(t)},changeSvgRenderSign(e){e.svgRenderSign^=1,e.aniSvgRenderSign^=1},changeAniSvgRenderSign(e){e.aniSvgRenderSign^=1},changeExportSign(e){e.exportSign^=1},setIsExportingFiles(e,t){e.isExportingFiles=t},changeTargetPanelWidth(e,t){e.targetPanelWidth=t,e.tlContainerWidth=e.tlContainerWidthBuffer-t},addWordTarget(e,{start:t,end:a,target:r}){let i=!1;for(let n=0;n<e.wordTargetIconPos.length;++n){const s=e.wordTargetIconPos[n];if(s.startIdx===t&&s.endIdx===a){s.target.push(...r),s.target=[...new Set(s.target)],i=!0,Object(pl["Notification"])({title:"Merged duplicate link",type:"info"});break}}i||e.wordTargetIconPos.push({startIdx:t,endIdx:a,target:r,icon:Dl["c"],id:Object(fe["a"])(),indices:Ql(t,a)})},editWordTarget(e,t){for(let a=0;a<e.wordTargetIconPos.length;++a)if(e.wordTargetIconPos[a].id===t.id){e.wordTargetIconPos[a].target=t.target;break}},deleteWordTarget(e,t){for(let a=0;a<e.wordTargetIconPos.length;++a)if(e.wordTargetIconPos[a].id===t.id){e.wordTargetIconPos.splice(a,1);break}},changeTlContainerWidth(e,t){const a=e.windowWidth-e.leftPanelWidth-e.targetPanelWidth-t;e.tlContainerWidthBuffer=a,e.tlContainerWidth=a,e.timelineScale.range([0,a]),e.timelineWidth=a,this.commit("editor/updateVisTimeline")},changeTimelineWidth(e,t){const a=t/e.timelineWidth,r=e.timelineScale.domain(),i=e.timelineScale.range();e.timelineScale.domain([0,r[1]*a]).range([0,i[1]*a]),e.timelineWidth=t,this.commit("editor/updateVisTimeline")},updateTimelineScale(e,t){e.timelineWidth/t<e.tlContainerWidth&&(t=e.timelineWidth/e.tlContainerWidth);const a=e.timelineScale.domain(),r=e.timelineScale.range();e.timelineScale.domain([0,a[1]]).range([0,r[1]/t]),e.timelineWidth=e.timelineWidth/t,this.commit("editor/updateVisTimeline"),e.oldTimelineScale.domain([0,a[1]]).range([0,r[1]])},updateTimelineScaleByAudio(e,t){e.timelineScale.domain([0,t/1e3]),this.commit("editor/updateVisTimeline")},updateTimelineSvg(e){const t=Ma["k"]("#timeline-marks-svg");t.selectAll("*").remove();const a=t.append("g"),r=10,i=r*e.timelineWidth/e.tlContainerWidth,n=Ma["b"](e.timelineScale).ticks(i),s=a.attr("transform","translate(0,27)").call(n);s.select(".tick:first-of-type text").remove(),s.selectAll(".tick").attr("color","#adadad"),s.selectAll(".tick line").attr("stroke-width","1.5px").attr("y2","-14"),s.selectAll(".tick text").attr("font-size",14).attr("y","-16")},updateItemTiming(e,{item:t,start:a,duration:r}){if(void 0===t.timing)t.timing={start:a,duration:r};else{var i;if(null!=a)t.timing.offset=a-(null!==(i=t.timing.start)&&void 0!==i?i:0);null!=r&&(t.timing.duration=r,e.durationMap.set(t,r))}t.timing=cr["a"].simplifyJSON(t.timing);for(const n in t.timing)t.timing[n]=Math.round(1e3*t.timing[n])/1e3},appendTimelineItem(e,{rowIdx:t,templateName:a,startX:r}){const i=e.timelineRows[t];let n=e.timelineScale.invert(r);n=Math.round(100*n)/100;const s={use:a,timing:{start:n}};i.push(s);const o=hl.computeDuration(e.sceneEl,s,e.animationJSON.variable);e.durationMap.set(s,o),this.commit("editor/updateVisTimeline"),this.commit("editor/updateAniJSONUsingTimelineRows")},appendItemByTextView(e,{minWordIdx:t,maxWordIdx:a,target:r,toFitDuration:i,settings:n}){var s;const o=e.transcriptSrc.words[t].startTime,l=e.transcriptSrc.words[a].endTime,c={use:e.animationName,timing:{start:o,duration:1,offset:0},target:r,ani_type:e.animationType,settings:n};if(i){let e=l-o;c.timing.duration=Math.round(100*e)/100}e.durationMap.set(c,hl.computeDuration(e.sceneEl,c,e.animationJSON.variable)),null!==(s=e.animationJSON)&&void 0!==s&&null!==(s=s.sequence)&&void 0!==s&&s.sync&&(e.animationJSON.sequence.sync.push(c),e.animationJSON={...e.animationJSON},this.commit("editor/computeTimelineRows",e.animationJSON)),this.commit("editor/updateVisTimeline")},updateItemByTextView(e,{item:t,target:a}){t.target=a,e.durationMap.set(t,hl.computeDuration(e.sceneEl,t,e.animationJSON.variable)),this.commit("editor/updateVisTimeline")},previewAnimation(e,{templateName:t,target:a}){const r=a?{use:t,timing:{start:0,duration:1.5},target:a}:{use:t,timing:{start:0}};e.previewAniJSON={sequence:{sync:[r]}},this.commit("editor/changeAniSvgRenderSign")},playPreview(e){this.commit("editor/updateElementClasses"),e.timeline&&(e.timeline.kill(),e.timeline.clear(),e.timeline=null);try{e.timeline=hl.render(e.aniSceneEl,e.previewAniJSON),e.aniStatus="preview",e.timeline.play()}catch(t){console.error(t),e.aniStatus="stop"}},exitPreviewAnimation(e){e.aniStatus="stop"},deleteItemByIcon(e,t){for(const a of e.timelineRows){const e=a.indexOf(t.originItem);if(-1!==e){a.splice(e,1);break}}this.commit("editor/updateAniJSONUsingTimelineRows"),this.commit("editor/updateVisTimeline")},updateItemTimingByIcon(e,t){const a=e.timelineRows.flat().find(e=>e.use==t.use&&e.target==t.target),r=t.timing.start,i=t.timing.duration;this.commit("editor/updateItemTiming",{item:a,start:r,duration:i}),this.commit("editor/updateAniJSONUsingTimelineRows"),this.commit("editor/updateVisTimeline")},deleteItem(e,t){for(let a=0;a<e.timelineRows.length;a++){const r=e.timelineRows[a],i=r.indexOf(t);if(i>=0){r.splice(i,1);break}}e.durationMap.delete(t),this.commit("editor/changeHighlightItem",null),this.commit("editor/changeClearTextHighlightSign"),this.commit("editor/updateVisTimeline"),this.commit("editor/updateAniJSONUsingTimelineRows")},changeSettingPanelVisible(e,t){e.settingPanelVisible=t},changeClearTextHighlightSign(e){e.clearTextHighlightSign^=!0},changeHighlightItem(e,t){e.highlightItem=t},changeClickIconSignal(e,t){e.clickIconSignal=t},updateVisTimeline(e){const t=Math.max(...e.timelineRows.flat().map(t=>{var a,r,i,n;return(null!==(a=null===(r=t.timing)||void 0===r?void 0:r.start)&&void 0!==a?a:0)+(null!==(i=null===(n=t.timing)||void 0===n?void 0:n.offset)&&void 0!==i?i:0)+e.durationMap.get(t)}));while(t>=e.timelineScale.invert(e.timelineWidth))this.commit("editor/changeTimelineWidth",1.5*e.timelineWidth);setTimeout(()=>{e.timelineRenderSign^=1},0),this.commit("editor/updateTimelineSvg")},updateAniJSONUsingTimelineRows(e){var t;null!==(t=e.animationJSON)&&void 0!==t&&t.sequence&&(e.animationJSON.sequence.sync=e.timelineRows.flat().sort((e,t)=>{var a,r,i,n;return(null!==(a=null===(r=e.timing)||void 0===r?void 0:r.start)&&void 0!==a?a:0)-(null!==(i=null===(n=t.timing)||void 0===n?void 0:n.start)&&void 0!==i?i:0)}),e.animationJSONRenderSign^=1,console.log(e.animationJSON))},storeVItemTitle(e,t){e.vItemTitle=t},updateItemRow(e,{item:t,rowIdx:a}){const r=e.timelineRows.find(e=>e.includes(t));if(!r)return;const i=e.timelineRows[a];r.splice(r.indexOf(t),1),i.push(t);const n=e=>{var t,a,r,i;return(null!==(t=null===(a=e.timing)||void 0===a?void 0:a.start)&&void 0!==t?t:0)+(null!==(r=null===(i=e.timing)||void 0===i?void 0:i.offset)&&void 0!==r?r:0)};i.sort((e,t)=>n(e)-n(t))},updateItemSettings(e,{item:t,newItemInfo:a}){Object.assign(t,a),e.durationMap.set(t,hl.computeDuration(e.sceneEl,t,e.animationJSON.variable)),this.commit("editor/changeItemUpdateTuple",{item:t,newItemInfo:a}),this.commit("editor/updateVisTimeline"),this.commit("editor/updateAniJSONUsingTimelineRows")},changeItemUpdateTuple(e,{item:t,newItemInfo:a}){e.itemUpdateTuple={item:t,newItemInfo:a}},changeAnimationJSONRenderSign(e){e.animationJSONRenderSign^=1},changeNLPLoading(e,t){e.nlpLoading=t},changeNLPLinking(e,t){e.nlpLinking=t},dropTargetToTimeline(e,{x:t,y:a}){const r=this.state.target.selectedTargets,i=0===r.length?"*":r.map(e=>"#"+e.id).join(","),n=e.timelinePanelEl.querySelectorAll(".timeline-item"),s=Array.from(n).find(e=>vl.isPointInElement(t,a,e));if(void 0!=s){const t=s.getAttribute("row-idx"),a=s.getAttribute("item-idx"),r=e.timelineRows[t][a];r.target=i,e.durationMap.set(r,hl.computeDuration(e.sceneEl,r,e.animationJSON.variable)),this.commit("editor/updateVisTimeline"),this.commit("editor/updateAniJSONUsingTimelineRows")}},changeSelectionTool(e,t){e.selectionTool=t,e.hideToolbox=!1},hideToolBox(e){e.hideToolbox=!0},showToolBox(e){e.hideToolbox=!1},registerSelectionConfirm(e,t){e.selectionConfirm=t},clearSelectionConfirm(e,t){e.stopConfirm=!1,t&&e.selectionConfirm&&(e.stopConfirm=e.selectionConfirm()),e.stopConfirm||(e.selectionConfirm=null)},registerSelectionLeave(e,t){e.selectionLeave=t},clearSelectionLeave(e,t){e.stopLeave=!1,t&&e.selectionLeave&&(e.stopLeave=e.selectionLeave()),e.stopLeave||(e.selectionLeave=null)},updateElementClasses(e){const t=this.state.target.fullTargetList;t.forEach(t=>{Ma["k"](e.sceneEl).select("#"+t.id).attr("class",t.clazz)})},stashScene(e){if(!e.scene)return;const t=["type","id","clazz","data","tag","text"];e.scene.targetModel.elements=this.state.target.fullTargetList.map(e=>{const a={};return t.forEach(t=>a[t]=e[t]),a}),e.scene.spec={charts:e.resourceJSON,templates:e.templateJSON,animation:e.animationJSON};const a=(new DOMParser).parseFromString(e.scene.svgStr,"image/svg+xml").querySelector("svg");e.scene.targetModel.elements.forEach(e=>{Ma["k"](a).select("#"+e.id).attr("class",e.clazz)}),e.scene.svgStr=Gl.domElToString(a)},setAudioSrc(e,t){e.audioSrc=t,e.setAudioReadyFunc?e.audioEl.removeEventListener("canplaythrough",e.setAudioReadyFunc,!1):e.setAudioReadyFunc=function(){e.audioReady=!0},e.audioReady=!1,e.audioCompiling=!1,e.audioEl.addEventListener("canplaythrough",e.setAudioReadyFunc,!1)},setAudioBuffer(e,t){e.audioBuffer=t},changeUseAudio(e,t){e.useAudio=t},changeTime(e,t){e.time=t},changeShowPotential(e,t){e.showPotential=t},changeAudioReady(e,t){e.audioReady=t},fixScrollPos(e,t){const a=document.querySelector(".timeline-panel").offsetLeft,r=e.oldTimelineScale.invert(e.scrollLeft+t.x-a),i=e.timelineScale(r);e.scrollLeft=Math.max(i-(t.x-a),0)}};var oc={namespaced:!0,state:rc,getters:ic,actions:nc,mutations:sc};function lc(e,t,a){let r="./data/project/"+e;$a.a.get(r).then(e=>{t(e)}).catch(e=>{a(e)})}function cc(e,t,a){let r="./data/svg/"+e;return $a.a.get(r).then(e=>{t(e)}).catch(e=>{a(e)})}function dc(e,t,a){let r="./data/transcript/"+e;return $a.a.get(r).then(e=>{t(e)}).catch(e=>{a(e)})}function uc(e,t,a){let r="./data/audio/"+e;return $a.a.get(r).then(e=>{t(e)}).catch(e=>{a(e)})}function hc(e,t,a){let r="./data/target-v2/"+e;return $a.a.get(r).then(e=>{t(e)}).catch(e=>{a(e)})}function pc(e,t,a){let r="./data/linking/"+e;return $a.a.get(r).then(e=>{t(e)}).catch(e=>{a(e)})}function gc(e,t,a){let r="./data/insight/"+e;return $a.a.get(r).then(e=>{t(e)}).catch(e=>{a(e)})}var mc=[{id:"travel",label:"Travel",group:"Single chart"},{id:"parallel_coord",label:"parallel_coord",group:"Single chart"},{id:"living",label:"Living",group:"Single chart"},{id:"hunger",label:"Hunger",group:"Single chart"},{id:"radar",label:"Radar",group:"Single chart"},{id:"phone",label:"Phone",group:"Single chart"},{id:"radar2",label:"Radar2",group:"Single chart"},{id:"river",label:"River",group:"Single chart"},{id:"vega-lite-GDP-comparison",label:"GDP comparison",group:"Single chart"},{id:"vega-lite-GDP-comparison1",label:"GDP comparison1",group:"Single chart"},{id:"australia-fire-example1",label:"Australia Fire",group:"Single chart"},{id:"accounting-of-pirates-example1",label:"Accounting of Pirates",group:"Single chart"},{id:"commute-mode-example1",label:"Commute Mode",group:"Single chart"},{id:"house-prices-example1",label:"House Prices",group:"Single chart"},{id:"army-military-comparison-example1",label:"GDP Comparison",group:"Single chart"},{id:"sat-score-example1",label:"SAT Score",group:"Single chart"},{id:"scottish-independence-referendum-example1",label:"Scottish Independence Referendum",group:"Single chart"},{id:"share-of-profits-example1",label:"Share of Profits",group:"Single chart"},{id:"shortage-of-water-example1",label:"Shortage of Water",group:"Single chart"},{id:"transportation-mode-example1",label:"Transportation Mode",group:"Single chart"},{id:"wealth-inequality-example1",label:"Wealth Inequality",group:"Single chart"},{id:"tax-payment",label:"Tax-Payment",group:"WonderFlow2"},{id:"characteristics-of-mushrooms",label:"characteristics-of-mushrooms",group:"WonderFlow2"},{id:"chinese-tourists",label:"chinese-tourists",group:"WonderFlow2"},{id:"vega-lite-driving-shifts-into-reverse",label:"Driving Shifts Into Reverse",group:"Vega-Lite Chart"},{id:"vega-lite-PM25",label:"PM2.5",group:"Vega-Lite Chart"},{id:"vega-lite-5-point-Likert",label:"5-point Likert",group:"Vega-Lite Chart"},{id:"vega-lite-body-mass-of-penguins",label:"body-mass-of-penguins",group:"Vega-Lite Chart"},{id:"vega-lite-monthly-profit-and-loss",label:"monthly-profit-and-loss",group:"Vega-Lite Chart"},{id:"vega-lite-movie-ratings",label:"vega-lite-movie-ratings",group:"Vega-Lite Chart"},{id:"vega-lite-stock-prices",label:"vega-lite-stock-prices",group:"Vega-Lite Chart"},{id:"vega-lite-stock-prices2",label:"vega-lite-stock-prices2",group:"Vega-Lite Chart"},{id:"vega-lite-weather",label:"vega-lite-weather",group:"Vega-Lite Chart"},{id:"vega-lite-london-tube-lines",label:"vega-lite-london-tube-lines",group:"Vega-Lite Chart"},{id:"vega-lite-unemployment",label:"vega-lite-unemployment",group:"Vega-Lite Chart"},{id:"vega-lite-parallel-coordinate",label:"vega-lite-parallel-coordinate",group:"Vega-Lite Chart"},{id:"vega-lite-cars",label:"vega-lite-cars",group:"Vega-Lite Chart"},{id:"vega-lite-CO2",label:"vega-lite-CO2",group:"Vega-Lite Chart"},{id:"vega-lite-tourism",label:"vega-lite-tourism",group:"Vega-Lite Chart"},{id:"vega-lite1",label:"Vega-lite Test1",group:"Vega-Lite Chart"},{id:"vega-lite2",label:"Vega-lite Test2",group:"Vega-Lite Chart"},{id:"vega-lite5",label:"Vega-lite Test5",group:"Vega-Lite Chart"},{id:"vega-lite7",label:"Vega-lite Test7",group:"Vega-Lite Chart"},{id:"vega-lite4",label:"Vega-lite Test4",group:"Vega-Lite Chart"},{id:"vega-lite6",label:"Vega-lite Test6",group:"Vega-Lite Chart"},{id:"vega-lite8",label:"Vega-lite Test8",group:"Vega-Lite Chart"},{id:"vega-lite3",label:"Vega-lite Test3 (Improper)",group:"Vega-Lite Chart"},{id:"vega-lite15",label:"Vega-lite Test15",group:"Vega-Lite Chart"},{id:"vega-lite9",label:"Vega-lite Test9",group:"Vega-Lite Chart"},{id:"vega-lite10",label:"Vega-lite Test10",group:"Vega-Lite Chart"},{id:"vega-lite11",label:"Vega-lite Test11",group:"Vega-Lite Chart"},{id:"vega-lite12",label:"Vega-lite Test12",group:"Vega-Lite Chart"},{id:"vega-lite14",label:"Vega-lite Test14 (Hard)",group:"Vega-Lite Chart"},{id:"vega-lite16",label:"Vega-lite Test16",group:"Vega-Lite Chart"},{id:"vega-lite17",label:"Vega-lite Test17",group:"Vega-Lite Chart"},{id:"vega-lite18",label:"Vega-lite Test18",group:"Vega-Lite Chart"},{id:"vega-lite19",label:"Vega-lite Test19",group:"Vega-Lite Chart"},{id:"vega-lite20",label:"Vega-lite Test20",group:"Vega-Lite Chart"},{id:"figma-test",label:"Figma Test",group:"WonderFlow2"},{id:"pie-vega-HIV-example1",label:"pie-vega-HIV",group:"Single chart"},{id:"bar-vega-plan-timeline-example1",label:"bar-vega-plan-timeline",group:"Single chart"},{id:"pie-vega-mine-production-example1",label:"pie-vega-mine-production",group:"Single chart"},{id:"pie-vega-gas-emission-example1",label:"pie-vega-gas-emission",group:"Single chart"},{id:"pie-vega-covid-19-patient-example1",label:"pie-vega-covid-19-patient",group:"Single chart"},{id:"pie-vega-coffee-example1",label:"pie-vega-coffee",group:"Single chart"},{id:"pie-vega-woman-poverty-example1",label:"pie-vega-woman-poverty",group:"Single chart"},{id:"bar-vega-crime-example1",label:"bar-vega-crime",group:"Single chart"},{id:"bar-vega-food-emission-example1",label:"bar-vega-food-emission",group:"Single chart"},{id:"bar-vega-social-media-platform-example1",label:"bar-vega-social-media-platform",group:"Single chart"},{id:"bar-vega-co2-emission-example1",label:"bar-vega-co2-emission",group:"Single chart"},{id:"line-annual-box-office-earnings-example1",label:"line-annual-box-office-earnings",group:"Single chart"},{id:"line-3619-example1",label:"Line 3619",group:"Single chart"},{id:"vega-average-price-example1",label:"Average Price",group:"Single chart"}],fc=[{id:"australia-fire-example1",videoName:"Why does climate change make wildfires worse?",link:"https://youtu.be/mypEs1SBAUg?t=197",transcript:"In 2019, human-caused and out-of-control fires burned 976200 hectares of the Amazon rainforest. That's the third-highest increase in the rate of deforestation in the Amazon's history. At a 30% jump from the prior year, second only to 1995, which was 95% and 1998 which was 31%."},{id:"accounting-of-pirates-example1",videoName:"How Somalia’s Pirates Make Money",link:"https://youtu.be/dZh0B8AYxac?t=389",transcript:"First, investors get their guaranteed cut of at least 30%. The port, who looked the other way while they parked the ship, gets 5-10%. And the rest is split between the attackers, with a bonus of around $10,000 for being first to board the ship."},{id:"commute-mode-example1",videoName:"Why American public transit is so bad | 2020 Election",link:"https://youtu.be/-ZDZtBRTyeI?t=80",transcript:"The most common American commute is actually from suburb to suburb; routes that public transit in the US usually doesn’t serve. It’s one reason that the overwhelming majority of Americans get to work by driving alone. Most Americans don’t rely on public transit, making it better is rarely a top political priority, which makes things even harder for the people who do rely on neglected transit systems."},{id:"house-prices-example1",videoName:"Why are houses so expensive?",link:"https://youtu.be/vhAXp0xzMFg?t=189",transcript:"Here is a line chart."},{id:"army-military-comparison-example1",videoName:"China vs Japan - Who Would Win - Army / Military Comparison",link:"https://youtu.be/eBV4GmK4kO4?t=33",transcript:"The USA has the world's highest GDP of around 18.5 trillion dollars. It's followed by China with a nominal GDP of 11.8 trillion dollars, and then Japan with a GDP of around 4.8 trillion dollars. The European Union would take second place, but the EU is a combination of 28 states."},{id:"sat-score-example1",videoName:"The problem with America's college entrance exam",link:"https://youtu.be/WjVVwMGJ9S8?t=334",transcript:"Here's a chart of the average SAT scores by family income. Students whose families earn less than $20,000 score around 890 -- way below average. And as we move up the income brackets, students score higher and higher. The wealthiest students -- whose parents earn more than $200,000 -- score an average of 1150."},{id:"scottish-independence-referendum-example1",videoName:"Scottish independence referendum 2014 explained | Guardian Animations",link:"https://youtu.be/zIeVmqVB9pQ?t=29",transcript:"Didn't you just call Scotland a country? Isn't Scotland already a country? The definitive answer to that question is: sort of. Technically Scotland is a country within a country known as the United Kingdom. Scotland may have its own church, its own legal system, its own professional soccer league and its own dietary idiosyncrasies, but it’s still part of the UK, which also includes the countries of England, Wales and Northern Ireland."},{id:"share-of-profits-example1",videoName:"How American CEOs got so rich",link:"https://youtu.be/ylLTMYt24lA?t=299",transcript:"General Motor, Volkswagen and Toyota are three of the biggest motor corporations in the world. In this chart, you can see how much of their profits three companies spend on buybacks. GM has the highest buyback during this period, except 2016. Volkswagen hasn’t done any since 2012, and Toyota’s biggest buyback years are roughly the size of GM’s smallest."},{id:"shortage-of-water-example1",videoName:"Dubai's Plan to Outlive Oil",link:"https://youtu.be/-dsM8zPGqa0?t=159",transcript:"In the Middle East, the entire 3.2 million square kilometer peninsula lacks a single natural river. The United States, in comparison, has 250,000. 98.8% of Dubai’s water has to be pumped from the Persian Gulf and desalinated."},{id:"transportation-mode-example1",videoName:"Why American public transit is so bad | 2020 Election",link:"https://youtu.be/-ZDZtBRTyeI?t=243",transcript:"The people who live in these places are less likely than the national average to drive, and more likely to walk, bike, or take transit."},{id:"wealth-inequality-example1",videoName:"Wealth Inequality in America",link:"https://youtu.be/QPKKQnijnsM?t=161",transcript:"Here's that idea we asked everyone about something like this curve. This isn't too bad we've got some incentive as the wealthiest folks are now about 10 to 20 times better off than the poorest Americans. But hey even the poor folks aren't actually poor since the poverty line has stayed almost entirely off the chart. We have a super healthy middle class with a smooth transition into wealth, and yes Republicans and Democrats alike chose this curve."}];const wc=()=>({projectList:mc,galleryList:fc,staticSvgMap:new Map,staticSvgMapSign:!1,projectId:null,projectSpec:null,svgStrMap:new Map,audioStrMap:new Map,transcriptMap:new Map,targetModelMap:new Map,extraProjectSpecMap:new Map,linkingMap:new Map,insightsMap:new Map,audioEl:null}),yc={},bc={async queryProjectSpec({commit:e,dispatch:t},a){e("changeProjectId",a),e("initResources");const r=a+".json5";function i(e){const a=[];for(const r of e){const e=r.charts[0].source;if(""!==e){const r=e.trim().replace("./","").replace(".svg","");a.push(t("queryStaticSVG",r)),a.push(t("queryTranscript",r)),a.push(t("queryStaticAudio",r)),a.push(t("queryTargetModel",r)),a.push(t("queryLinking",r))}}return Promise.all(a)}lc(r,t=>{const a="string"===typeof t.data?lr.a.parse(t.data):t.data;e("changeProjectSpec",a),i(a.scenes).then(()=>{e("project/initProjectView",null,{root:!0})})},e=>{Object(pl["Notification"])({title:"Fail to get sample file.",message:e.message,type:"error"}),console.error(e)})},async queryProjectSpec2({state:e,commit:t,dispatch:a},r){function i(e){const t=[];for(const r of e){const e=r.charts[0].source;if(""!==e){const r=e.trim().replace("./","").replace(".svg","");t.push(a("queryStaticSVG",r)),t.push(a("queryTranscript",r)),t.push(a("queryStaticAudio",r)),t.push(a("queryTargetModel",r)),t.push(a("queryLinking",r)),t.push(a("queryInsights",r))}}return Promise.all(t)}if(e.extraProjectSpecMap.has(r)){const a=r;t("changeProjectId",r),t("initResources");const{svgStr:i,targetModel:n,transcript:s,insights:o,audioStr:l,fakeProjectSpec:c}=e.extraProjectSpecMap.get(r);t("changeProjectSpec",c),t("addSVGStr",{srcId:a,svgStr:i}),t("addStaticSVGStr",{srcId:a,svgStr:i}),t("addTargetModel",{srcId:a,targetModel:n}),t("addTranscript",{srcId:a,transcript:s}),t("addAudioStr",{srcId:a,audioStr:l}),t("addInsights",{srcId:a,insights:o}),t("project/initProjectView",null,{root:!0}),t("editor/changeSceneById",0,{root:!0}),t("editor/initWorkspace",null,{root:!0})}else{t("changeProjectId",r),t("initResources");const e=r+".json5";lc(e,e=>{const a="string"===typeof e.data?lr.a.parse(e.data):e.data;t("changeProjectSpec",a),i(a.scenes).then(()=>{t("project/initProjectView",null,{root:!0}),t("editor/changeSceneById",0,{root:!0}),t("editor/initWorkspace",!0,{root:!0})})},e=>{Object(pl["Notification"])({title:"Fail to get sample file.",message:e.message,type:"error"}),console.error(e)})}},async queryAllSvg({state:e,commit:t}){e.projectList.forEach(a=>{const r=a.id;if(e.staticSvgMap.has(r))return;const i=r+".json5";lc(i,e=>{const a="string"===typeof e.data?lr.a.parse(e.data):e.data,i=a.scenes[0],n=i.charts[0].source;if(""!==n){const e=n.trim().replace("./","").replace(".svg",""),a=e+".svg";cc(a,e=>{t("addStaticSVGStr",{projectId:r,svgStr:e.data})},e=>{t("addStaticSVGStr",{projectId:r,svgStr:""}),console.error(e)})}},e=>{console.error(e)})})},queryStaticSVG({commit:e},t){const a=t+".svg";return cc(a,a=>{e("addSVGStr",{srcId:t,svgStr:a.data})},r=>{e("addSVGStr",{srcId:t,svgStr:""}),Object(pl["Notification"])({title:`Chart resource ${a} not found.`,message:r.message,type:"warning"}),console.error(r)})},queryInsights({commit:e},t){const a=t+".json";return gc(a,a=>{e("addInsights",{srcId:t,insights:a.data})},r=>{e("addInsights",{srcId:t,insights:{}}),Object(pl["Notification"])({title:`Insights resource ${a} not found.`,message:r.message,type:"warning"}),console.error(r)})},queryStaticAudio({commit:e},t){const a=t+".txt";return uc(a,a=>{e("addAudioStr",{srcId:t,audioStr:a.data})},a=>{e("addAudioStr",{srcId:t,audioStr:""}),Object(pl["Notification"])({title:"Fail to get static audio.",message:a.message,type:"error"}),console.log(a)})},queryTranscript({commit:e},t){const a=t+".json";return dc(a,a=>{e("addTranscript",{srcId:t,transcript:a.data})},r=>{e("addTranscript",{srcId:t,transcript:{}}),Object(pl["Notification"])({title:`Transcript resource ${a} not found.`,message:r.message,type:"warning"}),console.error(r)})},queryTargetModel({commit:e},t){const a=t+".json";return hc(a,a=>{e("addTargetModel",{srcId:t,targetModel:a.data})},r=>{e("addTargetModel",{srcId:t,targetModel:null}),a.includes("vega")||console.log(r)})},queryLinking({commit:e},t){const a=t+".json";return pc(a,a=>{e("addLinking",{srcId:t,linking:a.data})},r=>{e("addLinking",{srcId:t,linking:null}),a.includes("vega")||(Object(pl["Notification"])({title:`Linking ${a} not found.`,message:r.message,type:"warning"}),console.log(r))})},addProject({state:e,commit:t},{srcId:a,svgStr:r}){let i=a.toLowerCase().replace(/\s+/g,"-"),n=0;const s=new Set(e.projectList.map(e=>e.id));let o=i;while(s.has(o))n+=1,o=i+"-"+n;i=o;const l=Zl.updateSVGModel(r,i);e.projectList.unshift({id:i,label:i,group:"Custom chart"});const c={svgStr:l.svgStr,targetModel:l.targetModel,transcript:{},audioStr:"",fakeProjectSpec:{projectId:i,scenes:[{charts:[{source:`./${i}.svg`}],animation:{target:"."+i,sequence:{sync:[]}}}]}};e.extraProjectSpecMap.set(i,c),t("addStaticSVGStr",{projectId:i,svgStr:l.svgStr}),t("changeProjectId",i)}},xc={changeProjectId(e,t){e.projectId=t},initResources(e){e.projectSpec=null,e.svgStrMap=new Map,e.audioStrMap=new Map,e.transcriptMap=new Map,e.targetModelMap=new Map,e.insightsMap=new Map},changeProjectSpec(e,t){e.projectSpec=t},addSVGStr(e,{srcId:t,svgStr:a}){e.svgStrMap.set(t,a)},addStaticSVGStr(e,{projectId:t,svgStr:a}){e.staticSvgMap.set(t,a),setTimeout(()=>this.commit("resource/changeStaticSvgMapSign"),0)},changeStaticSvgMapSign(e){e.staticSvgMapSign^=!0},addInsights(e,{srcId:t,insights:a}){e.insightsMap.set(t,a)},addAudioStr(e,{srcId:t,audioStr:a}){e.audioStrMap.set(t,a)},addTranscript(e,{srcId:t,transcript:a}){e.transcriptMap.set(t,a)},addTargetModel(e,{srcId:t,targetModel:a}){e.targetModelMap.set(t,a)},addLinking(e,{srcId:t,linking:a}){e.linkingMap.set(t,a)},updateSVGModel(e,{chartId:t,svgStr:a,targetModel:r}){e.svgStrMap.set(t,a),e.targetModelMap.set(t,r)},registerAudioEl(e,t){e.audioEl=t}};var vc={namespaced:!0,state:wc,getters:yc,actions:bc,mutations:xc};function _c(){let e=0;const t=(t,a)=>{a.forEach(a=>{t.children.push(new Ec(e++,a,!0))})},a=new Ec(e++,"scene"),r=new Ec(e++,"background");a.children.push(r);const i=new Ec(e++,"chart");a.children.push(i);const n=new Ec(e++,"title");i.children.push(n),t(n,["main-title","sub-title"]);const s=new Ec(e++,"mark");i.children.push(s),t(s,["bar","label bar-label","line","point","area","sector"]);const o=new Ec(e++,"axis");i.children.push(o);const l=new Ec(e++,"legend");i.children.push(l),t(l,["legend-label","legend-symbol"]);const c=new Ec(e++,"x-axis");o.children.push(c),t(c,["domain x-domain","label x-label","tick x-tick","symbol x-symbol","title x-title"]);const d=new Ec(e++,"y-axis");return o.children.push(d),t(d,["domain y-domain","label y-label","tick y-tick","symbol y-symbol","title y-title"]),Tc(a),Ec.toJSON(a)}function Tc(e,t){let a;a=t?t+" "+e.classes:e.classes,e.fullClasses=a,e.children.forEach(e=>Tc(e,a))}class Ec{constructor(e,t,a){Object(me["a"])(this,"id",void 0),Object(me["a"])(this,"type",void 0),Object(me["a"])(this,"classes",void 0),Object(me["a"])(this,"fullClasses",void 0),Object(me["a"])(this,"children",void 0),Object(me["a"])(this,"isLeaf",void 0),this.id=e,this.classes=t;const r=t.split(" ");this.type=r[r.length-1],this.children=[],this.isLeaf=null!==a&&void 0!==a&&a}static toJSON(e){return Object.assign({},e,{children:e.children.map(e=>Ec.toJSON(e))})}}const Sc=new Set(["mark","axis","title","annotation","background","legend","unknown-type"]),Ac=()=>({chartType:"unknown",fullTargetList:[],selectedTargets:[],groupedTargetsMap:new Map,dataGroupUpdateKeyword:null,fullTargetLoadSign:0,tableSelectionChangeSign:0,dataGroupChangeSign:0,dataGroupClearSign:0,svgSelectionChangeSign:0,visibilityChangeSign:0,new_counter:0,dragDropSVG:null,clientX:0,clientY:0,targetTree:_c(),activeFilters:[]}),Nc={isDragging:e=>null!=e.dragDropSVG},Oc={},Rc={initTargetModel(e,t){e.chartType=t.chartType,e.fullTargetList=t.elements,e.groupedTargetsMap=new Map,e.selectedTargets=[],e.fullTargetList.forEach(e=>{e.classList=e.clazz.split(" ").reverse()}),e.fullTargetList.forEach(e=>{let t=e.classList.find(t=>t.match(e.type+"-\\d*"));if(t){const a=t.match(/^.*-(\d*)$/);if(a){const r=a[1];t=e.type+" #"+r}}else t=e.type;e.name=t});const a=new Map;e.fullTargetList.forEach(e=>{var t;a.set(e.name,(null!==(t=a.get(e.name))&&void 0!==t?t:0)+1)}),a.forEach((t,a)=>{t>1&&e.fullTargetList.filter(e=>e.name===a).forEach((e,t)=>e.name=`${a} #${t}`)}),e.fullTargetList.forEach(e=>{const t=e.classList.find(e=>Sc.has(e));e.mainClass=null!==t&&void 0!==t?t:null}),e.fullTargetList.forEach(e=>{e.visibility=!0}),e.fullTargetList.forEach(t=>{if(null!==t.data){var a=t.data;a.constructor!=Array&&(a=new Array(a)),a=a.map(e=>JSON.stringify(e).toLowerCase()),t.related_targets=e.fullTargetList.filter(e=>{if(e.id==t.id||null===e.data)return!1;var r=e.data;return r.constructor!=Array&&(r=new Array(r)),r=r.map(e=>JSON.stringify(e).toLowerCase()),r.every(e=>a.includes(e))&&r.length>0})}}),e.fullTargetList.forEach(e=>{var t=null;null!=e.text?t=e.text.toLowerCase().trim():null!=e.data&&(e.type.includes("symbol")||e.type.includes("sector-line"))&&("object"===typeof e.data&&void 0!=e.data.name?t=e.data.name.toLowerCase().trim():("string"===typeof e.data||e.data instanceof String)&&(t=e.data.toLowerCase().trim())),e.keyword=t}),e.fullTargetList.forEach(t=>{if(null!==t.keyword&&void 0!==t.keyword){e.groupedTargetsMap.has(t.keyword)||e.groupedTargetsMap.set(t.keyword,new Set);var a=e.groupedTargetsMap.get(t.keyword);a.add(t.id),null!=t.related_targets&&t.related_targets.forEach(e=>a.add(e.id)),e.groupedTargetsMap.set(t.keyword,a)}}),console.log("groupedTargetsMap:",e.groupedTargetsMap),this.commit("target/changeFullTargetLoadSign"),this.commit("target/changeTableSelectionSign")},updateDataGroup(e,{targets:t,keyword:a,oldkeyword:r}){e.groupedTargetsMap.set(a,new Set(t)),this.commit("target/changeDataGroupSign"),r&&this.commit("target/changeDataGroupKeyword",a)},changeFullTargetLoadSign(e){e.fullTargetLoadSign^=1},changeSelectedTargets(e,t){e.selectedTargets=t},changeSelectedTargetsById(e,t){const a=new Set(t);e.selectedTargets=e.fullTargetList.filter(e=>a.has(e.id))},changeSelectedTargetsByIcon(e,t){if("string"===typeof t.target){const a=new Set(t.target.replace(/[#,]/g,"").split(/[\s\n]/));e.selectedTargets=e.fullTargetList.filter(e=>a.has(e.id))}else if(Array.isArray(t.target)){const a=new Set(t.target);e.selectedTargets=e.fullTargetList.filter(e=>a.has(e.id))}},changeActiveFilters(e,t){e.activeFilters=t},changeTableSelectionSign(e){e.tableSelectionChangeSign^=1},changeDataGroupSign(e){e.dataGroupChangeSign^=1},changeDataGroupKeyword(e,t){e.dataGroupUpdateKeyword=t},resetDataGroupKeyword(e){e.dataGroupUpdateKeyword=null},changeSvgSelectionChangeSign(e){e.svgSelectionChangeSign^=1},changeVisibilityChangeSign(e){e.visibilityChangeSign^=1},changeDragDropSVG(e,t){e.dragDropSVG=t},changeCursorPosition(e,{x:t,y:a}){e.clientX=t,e.clientY=a},setTargetType(e,{targetIdList:t,targetNode:a}){const r=new Set(t),i=e.fullTargetList.filter(e=>r.has(e.id)),n=this.state.editor.scene.chartId;i.forEach(e=>{e.clazz=n+" "+a.fullClasses,e.classList=a.fullClasses.split(" ").reverse(),e.type=a.type;const t=e.classList.find(e=>Sc.has(e));e.mainClass=null!==t&&void 0!==t?t:null}),e.fullTargetList=[...e.fullTargetList],this.commit("target/changeTableSelectionSign")},setTargetClass(e,{targetIdList:t,targetClass:a}){const r=new Set(t);e.fullTargetList.forEach((t,i)=>{r.has(t.id)&&(t.mainClass=a,e.fullTargetList[i]=t)}),e.fullTargetList=[...e.fullTargetList]},changeVisibility(e,{showIdList:t,hideIdList:a}){const r=new Set(t),i=new Set(a);for(let n=0;n<e.fullTargetList.length;n++){const t=e.fullTargetList[n];r.has(t.id)?(t.visibility=!0,e.fullTargetList[n]=t):i.has(t.id)&&(t.visibility=!1,e.fullTargetList[n]=t)}this.commit("target/changeVisibilityChangeSign")}};var Mc={namespaced:!0,state:Ac,getters:Nc,actions:Oc,mutations:Rc};class Cc{constructor(){Object(me["a"])(this,"id",void 0),Object(me["a"])(this,"spec",void 0),Object(me["a"])(this,"chartId",void 0),Object(me["a"])(this,"svgStr",void 0),Object(me["a"])(this,"audioStr",void 0),Object(me["a"])(this,"transcript",void 0),Object(me["a"])(this,"targetModel",void 0),Object(me["a"])(this,"sceneEl",void 0),Object(me["a"])(this,"audioDuration",void 0),this.id=Object(fe["a"])(),this.spec={charts:[],templates:[],animation:null}}}function Ic(e,t){const a=JSON.parse(JSON.stringify(e));let r=[];const i=a["d1"]+" "+a["d2"]+" "+a["insight1"]["insightSentence"]+" "+a["insight2"]["insightSentence"]+" "+a["insight3"]["insightSentence"];console.log(i);let n=0;const s=a["d1"]+" ";r.push({insightType:"title",subType:"title",insightWords:s,pos:[n,n+s.length],insightData:[]}),n+=s.length;const o=a["d2"]+" ";if("pie"===t.type)r.push({insightType:"axis",subType:"arc",insightWords:o,pos:[n,n+o.length],insightData:[]}),n+=o.length;else{let e=o.split("y-axis"),a=e[0],s=e[1].split("legend"),l="legend"+s[1];1===s.length&&(s=e[1].split("color"),l="color"+s[1]);let c="y-axis"+s[0];r.push({insightType:"axis",subType:"x",insightWords:e[0],pos:[n,n+a.length],insightData:[]}),n+=a.length,t.row>1&&(r.push({insightType:"axis",subType:"y",insightWords:i.slice(n,n+c.length),pos:[n,n+c.length],insightData:[]}),n+=c.length),r.push({insightType:"axis",subType:"legend",insightWords:i.slice(n,n+l.length),pos:[n,n+l.length],insightData:[]}),n+=l.length}let l=[a["insight1"],a["insight2"],a["insight3"]];return l.forEach(e=>{e["subInsights"].forEach(a=>{let s=a["phrases"],o=kc(i,a,!0,n);-1!==o&&(n<o&&r.push({insightType:"none",subType:"none",insightWords:i.slice(n,o),pos:[n,o],insightData:[],value:""}),r.push({insightType:e["insightType"],subType:a["type"],pos:[o,o+s.length],insightWords:i.slice(o,o+s.length),insightData:Lc(a["data"],t),value:a["value"]?a["value"]:""}),n=o+s.length)})}),n<i.length&&r.push({insightType:"none",subType:"none",insightWords:i.slice(n,i.length),pos:[n,i.length],insightData:[]}),console.log(r),r}function Lc(e,t){let a=[];console.log(e);for(const r of e){let e=r.split(", ");1===e.length&&(e=r.split(","));let i={};"pie"===t.type?(console.log(e),i[t.y]=parseFloat(e[1]),i[t.legend]=e[0],i["idx"]=t.data.findIndex(a=>parseFloat(a[t.y])===parseFloat(e[1])&&a[t.legend]===e[0])):2===e.length?(i[t.x]=e[0],i[t.y]=parseFloat(e[1]),i["idx"]=t.data.findIndex(a=>parseFloat(a[t.y])===parseFloat(e[1])&&a[t.x]===e[0])):(i[t.x]=e[0],i[t.y]=parseFloat(e[1]),i[t.legend]=e[2],i["idx"]=t.data.findIndex(a=>a[t.x]===e[0]&&parseFloat(a[t.y])===parseFloat(e[1])&&a[t.legend]===e[2])),a.push(i)}return console.log(a),a}function kc(e,t,a,r){let i=-1;return a?i=e.toLowerCase().indexOf(t["phrases"].toLowerCase(),r):(console.log(t["subInsights"][0]["phrases"].toLowerCase()),i=e.toLowerCase().indexOf(t["subInsights"][0]["phrases"].toLowerCase())),i}function Pc(e,t){const a=(new DOMParser).parseFromString(e,"image/svg+xml").querySelector("svg");let r=[],i="";const n=Array.from(a.querySelectorAll("*:not(g,svg,defs,defs *)")).filter(e=>"true"!=e.ariaHidden);let s=0;n.forEach(e=>{if(null!==e.attributes.getNamedItem("ac-data")){const t=JSON.parse(e.attributes.getNamedItem("ac-data").value.replace(/(&quot;)/g,'"'));r.push(t),s=Math.max(Object.keys(t).length,s)}else e.classList.contains("title")&&(i=e.textContent)}),console.log(s);const o=r.filter(e=>Object.keys(e).length===s);let l={};l["data"]=o,l["title"]=i,l["type"]=t;let c=[];if("pie"===t)l["y"]=Object.keys(o[0])[0],l["legend"]=Object.keys(o[0])[1];else if(i.includes("Deaths"))l["x"]=Object.keys(o[0])[0],l["y"]=Object.keys(o[0])[1],c=[];else{l["x"]=Object.keys(o[0])[0],l["y"]=Object.keys(o[0])[1],l["legend"]=Object.keys(o[0])[2];for(const e of o){let t=e[l.legend];c.includes(t)||c.push(t)}}return l["column"]=o.length/c.length,l["row"]=c.length,console.log(l),l}const Bc={formatInsightsFromGPT:Ic,getsSVGSpec:Pc};var jc=a("4378");function Gc(e,t,a){const r=e.find(".mark-symbol path"),i=e.find(".titled");console.log(e,i,r);const n=r[a.index],s=.2*e.bbox().height,o=e.find(".layer_1_marks")[0];console.log(o.x()),console.log(n.attr());let l=[n.x()+n.width()/2,n.y()+n.height()/2];console.log(s,l);let c=.2*e.bbox().height,d=1;l[1]-e.bbox().height/2>0&&(d=-1);const u=e.group({"aria-roledescription":"annotation"});u.circle(s).stroke({color:"#f06",opacity:.5,width:5}).fill("none").cx(l[0]).cy(l[1]+c*d).attr({"aria-roledescription":"annotation"}),u.text("0.5").x(l[0]).y(l[1]+c*d).font({size:i.attr()[0]["font-size"],opacity:.5,fill:"#f06",family:i.attr()[0]["font"],anchor:"middle"}).attr({"aria-roledescription":"annotation"}),u.line(l[0],l[1]+(c-.5*s)*d,l[0],l[1]).stroke({color:"#f06",opacity:.5,width:5,linecap:"round"}).attr({"aria-roledescription":"annotation"})}function Dc(e,t,a,r){for(const i of t){const t=Hc(e,i,a);if(""===t)continue;const n=e.find("#"+t)[0];let s=1;n.y()>e.bbox().height/2&&(s*=-1.5);const o=20;e.path("M12 4V20M12 4L15.5 7.5M12 4L8.5 7.5M12 20L8.5 16.5M12 20L15.5 16.5").scale(1.5,n.x(),n.y()).stroke({color:"#f06",width:1}).fill("none").move(n.x()-.1*o,n.y()+s*o*(s>0?.5:1)).attr({class:r["insightType"].toLowerCase().replace(" ","-")+" annotation arrow","stroke-linecap":"round"});const l=a.data[$c(t)][a.y],c=l.toString().length;e.text(l).x(n.x()-c*e.width()*.002).y(n.y()+s*e.height()*.08).font({size:e.height()/40,fill:"#f06",family:"Inconsolata"}).attr({class:r["insightType"].toLowerCase().replace(" ","-")+" annotation text"})}}function Uc(e,t,a,r,i){const n=Hc(e,t[0],a);console.log(n);let s="mark-line-"+Math.floor($c(n)/a.column);1===a.row&&(s="mark-line-0"),console.log(s,n);let o=e.find("#"+s)[0];const l=e.find(".point"),c=parseInt($c(n)),d=l[c+a.column-1];o.addClass("trend"),console.log(l);for(let g=c;g<c+a.column;g++)l[g].addClass("trend");const u=2.5,h=20,p=[d.x()-u*h/2,d.y()-h*u*1.5];if(r["insightWords"].toLowerCase().includes("increas")?(o.addClass("increase"),e.path("M20.5 7.5L13 15l-4-4-6 6M16 7h4.95v5").move(p[0],p[1]).scale(u,p[0],p[1]).fill("none").stroke({color:o.attr("stroke"),width:2}).addClass("trend-annotation")):r["insightWords"].toLowerCase().includes("decreas")?(o.addClass("decrease"),e.path("M20.5 17L13 9.5l-4 4-6-6m13 10h4.95v-5").move(p[0],p[1]).scale(u,p[0],p[1]).fill("none").stroke({color:o.attr("stroke"),width:2}).addClass("trend-annotation")):(e.path("M3 12h4l3-9 4 18 3-9h4").move(p[0],p[1]).scale(u,p[0],p[1]).fill("none").stroke({color:o.attr("stroke"),width:2}).addClass("trend-annotation"),o.addClass("fluctuate")),console.log(i),i){let t=o.clone();t.removeClass("trend").addClass("destory"),o.removeClass("line").removeClass("mark"),e.add(t)}}function $c(e){let t=e.split("-");return parseInt(t[t.length-1])}function Hc(e,t,a){let r="";return e.each((function(e,i){const n=i[e];if(Object.keys(n.attr()).includes("ac-data")){const e=JSON.parse(n.attr("ac-data").replace(/(&quot\;)/g,'"'));console.log(t[a["x"]]===e[a["x"]],e[a["y"]]===t[a["y"]],e[a["legend"]]===t[a["legend"]]),e[a["x"]]===t[a["x"]]&&e[a["y"]]===t[a["y"]]&&e[a["legend"]]===t[a["legend"]]&&(r=n.attr("id"),console.log(r))}})),r}function Fc(e,t,a){const r=Object(jc["a"])().svg(a).children()[0];console.log(e);let i=!1;for(let s=0;s<e.length;s++){const a=e[s];["extreme","outlier","turning point","proportion"].includes(a["insightType"].toLowerCase())&&Dc(r,a["insightData"],t,a),["trend"].includes(a["insightType"].toLowerCase())&&Uc(r,a["insightData"],t,a,i),"show"===a["insightType"]&&(i=!0)}const n=Vc(r);return n}function Vc(e){return e.width(e.bbox().width).height(e.bbox().height).svg()}const Wc={addArrowAnno:Dc,addCircleLineAnno:Gc,annotateSVGUsingInsights:Fc};function Jc(e,t,a){const r=(new DOMParser).parseFromString(a,"image/svg+xml").querySelector("svg");var i=Array.from(r.querySelectorAll("*")).filter(e=>null!=e.ariaRoleDescription);const n={},s={};e.forEach(e=>{if(["extreme","outlier","proportion","difference","rank","association","distribution","value"].includes(e["insightType"].toLowerCase()))e.insightData.forEach(t=>{n[t.idx]?n[t.idx].push(e.subType):n[t.idx]=[e.subType]}),(t.title.includes("elephone")||t.title.includes("etaverse"))&&r.appendChild(Kc(a,e.subType,t.title));else if("trend"===e["insightType"].toLowerCase()){if("bar"===t.type){var o=i[i.findIndex(t=>t.id==="bar-"+e.insightData[0].idx)];r.appendChild(qc(e.subType,o,t.title))}else if("line"===t.type){var l=i[i.findIndex(t=>t.id==="point-"+e.insightData[e.insightData.length-1].idx)];console.log(l),r.appendChild(qc(e.subType,l,t.title)),e.insightData.forEach(a=>{n[a.idx]?n[a.idx].push(e.subType):n[a.idx]=[e.subType],s[Math.floor(a.idx/t.column)]?s[Math.floor(a.idx/t.column)].push(e.subType):s[Math.floor(a.idx/t.column)]=[e.subType]})}}else if("aggregation"===e["insightType"].toLowerCase()&&"pie"===t.type){var c=i[i.findIndex(e=>"sector-0"===e.id)];c.parentNode.appendChild(zc(e))}("distribution"===e["insightType"].toLowerCase()&&"none"!==e.subType.toLowerCase()&&"bar"===t.type||"difference"===e["insightType"].toLowerCase()&&"line"===t.type&&t.title.includes("merica"))&&r.appendChild(Kc(a,e.subType,t.title)),"show"===e["insightType"]&&!0}),console.log(n),i.forEach(e=>{var a=Yc(e.id);switch(e.classList[e.classList.length-1]){case"bar":case"bar-label":n[a]&&"bar"===t.type&&n[a].forEach(t=>{e.classList.add(t.toLowerCase())});break;case"sector":n[a]&&n[a].forEach(t=>{e.classList.add(""+t.toLowerCase())});break;case"sector-label":n[a]&&n[a].forEach(t=>{e.classList.add(""+t.toLowerCase())});break;case"contour":n[a]&&n[a].forEach(t=>{e.classList.add(t.toLowerCase())});break;case"point":n[a]&&n[a].forEach(t=>{e.classList.add(t.toLowerCase())});break;case"line":s[a]&&s[a].forEach(t=>{e.classList.add(t.toLowerCase())});break}});const o=Xc(r);return{svgstr:o,dict:n}}function qc(e,t,a){let r=[100,220],i=[300,200],n=[400,100];if(a.includes("elephone")?(r=[450,120],i=[450,220]):a.includes("Nuclear")?(r=[100,100],i=[300,200]):a.includes("etaverse")?r=[680,120]:a.includes("airports")?(r=[680,120],i=[680,220]):a.includes("Qatar")?(r=[750,80],i=[750,150]):a.includes("merica")?(r=[100,230],n=[400,100]):a.includes("eath")&&(r=[600,50]),"increase"===e||"fluctuate_increase"===e){const a=Object(jc["a"])().path("M20.5 7.5L13 15l-4-4-6 6M16 7h4.95v5").move(r[0],r[1]).scale(2,r[0],r[1]).fill("none").stroke({color:t.getAttribute("fill"),width:2}).addClass(e+"-annotation").attr("stroke-linejoin","round");return(new DOMParser).parseFromString(a.svg(),"image/svg+xml").firstChild}if("decrease"===e||"fluctuate_decrease"===e){const a=Object(jc["a"])().path("M20.5 17L13 9.5l-4 4-6-6m13 10h4.95v-5").move(i[0],i[1]).scale(2,i[0],i[1]).fill("none").stroke({color:t.getAttribute("fill"),width:2}).addClass(e+"-annotation").attr("stroke-linejoin","round");return(new DOMParser).parseFromString(a.svg(),"image/svg+xml").firstChild}if("fluctuate"===e){const a=Object(jc["a"])().path("M3 12h4l3-9 4 18 3-9h4").move(n[0],n[1]).scale(2,n[0],n[1]).fill("none").stroke({color:t.getAttribute("fill"),width:2}).addClass(e+"-annotation").attr("stroke-linejoin","round");return(new DOMParser).parseFromString(a.svg(),"image/svg+xml").firstChild}}function zc(e){const t=[58,100],a=document.createElementNS("http://www.w3.org/2000/svg","text");return a.setAttribute("x",t[0]),a.setAttribute("y",t[1]),a.setAttribute("font-size","14"),a.setAttribute("fill","#ff0066"),a.setAttribute("font-family","Inconsolata"),a.setAttribute("class",e.subType),a.textContent=e.subType+": "+e.value,a}function Kc(e,t,a){const r=Object(jc["a"])().svg(e).children()[0],i=[r.bbox().w/2,r.bbox().h/2];console.log(i,r.bbox());var n=Object(jc["a"])().rect(1.5*i[0],1.5*i[1]).radius(50).move(.25*i[0],.5*i[1]).fill("none").stroke({color:"#f06",width:5}).addClass(t+"-annotation");return a.includes("elephone")?n=Object(jc["a"])().rect(1.5*i[0],1.5*i[1]).radius(50).move(.1*i[0],.4*i[1]).fill("none").stroke({color:"#f06",width:5}).addClass(t+"-annotation"):a.includes("etaverse")?n=Object(jc["a"])().rect(1.5*i[0],1.5*i[1]).radius(50).move(.28*i[0],.2*i[1]).fill("none").stroke({color:"#f06",width:5}).addClass(t+"-annotation"):a.includes("merica")&&(n=Object(jc["a"])().rect(1.8*i[0],1.5*i[1]).radius(50).move(.15*i[0],.3*i[1]).fill("none").stroke({color:"#f06",width:5}).addClass(t+"-annotation")),(new DOMParser).parseFromString(n.svg(),"image/svg+xml").firstChild}function Yc(e){let t=e.split("-");return parseInt(t[t.length-1])}function Xc(e){const t=document.createElement("div");return t.appendChild(e),t.innerHTML}const Zc={annotateSVGUsingInsights:Jc},Qc=()=>({isInitialized:!1,scenes:[],selectedScene:null,canvasHeight:500,canvasWidth:800,canvasRenderSign:0,sceneEl:null,animationJSON:null,timeline:null,running:!1,useAudio:!0,audioSrc:"",audioEl:null,audioReady:!1}),ed={},td={async compile({commit:e,dispatch:t}){await t("createAudioSrc"),e("createAnimationJSON"),e("createTimeline")},createAudioSrc({state:e,commit:t}){e.scenes.some(e=>!e.audioSrc)&&(console.warn("Missing audio resources"),t("setAudioSrc",""));const a=e.scenes.map(e=>e.audioStr).map(e=>Ll.dataURItoBlob(e)),r=a.map(e=>Ll.blobToAudioBuffer(e));return Promise.all(r).then(e=>{console.log(e),e.map((e,a)=>{const r=Ll.computeAudioDuration(e);t("setSceneAudioDuration",{sceneIndex:a,duration:r})});const a=e.map(()=>1),r=Ll.concatAudio(e,a),i=Ll.audioBufferToBlob(r),n=window.URL.createObjectURL(i);t("setAudioSrc",n)})}},ad={initProjectView(e){e.scenes=[],this.state.resource.projectSpec.scenes.forEach(t=>{const a=new Cc;Object.assign(a.spec,t);const r=t.charts[0].source.replace("./","").replace(".svg","");if(a.chartId=r,a.initialSvgStr=this.state.resource.svgStrMap.get(r),a.svgStr=this.state.resource.svgStrMap.get(r),a.audioStr=this.state.resource.audioStrMap.get(r),a.transcript=this.state.resource.transcriptMap.get(r),a.targetModel=this.state.resource.targetModelMap.get(r),a.linking=this.state.resource.linkingMap.get(r),(r.includes("line")||r.includes("bar")||r.includes("pie"))&&(a.insights=this.state.resource.insightsMap.get(r)),!a.targetModel)if(r.includes("line")||r.includes("bar")||r.includes("pie")){const{svgStr:e,targetModel:t}=a.chartId.includes("vega")?Zl.updateSVGModel(a.initialSvgStr,a.chartId):Gl.updateSVGModel(a.initialSvgStr,a.chartId),i=Bc.getsSVGSpec(e,r.split("-")[0]);a.description=Bc.formatInsightsFromGPT(a.insights,i),a.chartId.includes("vega")?(a.svgStr=Zc.annotateSVGUsingInsights(a.description,i,e).svgstr,a.insightDict=Zc.annotateSVGUsingInsights(a.description,i,e).dict):Wc.annotateSVGUsingInsights(a.description,i,e),a.chartId.includes("vega")&&(a.targetModel=t),this.commit("resource/updateSVGModel",{chartId:r,svgStr:e,targetModel:we(t)},{root:!0})}else{const{svgStr:e,targetModel:t}=Zl.updateSVGModel(a.svgStr,a.chartId);a.svgStr=e,a.targetModel=t,this.commit("resource/updateSVGModel",{chartId:r,svgStr:e,targetModel:we(t)},{root:!0})}e.scenes.push(a)}),e.selectedScene=e.scenes[0],e.isInitialized=!0,this.commit("project/changeCanvasRenderSign")},changeSelectedScene(e,t){e.selectedScene=t},addScene(e,{charts:t}){const a=new Cc;e.scenes.push(a),t&&(a.spec.charts=t)},mountSceneElement(e,t){e.sceneEl=t},createTimeline(e){hl.resetTemplateLib(),e.scenes.map(e=>e.spec.templates).forEach(e=>{e&&hl.registerTemplates(...e)}),e.timeline&&(e.timeline.kill(),e.timeline.clear(),e.timeline=null);try{e.timeline=hl.render(e.sceneEl,e.animationJSON,{});const t=function(){e.running=!1,e.timeline.pause()};e.timeline.eventCallback("onComplete",t)}catch(t){alert(t),console.error(t),Object(pl["Notification"])({title:"Compile failed",message:t.message,type:"warning"})}},createAnimationJSON(e){const t=[...e.sceneEl.querySelectorAll(":scope > svg")].reverse(),a=[];e.scenes.forEach((e,r)=>{const i=t[r].id;let n;a.push({target:"#scene-cover-"+r,use:"fade-out",timing:{duration:.5,offset:0===r?0:-.5}}),n=0!==e.spec.animation.sequence.sync.length?we(e.spec.animation):{use:"empty",timing:{duration:2}},n.target="."+e.chartId;const s={sequence:{sync:[n,{use:"empty",timing:{duration:e.audioDuration}}]}};a.push(s),a.push({target:"#"+i,use:"fade-out",timing:{duration:.5,offset:1}})}),e.animationJSON={sequence:{concat:a}}},changeCanvasRenderSign(e){e.canvasRenderSign^=1},mountAudioElement(e,t){e.audioEl=t},setAudioSrc(e,t){e.audioSrc=t,e.setAudioReadyFunc?e.audioEl.removeEventListener("canplaythrough",e.setAudioReadyFunc,!1):e.setAudioReadyFunc=function(){e.audioReady=!0},e.audioReady=!1,e.audioEl.addEventListener("canplaythrough",e.setAudioReadyFunc,!1)},changeUseAudio(e,t){e.useAudio=t},changeAudioReady(e,t){e.audioReady=t},setSceneAudioDuration(e,{sceneIndex:t,duration:a}){e.scenes[t].audioDuration=a},playAnimation(e){e.running=!0,e.timeline.resume(),e.audioReady&&e.useAudio&&e.audioEl.play()},pauseAnimation(e){e.running=!1,e.timeline.pause(),e.audioReady&&e.useAudio&&e.audioEl.pause()},restartAnimation(e){e.running=!0,e.timeline.restart(),e.audioReady&&e.useAudio&&(e.audioEl.pause(),e.audioEl.currentTime=0,e.audioEl.play())}};var rd={namespaced:!0,state:Qc,getters:ed,actions:td,mutations:ad};r["default"].use(k["a"]);var id=new k["a"].Store({modules:{generator:Ka,editor:oc,resource:vc,target:Mc,project:rd},strict:!1}),nd=(a("0fae"),a("b2d6")),sd=a.n(nd),od=a("21a6"),ld=a("8f94"),cd=a.n(ld);a("a7be");const dd=new r["default"];r["default"].config.productionTip=!1,r["default"].use(i["a"]),r["default"].use(gl.a,{locale:sd.a}),r["default"].use(cd.a),r["default"].prototype.$saveAs=od["saveAs"],new r["default"]({render:e=>e(u),router:ge,store:id}).$mount("#app")},"5bc0":function(e,t,a){},6:function(e,t){},"618e":function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var r=a("4b58");class i extends r["a"]{constructor(){super(),this.type="native"}}},"6d0c":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return SectorWheelTemplate}));var _Users_carl_Code_Research_MSRA_WonderFlow2_0_frontend_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("ade3"),core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("5b81"),core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es_array_reduce_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("13d5"),core_js_modules_es_array_reduce_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_array_reduce_js__WEBPACK_IMPORTED_MODULE_2__),_core_entities_spec_template_NativeTemplate__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("618e"),_core_entities_spec_parameter_ParamType__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("c66e"),_core_entities_spec_parameter_ParamDefinition__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("a979"),_core_entities_spec_animation_NativeAnimation__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("2bc8"),gsap__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("cffa"),d3__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("898b"),_core_utils_uuid__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("8bce"),_core_const_Element__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("ba84");class SectorWheelTemplate extends _core_entities_spec_template_NativeTemplate__WEBPACK_IMPORTED_MODULE_3__["a"]{constructor(){super(),this.templateName="sector-wheel",this.parameters=[new _core_entities_spec_parameter_ParamDefinition__WEBPACK_IMPORTED_MODULE_5__["a"]("enterOrExit",_core_entities_spec_parameter_ParamType__WEBPACK_IMPORTED_MODULE_4__["a"].STRING,!1,"enter"),new _core_entities_spec_parameter_ParamDefinition__WEBPACK_IMPORTED_MODULE_5__["a"]("duration",_core_entities_spec_parameter_ParamType__WEBPACK_IMPORTED_MODULE_4__["a"].NUMBER,!1,1),new _core_entities_spec_parameter_ParamDefinition__WEBPACK_IMPORTED_MODULE_5__["a"]("ease",_core_entities_spec_parameter_ParamType__WEBPACK_IMPORTED_MODULE_4__["a"].STRING,!1,"power1.out"),new _core_entities_spec_parameter_ParamDefinition__WEBPACK_IMPORTED_MODULE_5__["a"]("stagger",_core_entities_spec_parameter_ParamType__WEBPACK_IMPORTED_MODULE_4__["a"].NUMBER,!1,0),new _core_entities_spec_parameter_ParamDefinition__WEBPACK_IMPORTED_MODULE_5__["a"]("valueMapper",_core_entities_spec_parameter_ParamType__WEBPACK_IMPORTED_MODULE_4__["a"].STRING,!1,"@datum.value"),new _core_entities_spec_parameter_ParamDefinition__WEBPACK_IMPORTED_MODULE_5__["a"]("extraDegree",_core_entities_spec_parameter_ParamType__WEBPACK_IMPORTED_MODULE_4__["a"].NUMBER,!1,5)]}createAnimation(){const e=new SectorWheelAnimation;return e.updateSettings(this.getParamValues()),e}}class SectorWheelAnimation extends _core_entities_spec_animation_NativeAnimation__WEBPACK_IMPORTED_MODULE_6__["a"]{constructor(...e){super(...e),Object(_Users_carl_Code_Research_MSRA_WonderFlow2_0_frontend_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"x",void 0),Object(_Users_carl_Code_Research_MSRA_WonderFlow2_0_frontend_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"y",void 0),Object(_Users_carl_Code_Research_MSRA_WonderFlow2_0_frontend_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"width",void 0),Object(_Users_carl_Code_Research_MSRA_WonderFlow2_0_frontend_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"height",void 0)}create(context){const glyphs=context.getGlyphs(this.target),defs=context.getDefsSel(),tl=gsap__WEBPACK_IMPORTED_MODULE_7__["a"].timeline(),{stagger:stagger,valueMapper:valueMapper,extraDegree:extraDegree}=this.settings;let x=1/0,y=1/0,width=0,height=0;glyphs.forEach(e=>{const t=e.getBBox();x=Math.min(x,t.x),y=Math.min(y,t.y),width=Math.max(width,t.x+t.width-x),height=Math.max(height,t.y+t.height-y)}),this.x=x,this.y=y,this.width=width,this.height=height,console.log("sector",x,y,width,height);const expr=valueMapper.replaceAll("@classList","__node__.classList").replaceAll("@id",'__node__.getAttribute("id")').replaceAll("@index","__index__").replaceAll("@datum",'(JSON.parse(__node__.getAttribute("ac-data")) ?? {})').replaceAll("@el","__node__");console.log("sector mapper expr",expr);const values=glyphs.map((__node__,__index__)=>eval(expr)),tot=values.reduce((e,t)=>e+t,0),sums=[0];values.forEach((e,t)=>sums.push(sums[t]+e));const startDegrees=values.map((e,t)=>sums[t]/tot*360),endDegrees=values.map((e,t)=>sums[t+1]/tot*360);return console.log({values:values,startDegrees:startDegrees,endDegrees:endDegrees}),glyphs.forEach((e,t)=>{const a=this.addClipPathToGlyph(defs,e),r=this.createTwForClip(a,e,startDegrees[t]-extraDegree,endDegrees[t]+extraDegree),i=0===t?0:"<"+stagger;tl.add(r,i)}),tl}addClipPathToGlyph(e,t){var a;t.getAttribute("id")||t.setAttribute("id",Object(_core_utils_uuid__WEBPACK_IMPORTED_MODULE_9__["a"])());const r="clip-path-"+t.getAttribute("id");let i=e.select("#"+r);i.empty()&&(i=e.append("clipPath").attr("id",r).classed(_core_const_Element__WEBPACK_IMPORTED_MODULE_10__["b"],!0),t.setAttribute("clip-path",`url(#${r})`));const n=i.select(".sector-wheel");if(!n.empty())return n.node();let s=parseFloat(null!==(a=t.getAttribute("stroke-width"))&&void 0!==a?a:"0");d3__WEBPACK_IMPORTED_MODULE_8__["k"](t).selectAll("*").each((function(){var e;const t=parseFloat(null!==(e=this.getAttribute("stroke-width"))&&void 0!==e?e:"0");s=Math.max(t,s)}));const o=i.append("path").attr("class","sector-wheel").attr("d","");return o.node()}createTwForClip(e,t,a,r){const{ease:i,duration:n}=this.settings,s=a,o=r-a;let l,c;l={startAngle:null!==s&&void 0!==s?s:0,sweepAngle:0,cx:this.x+this.width/2,cy:this.y+this.height/2,rx:Math.max(this.width,this.height),ry:Math.max(this.width,this.height)},console.log(l.cx,l.cy,l),c=o;const d=function(){const t=getArcPath(l.cx,l.cy,l.rx,l.ry,l.startAngle,l.sweepAngle);e.setAttribute("d",t)};return d(),gsap__WEBPACK_IMPORTED_MODULE_7__["a"].to(l,{sweepAngle:c,ease:i,onUpdate:d,duration:n})}}function getArcPath(e,t,a,r,i,n){if(!n)return`M${e} ${t}`;i%=360,n%=360;const s=0===n;s&&(n=180),n<0&&(n+=360);const o=n>180?1:0,l=i*Math.PI/180,c=(i+n)*Math.PI/180,d=e+a*Math.sin(l),u=t-r*Math.cos(l),h=e+a*Math.sin(c),p=t-r*Math.cos(c);return s?`\n      M ${d} ${u}\n      A ${a} ${r} 0 1 1 ${h} ${p}\n      A ${a} ${r} 0 1 1 ${d} ${u}z`:`\n    M ${d} ${u}\n    A ${a} ${r} 0 ${o} 1 ${h} ${p}\n    L ${e} ${t}z`}},"6e8a":function(e,t,a){"use strict";a("b24d")},7:function(e,t){},7891:function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"a",(function(){return o}));var r=a("ade3"),i=a("5e48"),n=a.n(i);class s{constructor(){Object(r["a"])(this,"transform",void 0)}static getDefaultTarget(){return new o}static simplifyJSON(e){if("object"!==typeof e)return e;const t={};if("selector"in e&&"*"!==e.selector&&""!==e.selector.trim()&&(t.selector=e.selector),"transform"in e){let a=e.transform;if("string"===typeof a&&""!==a.trim()&&(a=n.a.parse(a)),"object"!==typeof a||Array.isArray(a)||(t.transform=a),Array.isArray(a)&&0!==a.length){for(let e=0;e<a.length;e++)"string"===typeof a[e]&&(a[e]=n.a.parse(a[e]));t.transform=a}}return 0!==Object.keys(t).length?1===Object.keys(t).length&&"selector"in t?t.selector:t:void 0}}class o extends s{constructor(e="*",t=[]){super(),Object(r["a"])(this,"selector",void 0),this.selector=e,this.transform=t}}},"7bc9":function(e,t,a){"use strict";a("db27")},8:function(e,t){},"8bce":function(e,t,a){"use strict";function r(){let e=[],t="0123456789abcdef";for(let r=0;r<36;r++)e[r]=t.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";let a=e.join("");return a}a.d(t,"a",(function(){return r}))},"8f35":function(e,t,a){},"8f52":function(e,t,a){"use strict";function r(){let e=[],t="0123456789abcdef";for(let r=0;r<36;r++)e[r]=t.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";let a=e.join("");return a}a.d(t,"a",(function(){return r}))},9:function(e,t,a){e.exports=a("56d7")},"95d5":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return SortTransform}));var _Users_carl_Code_Research_MSRA_WonderFlow2_0_frontend_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("ade3"),core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("5b81"),core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_string_replace_all_js__WEBPACK_IMPORTED_MODULE_1__),_core_entities_spec_BaseTransform__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("ef41"),d3__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("898b");class SortTransform extends _core_entities_spec_BaseTransform__WEBPACK_IMPORTED_MODULE_2__["a"]{constructor(){super(),Object(_Users_carl_Code_Research_MSRA_WonderFlow2_0_frontend_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"type",void 0),Object(_Users_carl_Code_Research_MSRA_WonderFlow2_0_frontend_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"data",void 0),Object(_Users_carl_Code_Research_MSRA_WonderFlow2_0_frontend_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"attr",void 0),Object(_Users_carl_Code_Research_MSRA_WonderFlow2_0_frontend_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"expr",void 0),Object(_Users_carl_Code_Research_MSRA_WonderFlow2_0_frontend_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"order",void 0),this.type="sort",this.expr="0"}execute(selection){const reverse="dec"===this.order,nodes=selection.nodes();let expr;expr=this.data?"__node__.__data__."+this.data:this.attr?`__node__.getAttribute("${this.attr}")`:this.expr?this.expr.replaceAll("@classList","__node__.classList").replaceAll("@id",'__node__.getAttribute("id")').replaceAll("@index","__index__").replaceAll("@datum","__node__.__data__").replaceAll("@el","__node__"):"0",console.log("sort expr",expr);const compareFunc=(node,index)=>{let __expr__=expr,__order__=this.order;""!==node.getAttribute("ac-data")&&this.data&&(__expr__='(JSON.parse(__node__.getAttribute("ac-data")) ?? {}).'+this.data);const func=function(__node__,__index__){return Array.isArray(__order__)?__order__.indexOf(eval(__expr__)):eval(__expr__)};return func(node,index)},indexMap=new Map;return nodes.forEach((e,t)=>indexMap.set(e,t)),nodes.sort((e,t)=>{const a=compareFunc(e,indexMap.get(e))-compareFunc(t,indexMap.get(e));return reverse?-a:a}),d3__WEBPACK_IMPORTED_MODULE_3__["l"](nodes)}}},a979:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var r=a("ade3"),i=a("c66e");class n{constructor(e="param",t=i["a"].ANY,a=!0,n){Object(r["a"])(this,"paramName",void 0),Object(r["a"])(this,"paramType",void 0),Object(r["a"])(this,"required",void 0),Object(r["a"])(this,"defaultValue",void 0),this.paramName=e,this.paramType=t.toLowerCase(),this.required=a,this.defaultValue=n}isAcceptable(e){if(void 0===e&&this.required)return!1;switch(this.paramType){case i["a"].NUMBER:return"number"===typeof e;case i["a"].STRING:return"string"===typeof e;case i["a"].OBJECT:return"object"===typeof e;case i["a"].ARRAY:return Array.isArray(e);case i["a"].ANY:return!0;case i["a"].BOOLEAN:return"boolean"===typeof e;case i["a"].NUMBER_OR_ARRAY:return"number"===typeof e||Array.isArray(e);case i["a"].STRING_OR_ARRAY:return"string"===typeof e||Array.isArray(e)}return!1}}},b24d:function(e,t,a){},ba84:function(e,t,a){"use strict";a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return n}));const r="ani-chart-mask",i="ani-chart-annotation",n="ani-chart-clip-path"},c492:function(e,t,a){"use strict";a("39ec")},c66e:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));const r={NUMBER:"number",STRING:"string",OBJECT:"object",ARRAY:"array",ANY:"any",BOOLEAN:"boolean",NUMBER_OR_ARRAY:"number-or-array",STRING_OR_ARRAY:"string-or-array"}},db27:function(e,t,a){},e13f:function(e,t,a){"use strict";a("4c89")},ef41:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var r=a("ade3");class i{constructor(){Object(r["a"])(this,"type",void 0),this.type="unknown"}execute(e){throw"This transform object is abstract."}}},f3ca:function(e,t,a){"use strict";a("8f35")},f720:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var r=a("ade3"),i=a("0764"),n=a("7891");class s{constructor(e={}){Object(r["a"])(this,"target",void 0),Object(r["a"])(this,"timing",void 0),Object(r["a"])(this,"type",void 0),Object(r["a"])(this,"settings",void 0),this.target=n["b"].getDefaultTarget(),this.timing=new i["a"],this.type="unknown";const t=this.getDefaultSettings();this.settings=Object.assign(t,e)}setTarget(e){return this.target="string"===typeof e?new n["a"](e):e,this}updateTarget(e){return Object.assign(this.target,e),this}setTiming(e){return this.timing=e,this}updateTiming(e){return Object.keys(e).forEach(t=>{void 0!==e[t]&&(this.timing[t]=e[t])}),this}getDefaultSettings(){return{}}updateSettings(e){return Object.assign(this.settings,e),this}set(e,t){return this.settings[e]=t,this}computeDuration(e){throw"Animation is not implemented"}computePossibleElements(e){throw"Animation is not implemented"}create(e){throw"Animation is not implemented"}}},fef3:function(e,t,a){"use strict";a("2f6e")}});
//# sourceMappingURL=app.f6583306.js.map